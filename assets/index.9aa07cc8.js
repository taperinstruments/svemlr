var ht=Object.defineProperty,mt=Object.defineProperties;var gt=Object.getOwnPropertyDescriptors;var Re=Object.getOwnPropertySymbols;var bt=Object.prototype.hasOwnProperty,vt=Object.prototype.propertyIsEnumerable;var je=(t,e,n)=>e in t?ht(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ee=(t,e)=>{for(var n in e||(e={}))bt.call(e,n)&&je(t,n,e[n]);if(Re)for(var n of Re(e))vt.call(e,n)&&je(t,n,e[n]);return t},Fe=(t,e)=>mt(t,gt(e));import{d as x,w as U,g as we,t as kt,S as ue,i as ce,s as ae,e as y,a as W,b as I,c as T,f as g,h as ge,j as M,k as h,l as Pe,m as Le,n as V,o as j,p as ie,q as Se,r as Ne,u as yt,v as Ct,x as be,y as _e,z as de,A as le,B as wt,C as J,D as $,E as he,F as ve,G as He,H as ee,I as fe,J as ze,K as Ve,L as Ge,M as Lt,N as St,O as qt,P as Ae,Q as Te,R as Et}from"./vendor.59a9d5da.js";const zt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}};zt();function At(){let t=function(n){};return{promise:new Promise(n=>t=n),resolve:t}}function me(t,e){const n=[];for(let l=0;l<t;l++)n[l]=typeof e=="function"?e(l):e;return n}function Tt(t,e){const n=[];let l=0;const o=t.length;for(;l<o;)n.push(t.slice(l,l+=e));return n}function Mt(t,e){return t.reduce((n,l)=>{const o=e(l);return n.find(i=>e(i)===o)||n.push(l),n},[])}function Ot(t,e,n){const l=8;Tt(n,l).forEach((i,s)=>t.gridLedRow(s*l,e,i))}async function Ke(t){return new Promise(e=>{t.on("getGridSize",n=>e(n)),t.getGridSize()})}const Dt="0.1.2";function Me(t,e,n,l){return me(t,o=>{const i=e(Ee({id:o},l));return n.push(i),i}),n}const te=[];function It({id:t,audioContext:e}){let n;const l=e.createGain();l.connect(e.destination);const o=U(!1),i=U(1),s=U(!1);x([i,s],([C,a])=>a?0:C).subscribe(C=>l.gain.setTargetAtTime(C,e.currentTime,.015));function c(C,a){return u(),n=C,C.connect(l),C.start(0,a),o.set(!0),C}function u(){n==null||n.stop(),o.set(!1)}function f(){s.set(!we(s))}const p=1e3,b=1e3/25,d=1/(p/b);let L;function v(){L=R(i,d,b)}function B(){L=R(i,-d,b)}function R(C,a,E){let z=we(C);return setInterval(function(){z=Math.max(0,Math.min(z+a,1)),C.set(z)},E)}function F(){clearInterval(L)}return{id:t,level:i,muted:s,active:o,play:c,stop:u,toggleMute:f,startIncreasingLevel:v,startDecreasingLevel:B,stopIncreasingLevel:F,stopDecreasingLevel:F}}const Ze=new FileReader;function Bt(t,e){return new Promise(n=>{Ze.readAsArrayBuffer(t),Ze.onload=async({target:{result:l}})=>{n(await e.decodeAudioData(l))}})}function Rt(t){const e=new AudioBuffer({sampleRate:t.sampleRate,numberOfChannels:t.numberOfChannels,length:t.length});for(let l=0;l<t.numberOfChannels;l++){const o=t.getChannelData(l),i=e.getChannelData(l);for(var n=t.length-1;n>=0;n--)i[t.length-n-1]=o[n]}return e}function jt(t,e,n){const l=e.createBufferSource();t&&(l.buffer=t);const{loopStart:o,loopEnd:i,loop:s,speed:r}=n;return l.loop=!!s,o!=null&&(l.loopStart=o),i!=null&&(l.loopEnd=i),r!=null&&(l.playbackRate.value=r),l}function Ft(t,e){let n,l,o;t.addEventListener("ended",s);function i(v=0){n=v,e(L()),l=c(),o=setInterval(r,1e3/60)}function s(){clearInterval(o)}function r(){const v=c();n+=(v-l)*d(),b()&&n>p()&&(n=f()+(n-p())),e(L()),l=v}function c(){return+new Date/1e3}function u(){return t.buffer.duration}function f(){return t.loopStart||0}function p(){return t.loopEnd||u()}function b(){return t.loop}function d(){return t.playbackRate.value}function L(){return Math.min(n/u()-Number.MIN_VALUE,1)}return{start:i,stop:s,check:r}}const ke=[];function Pt({id:t,audioContext:e,group:n,stepCount:l,bpm:o,scheduler:i}){n=U(n);const s=U(null),r=x(s,m=>m&&Rt(m)),c=x(s,m=>(m==null?void 0:m.duration)||0),u=U(0),f=U(!1),p=U(0),b=U(),d=U(l),L=x(d,m=>me(l,A=>({enabled:A<m}))),v=x(o,m=>60/m),B=x([v,d],([m,A])=>m*A),R=U(0),F=U(!1),C=x([R,F,d],([m,A,k])=>A?oe(Math.floor(m*k)):null),a=x([c,B,u],([m,A,k])=>m?m/A*Math.pow(2,k):1),E=x([c,d,p],([m,A,k])=>m/A*k),z=x([c,d,b],([m,A,k])=>m/A*(k!=null?k:A)),D=x(E,m=>m!=null),ne={group:n,buffer:s,reffub:r,duration:c,enabledStepCount:d,steps:L,currentStep:C,octave:u,speed:a,reverse:f,loopStart:E,loopEnd:z,loop:D,playing:F,progress:R},P={};for(const m in ne)ne[m].subscribe(A=>P[m]=A);let q,N;E.subscribe(m=>{q&&(q.loopStart=m),N==null||N.check()}),z.subscribe(m=>{q&&(q.loopEnd=m),N==null||N.check()}),D.subscribe(m=>{q&&(q.loop=m),N==null||N.check()}),a.subscribe(m=>{q&&(q.playbackRate.value=m),N==null||N.check()}),f.subscribe(()=>{const{playing:m,duration:A,progress:k}=P;m&&S((1-k)*A)}),c.subscribe(async m=>{const{playing:A,progress:k}=P;A&&(N==null||N.check(),await kt(),S(k*m))});function _(m){!P.buffer||!K(m)||i.schedule(function(){S(w(oe(m)))})}function S(m){q=O(),P.group.play(q,m),N==null||N.stop(),N=Ft(q,R.set),N.start(m),F.set(!0)}function G(){p.set(0),b.set(null)}function X(m){if(!K(m[0])||!K(m[1]))return;m=oe(m);const{reverse:A}=P;p.set(A?m[1]:m[0]),b.set(A?m[0]:m[1])}function w(m){const{duration:A,enabledStepCount:k}=P;return A/k*m}function K(m){return m<P.enabledStepCount}function oe(m){return Array.isArray(m)?m.map(pe):pe(m)}function pe(m){if(m==null)return m;const{enabledStepCount:A,reverse:k}=P;return k?Math.abs(m-(A-1)):m}let se;function O(){const{reverse:m,buffer:A,reffub:k,loop:Q,loopStart:Y,loopEnd:H,speed:re}=P;return se=+new Date+Math.random(),q=jt(m?k:A,e,{loop:Q,loopStart:Y,loopEnd:H,speed:re}),q.onended=(dt=>()=>Z(dt))(se),q}function Z(m){(!m||se===m)&&F.set(!1)}return Fe(Ee({id:t},ne),{start:_,resetLoopPoints:G,loopBetween:X})}const ye=[];function Nt({id:t,bpm:e,scheduler:n,router:l}){const o=U(!1),i=U(!1),s=x([o,i],([a,E])=>a||E),r=U(8),c=x([e,r],([a,E])=>60/a*E);let u=()=>{},f=[],p=null;const b={recordable:o,playing:i,active:s,length:r,duration:c},d={};for(const a in b)b[a].subscribe(E=>d[a]=E);function L(){d.active?(o.set(!1),i.set(!1),C()):o.set(!0)}function v(a){const{recordable:E,duration:z}=d;!E||f.push(R(a))===1&&(p=n.schedule(B,null,{in:z}))}function B(){o.set(!1),i.set(!0)}function R({x:a,y:E,state:z}){const{duration:D}=d;return n.schedule(()=>{l.handle({x:a,y:E,state:z,source:"pattern"}),n.schedule(u)},null,{in:D,repeat:D})}function F(){p==null||p.clear(),p=null,i.set(!1)}function C(){f.forEach(a=>a.clear()),f=[],F()}return{id:t,toggle:L,record:v,recordable:o,playing:i,active:s,length:r,set onactivity(a){u=a}}}function Ue(t,e,n){const l=t.slice();return l[4]=e[n],l}function Qe(t){let e,n=t[4].name+"",l,o,i;return{c(){e=y("option"),l=W(n),o=I(),e.__value=i=t[4],e.value=e.__value},m(s,r){T(s,e,r),g(e,l),g(e,o)},p(s,r){r&4&&n!==(n=s[4].name+"")&&ge(l,n),r&4&&i!==(i=s[4])&&(e.__value=i,e.value=e.__value)},d(s){s&&M(e)}}}function Ht(t){let e,n,l,o=t[2],i=[];for(let s=0;s<o.length;s+=1)i[s]=Qe(Ue(t,o,s));return{c(){e=y("select");for(let s=0;s<i.length;s+=1)i[s].c();h(e,"class","svelte-1hx4o8j"),t[0]===void 0&&Pe(()=>t[3].call(e))},m(s,r){T(s,e,r);for(let c=0;c<i.length;c+=1)i[c].m(e,null);Le(e,t[0]),n||(l=V(e,"change",t[3]),n=!0)},p(s,[r]){if(r&4){o=s[2];let c;for(c=0;c<o.length;c+=1){const u=Ue(s,o,c);i[c]?i[c].p(u,r):(i[c]=Qe(u),i[c].c(),i[c].m(e,null))}for(;c<i.length;c+=1)i[c].d(1);i.length=o.length}r&5&&Le(e,s[0])},i:j,o:j,d(s){s&&M(e),ie(i,s),n=!1,l()}}}function Vt(t,e,n){let l,o=j,i=()=>(o(),o=Se(s,u=>n(2,l=u)),s);t.$$.on_destroy.push(()=>o());let{files:s}=e;i();let{selected:r}=e;function c(){r=Ne(this),n(0,r)}return t.$$set=u=>{"files"in u&&i(n(1,s=u.files)),"selected"in u&&n(0,r=u.selected)},[r,s,l,c]}class Gt extends ue{constructor(e){super();ce(this,e,Vt,Ht,ae,{files:1,selected:0})}}function Je(t,e,n){const l=t.slice();return l[34]=e[n],l}function We(t,e,n){const l=t.slice();return l[37]=e[n],l[39]=n,l}function Xe(t){let e,n,l,o,i,s,r;function c(){return t[25](t[39])}return{c(){e=y("input"),h(e,"name",n="sample_"+t[11]+"_step"),h(e,"type","radio"),e.value=l=t[39],e.checked=o=t[3]==t[39],e.disabled=i=!t[37].enabled,h(e,"autocomplete","off")},m(u,f){T(u,e,f),s||(r=V(e,"click",be(c)),s=!0)},p(u,f){t=u,f[0]&8&&o!==(o=t[3]==t[39])&&(e.checked=o),f[0]&16&&i!==(i=!t[37].enabled)&&(e.disabled=i)},d(u){u&&M(e),s=!1,r()}}}function Ye(t){let e,n,l,o,i;return{c(){e=y("input"),h(e,"name",n="sample_"+t[11]+"_group"),h(e,"type","radio"),e.__value=l=t[34],e.value=e.__value,h(e,"autocomplete","off"),t[31][0].push(e)},m(s,r){T(s,e,r),e.checked=e.__value===t[10],o||(i=V(e,"change",t[30]),o=!0)},p(s,r){r[0]&1&&l!==(l=s[34])&&(e.__value=l,e.value=e.__value),r[0]&1024&&(e.checked=e.__value===s[10])},d(s){s&&M(e),t[31][0].splice(t[31][0].indexOf(e),1),o=!1,i()}}}function Kt(t){let e,n,l,o,i,s,r,c,u,f,p,b,d=(t[7]>=0?"+":"")+"",L,v,B,R,F,C,a,E,z=t[8].toFixed(2)+"",D,ne,P,q,N,_,S,G,X,w,K,oe;function pe(k){t[24](k)}let se={files:t[1]};t[2]!==void 0&&(se.selected=t[2]),l=new Gt({props:se}),yt.push(()=>Ct(l,"selected",pe));let O=t[4],Z=[];for(let k=0;k<O.length;k+=1)Z[k]=Xe(We(t,O,k));let m=t[0],A=[];for(let k=0;k<m.length;k+=1)A[k]=Ye(Je(t,m,k));return{c(){e=y("tr"),n=y("td"),_e(l.$$.fragment),i=I(),s=y("td"),r=y("div");for(let k=0;k<Z.length;k+=1)Z[k].c();c=I(),u=y("input"),f=I(),p=y("td"),b=y("span"),L=W(d),v=W(t[7]),B=I(),R=y("button"),R.textContent="-",F=I(),C=y("button"),C.textContent="+",a=I(),E=y("td"),D=W(z),ne=I(),P=y("td"),q=y("input"),N=I(),_=y("label"),S=W("Rev"),G=I(),X=y("td");for(let k=0;k<A.length;k+=1)A[k].c();h(n,"class","svelte-2kpfy0"),h(u,"type","range"),h(u,"min","1"),h(u,"max",t[5]),h(u,"step","1"),h(u,"class","svelte-2kpfy0"),h(s,"class","svelte-2kpfy0"),h(R,"aria-label","Decrement octave"),h(C,"aria-label","Increment octave"),h(p,"class","svelte-2kpfy0"),h(E,"class","svelte-2kpfy0"),h(q,"id","sample_"+t[11]+"_reverse"),h(q,"type","checkbox"),h(_,"for","sample_"+t[11]+"_reverse"),h(P,"class","svelte-2kpfy0"),h(X,"class","svelte-2kpfy0")},m(k,Q){T(k,e,Q),g(e,n),de(l,n,null),g(e,i),g(e,s),g(s,r);for(let Y=0;Y<Z.length;Y+=1)Z[Y].m(r,null);g(s,c),g(s,u),le(u,t[6]),g(e,f),g(e,p),g(p,b),g(b,L),g(b,v),g(p,B),g(p,R),g(p,F),g(p,C),g(e,a),g(e,E),g(E,D),g(e,ne),g(e,P),g(P,q),q.checked=t[9],g(P,N),g(P,_),g(_,S),g(e,G),g(e,X);for(let Y=0;Y<A.length;Y+=1)A[Y].m(X,null);w=!0,K||(oe=[V(u,"change",t[26]),V(u,"input",t[26]),V(R,"click",t[27]),V(C,"click",t[28]),V(q,"change",t[29])],K=!0)},p(k,Q){const Y={};if(Q[0]&2&&(Y.files=k[1]),!o&&Q[0]&4&&(o=!0,Y.selected=k[2],wt(()=>o=!1)),l.$set(Y),Q[0]&1050648){O=k[4];let H;for(H=0;H<O.length;H+=1){const re=We(k,O,H);Z[H]?Z[H].p(re,Q):(Z[H]=Xe(re),Z[H].c(),Z[H].m(r,null))}for(;H<Z.length;H+=1)Z[H].d(1);Z.length=O.length}if((!w||Q[0]&32)&&h(u,"max",k[5]),Q[0]&64&&le(u,k[6]),(!w||Q[0]&128)&&d!==(d=(k[7]>=0?"+":"")+"")&&ge(L,d),(!w||Q[0]&128)&&ge(v,k[7]),(!w||Q[0]&256)&&z!==(z=k[8].toFixed(2)+"")&&ge(D,z),Q[0]&512&&(q.checked=k[9]),Q[0]&3073){m=k[0];let H;for(H=0;H<m.length;H+=1){const re=Je(k,m,H);A[H]?A[H].p(re,Q):(A[H]=Ye(re),A[H].c(),A[H].m(X,null))}for(;H<A.length;H+=1)A[H].d(1);A.length=m.length}},i(k){w||(J(l.$$.fragment,k),w=!0)},o(k){$(l.$$.fragment,k),w=!1},d(k){k&&M(e),he(l),ie(Z,k),ie(A,k),K=!1,ve(oe)}}}function Zt(t,e,n){let l,o,i,s,r,c,u,f,p,b;const d=He("audioContext");let{sample:L={}}=e,{id:v,steps:B,enabledStepCount:R,currentStep:F,octave:C,speed:a,reverse:E,buffer:z,group:D,start:ne}=L;ee(t,B,O=>n(4,r=O)),ee(t,R,O=>n(6,c=O)),ee(t,F,O=>n(3,s=O)),ee(t,C,O=>n(7,u=O)),ee(t,a,O=>n(8,f=O)),ee(t,E,O=>n(9,p=O)),ee(t,z,O=>n(32,i=O)),ee(t,D,O=>n(10,b=O));let{groups:P=[]}=e,{monome:q={}}=e,{files:N={}}=e,_;const S=[[]];function G(O){_=O,n(2,_)}const X=O=>ne(O);function w(){c=fe(this.value),R.set(c)}const K=()=>ze(C,--u,u),oe=()=>ze(C,++u,u);function pe(){p=this.checked,E.set(p)}function se(){b=this.__value,D.set(b)}return t.$$set=O=>{"sample"in O&&n(21,L=O.sample),"groups"in O&&n(0,P=O.groups),"monome"in O&&n(22,q=O.monome),"files"in O&&n(1,N=O.files)},t.$$.update=()=>{t.$$.dirty[0]&16&&n(5,l=r.length),t.$$.dirty[0]&12582936&&Ot(q,o,r.map((O,Z)=>Z===s)),t.$$.dirty[0]&4&&_&&Bt(_,d).then(O=>ze(z,i=O,i))},n(23,o=v+1),[P,N,_,s,r,l,c,u,f,p,b,v,B,R,F,C,a,E,z,D,ne,L,q,o,G,X,w,K,oe,pe,se,S]}class Ut extends ue{constructor(e){super();ce(this,e,Zt,Kt,ae,{sample:21,groups:0,monome:22,files:1},null,[-1,-1])}}function xe(t,e,n){const l=t.slice();return l[8]=e[n].name,l}function $e(t){let e,n=t[3],l=[];for(let o=0;o<n.length;o+=1)l[o]=et(xe(t,n,o));return{c(){e=y("ul");for(let o=0;o<l.length;o+=1)l[o].c();h(e,"class","svelte-1eckyqf")},m(o,i){T(o,e,i);for(let s=0;s<l.length;s+=1)l[s].m(e,null)},p(o,i){if(i&8){n=o[3];let s;for(s=0;s<n.length;s+=1){const r=xe(o,n,s);l[s]?l[s].p(r,i):(l[s]=et(r),l[s].c(),l[s].m(e,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=n.length}},d(o){o&&M(e),ie(l,o)}}}function et(t){let e,n,l,o,i=t[8]+"",s,r;return{c(){e=y("li"),n=Ve("svg"),l=Ve("path"),o=I(),s=W(i),r=I(),h(l,"d","M3.5 2C3.22386 2 3 2.22386 3 2.5V12.5C3 12.7761 3.22386 13 3.5 13H11.5C11.7761 13 12 12.7761 12 12.5V6H8.5C8.22386 6 8 5.77614 8 5.5V2H3.5ZM9 2.70711L11.2929 5H9V2.70711ZM2 2.5C2 1.67157 2.67157 1 3.5 1H8.5C8.63261 1 8.75979 1.05268 8.85355 1.14645L12.8536 5.14645C12.9473 5.24021 13 5.36739 13 5.5V12.5C13 13.3284 12.3284 14 11.5 14H3.5C2.67157 14 2 13.3284 2 12.5V2.5Z"),h(l,"fill","currentColor"),h(l,"fill-rule","evenodd"),h(l,"clip-rule","evenodd"),h(n,"width","15"),h(n,"height","15"),h(n,"viewBox","0 0 15 15"),h(n,"fill","none"),h(n,"xmlns","http://www.w3.org/2000/svg"),h(n,"class","svelte-1eckyqf"),h(e,"class","svelte-1eckyqf")},m(c,u){T(c,e,u),g(e,n),g(n,l),g(e,o),g(e,s),g(e,r)},p(c,u){u&8&&i!==(i=c[8]+"")&&ge(s,i)},d(c){c&&M(e)}}}function Qt(t){let e,n,l,o,i,s,r,c,u=t[3].length&&$e(t);return{c(){e=y("section"),n=y("label"),n.textContent="Audio file drop",l=I(),o=y("div"),i=y("input"),s=I(),u&&u.c(),h(n,"for","files"),h(i,"accept","audio/*"),h(i,"id","files"),h(i,"name","files"),h(i,"type","file"),h(i,"class","svelte-1eckyqf"),h(o,"class","file-drop svelte-1eckyqf"),Ge(o,"dragover",t[2]),h(e,"class","svelte-1eckyqf")},m(f,p){T(f,e,p),g(e,n),g(e,l),g(e,o),g(o,i),g(o,s),u&&u.m(o,null),r||(c=[V(i,"change",t[5]),V(o,"dragover",be(t[6])),V(o,"dragleave",be(t[7])),V(o,"drop",be(t[4]))],r=!0)},p(f,[p]){f[3].length?u?u.p(f,p):(u=$e(f),u.c(),u.m(o,null)):u&&(u.d(1),u=null),p&4&&Ge(o,"dragover",f[2])},i:j,o:j,d(f){f&&M(e),u&&u.d(),r=!1,ve(c)}}}function Jt(t){return t.reduce((e,n)=>{if(n.kind==="file"){const l=n.getAsFile();/^(audio|video)/.test(l.type)&&e.push(l)}return e},[])}function Wt(t,e,n){let l,o=j,i=()=>(o(),o=Se(s,d=>n(3,l=d)),s);t.$$.on_destroy.push(()=>o());let{files:s}=e;i();let r,c=!1;function u({dataTransfer:d}){n(2,c=!1),s.add(Jt([...d.items]))}function f(){r=this.files,n(1,r)}const p=()=>n(2,c=!0),b=()=>n(2,c=!1);return t.$$set=d=>{"files"in d&&i(n(0,s=d.files))},t.$$.update=()=>{t.$$.dirty&3&&s.add(r)},[s,r,c,l,u,f,p,b]}class Xt extends ue{constructor(e){super();ce(this,e,Wt,Qt,ae,{files:0})}}function Yt(t){let e,n,l,o,i,s,r,c,u,f,p,b,d,L,v;return{c(){e=y("div"),n=y("label"),l=y("input"),i=W(`
    On/Off`),s=I(),r=y("label"),c=y("input"),u=W(`
    Mute`),f=I(),p=y("label"),b=W(`Level
    `),d=y("input"),h(l,"type","checkbox"),l.disabled=o=!t[0],h(n,"class","svelte-37acoc"),h(c,"type","checkbox"),h(r,"class","svelte-37acoc"),h(d,"type","range"),h(d,"min","0"),h(d,"max","1"),h(d,"step","0.01"),h(p,"class","svelte-37acoc")},m(B,R){T(B,e,R),g(e,n),g(n,l),l.checked=t[0],g(n,i),g(e,s),g(e,r),g(r,c),c.checked=t[1],g(r,u),g(e,f),g(e,p),g(p,b),g(p,d),le(d,t[2]),L||(v=[V(l,"change",t[8]),V(c,"change",t[9]),V(d,"change",t[10]),V(d,"input",t[10])],L=!0)},p(B,[R]){R&1&&o!==(o=!B[0])&&(l.disabled=o),R&1&&(l.checked=B[0]),R&2&&(c.checked=B[1]),R&4&&le(d,B[2])},i:j,o:j,d(B){B&&M(e),L=!1,ve(v)}}}function xt(t,e,n){let l,o,i,{group:s={}}=e,{monome:r}=e,{id:c,active:u,muted:f,level:p}=s;ee(t,u,v=>n(0,l=v)),ee(t,f,v=>n(1,o=v)),ee(t,p,v=>n(2,i=v));function b(){l=this.checked,u.set(l)}function d(){o=this.checked,f.set(o)}function L(){i=fe(this.value),p.set(i)}return t.$$set=v=>{"group"in v&&n(6,s=v.group),"monome"in v&&n(7,r=v.monome)},t.$$.update=()=>{t.$$.dirty&65&&(l||s.stop()),t.$$.dirty&129&&r.gridLed(c,0,l)},[l,o,i,u,f,p,s,r,b,d,L]}class $t extends ue{constructor(e){super();ce(this,e,xt,Yt,ae,{group:6,monome:7})}}function tt(t,e,n){const l=t.slice();return l[12]=e[n],l}function nt(t){let e,n,l=t[12]+"",o,i;return{c(){e=y("option"),n=W("1/"),o=W(l),e.__value=i=t[12],e.value=e.__value},m(s,r){T(s,e,r),g(e,n),g(e,o)},p:j,d(s){s&&M(e)}}}function en(t){let e,n,l,o,i,s,r,c,u,f,p,b,d,L,v,B,R,F=t[4],C=[];for(let a=0;a<F.length;a+=1)C[a]=nt(tt(t,F,a));return{c(){e=y("label"),e.textContent="Tempo",n=I(),l=y("input"),o=I(),i=y("button"),i.textContent="-4",s=I(),r=y("button"),r.textContent="-1",c=I(),u=y("button"),u.textContent="+1",f=I(),p=y("button"),p.textContent="+4",b=I(),d=y("label"),d.textContent="Quantize",L=I(),v=y("select");for(let a=0;a<C.length;a+=1)C[a].c();h(e,"for","tempo"),h(l,"type","number"),h(l,"id","tempo"),h(l,"size","6"),h(l,"class","svelte-1texyt4"),h(d,"for","quantize"),h(v,"name","quantize"),h(v,"id","quantize"),t[3]===void 0&&Pe(()=>t[11].call(v))},m(a,E){T(a,e,E),T(a,n,E),T(a,l,E),le(l,t[2]),T(a,o,E),T(a,i,E),T(a,s,E),T(a,r,E),T(a,c,E),T(a,u,E),T(a,f,E),T(a,p,E),T(a,b,E),T(a,d,E),T(a,L,E),T(a,v,E);for(let z=0;z<C.length;z+=1)C[z].m(v,null);Le(v,t[3]),B||(R=[V(l,"input",t[6]),V(i,"click",t[7]),V(r,"click",t[8]),V(u,"click",t[9]),V(p,"click",t[10]),V(v,"change",t[11])],B=!0)},p(a,[E]){if(E&4&&fe(l.value)!==a[2]&&le(l,a[2]),E&16){F=a[4];let z;for(z=0;z<F.length;z+=1){const D=tt(a,F,z);C[z]?C[z].p(D,E):(C[z]=nt(D),C[z].c(),C[z].m(v,null))}for(;z<C.length;z+=1)C[z].d(1);C.length=F.length}E&24&&Le(v,a[3])},i:j,o:j,d(a){a&&M(e),a&&M(n),a&&M(l),a&&M(o),a&&M(i),a&&M(s),a&&M(r),a&&M(c),a&&M(u),a&&M(f),a&&M(p),a&&M(b),a&&M(d),a&&M(L),a&&M(v),ie(C,a),B=!1,ve(R)}}}function tn(t,e,n){let l,o=j,i=()=>(o(),o=Se(u,C=>n(2,l=C)),u),s,r=j,c=()=>(r(),r=Se(f,C=>n(3,s=C)),f);t.$$.on_destroy.push(()=>o()),t.$$.on_destroy.push(()=>r());let{bpm:u}=e;i();let{quantize:f}=e;c();const p=[128,64,32,16,8,4,2];function b(C){u.update(a=>a+C)}function d(){l=fe(this.value),u.set(l)}const L=()=>b(-4),v=()=>b(-1),B=()=>b(1),R=()=>b(4);function F(){s=Ne(this),f.set(s),n(4,p)}return t.$$set=C=>{"bpm"in C&&i(n(0,u=C.bpm)),"quantize"in C&&c(n(1,f=C.quantize))},[u,f,l,s,p,b,d,L,v,B,R,F]}class nn extends ue{constructor(e){super();ce(this,e,tn,en,ae,{bpm:0,quantize:1})}}function ln(t){let e,n,l,o,i,s,r,c,u,f,p,b,d;return{c(){e=y("div"),n=y("label"),l=y("input"),o=W(`
    On/Off`),i=I(),s=y("label"),r=W(`Length
    `),c=y("input"),u=I(),f=y("input"),p=W(`
    beats`),h(l,"id","pattern_"+t[2]+"_active"),h(l,"name","pattern_"+t[2]+"_active"),h(l,"type","checkbox"),l.checked=t[0],h(n,"class","svelte-37acoc"),h(c,"type","range"),h(c,"min","1"),h(c,"max","32"),h(f,"type","number"),h(f,"min","1"),h(f,"max","32"),h(s,"class","svelte-37acoc")},m(L,v){T(L,e,v),g(e,n),g(n,l),g(n,o),g(e,i),g(e,s),g(s,r),g(s,c),le(c,t[1]),g(s,u),g(s,f),le(f,t[1]),g(s,p),b||(d=[V(l,"change",be(t[4])),V(c,"change",t[8]),V(c,"input",t[8]),V(f,"input",t[9])],b=!0)},p(L,[v]){v&1&&(l.checked=L[0]),v&2&&le(c,L[1]),v&2&&fe(f.value)!==L[1]&&le(f,L[1])},i:j,o:j,d(L){L&&M(e),b=!1,ve(d)}}}function on(t,e,n){let l,o,{pattern:i={}}=e,{monome:s}=e,{id:r,active:c,toggle:u,length:f}=i;ee(t,c,L=>n(0,l=L)),ee(t,f,L=>n(1,o=L));const p=r+te.length;i.onactivity=()=>{s.gridLed(p,0,0),setTimeout(()=>l&&s.gridLed(p,0,1),50)};function b(){o=fe(this.value),f.set(o)}function d(){o=fe(this.value),f.set(o)}return t.$$set=L=>{"pattern"in L&&n(6,i=L.pattern),"monome"in L&&n(7,s=L.monome)},t.$$.update=()=>{t.$$.dirty&129&&s.gridLed(p,0,l)},[l,o,r,c,u,f,i,s,b,d]}class sn extends ue{constructor(e){super();ce(this,e,on,ln,ae,{pattern:6,monome:7})}}function lt(t,e,n){const l=t.slice();return l[9]=e[n],l}function ot(t,e,n){const l=t.slice();return l[12]=e[n],l}function st(t,e,n){const l=t.slice();return l[15]=e[n],l}function it(t){let e,n,l,o,i,s,r,c,u;return{c(){e=y("p"),e.innerHTML="Before you start, svemlr requires that <strong>serialosc is disabled</strong>. On macOS open Terminal and execute:",n=I(),l=y("pre"),l.innerHTML='<code class="svelte-1oj1ab1">launchctl unload /Library/LaunchAgents/org.monome.serialosc.plist</code>',o=I(),i=y("p"),i.innerHTML='To re-enable: <code class="svelte-1oj1ab1">launchctl load /Library/LaunchAgents/org.monome.serialosc.plist</code>',s=I(),r=y("button"),r.textContent="Connect",h(l,"class","svelte-1oj1ab1")},m(f,p){T(f,e,p),T(f,n,p),T(f,l,p),T(f,o,p),T(f,i,p),T(f,s,p),T(f,r,p),c||(u=V(r,"click",t[5]),c=!0)},p:j,d(f){f&&M(e),f&&M(n),f&&M(l),f&&M(o),f&&M(i),f&&M(s),f&&M(r),c=!1,u()}}}function rn(t){return{c:j,m:j,p:j,i:j,o:j,d:j}}function un(t){let e,n,l,o,i,s,r,c,u,f,p,b,d,L,v,B,R,F,C=ke,a=[];for(let _=0;_<C.length;_+=1)a[_]=rt(st(t,C,_));const E=_=>$(a[_],1,1,()=>{a[_]=null});r=new Xt({props:{files:t[0]}}),u=new nn({props:{bpm:t[1],quantize:t[2]}});let z=ye,D=[];for(let _=0;_<z.length;_+=1)D[_]=ut(ot(t,z,_));const ne=_=>$(D[_],1,1,()=>{D[_]=null});let P=te,q=[];for(let _=0;_<P.length;_+=1)q[_]=ct(lt(t,P,_));const N=_=>$(q[_],1,1,()=>{q[_]=null});return{c(){e=y("section"),n=y("table"),l=y("thead"),l.innerHTML=`<th>File</th> 
					<th></th> 
					<th>Octave</th> 
					<th>Speed</th> 
					<th></th> 
					<th>Group</th>`,o=I(),i=y("tbody");for(let _=0;_<a.length;_+=1)a[_].c();s=I(),_e(r.$$.fragment),c=I(),_e(u.$$.fragment),f=I(),p=y("fieldset"),b=y("legend"),b.textContent="Patterns",d=I();for(let _=0;_<D.length;_+=1)D[_].c();L=I(),v=y("fieldset"),B=y("legend"),B.textContent="Groups",R=I();for(let _=0;_<q.length;_+=1)q[_].c();h(e,"class","samples svelte-1oj1ab1"),h(b,"class","svelte-1oj1ab1"),h(p,"class","svelte-1oj1ab1"),h(B,"class","svelte-1oj1ab1"),h(v,"class","svelte-1oj1ab1")},m(_,S){T(_,e,S),g(e,n),g(n,l),g(n,o),g(n,i);for(let G=0;G<a.length;G+=1)a[G].m(i,null);g(e,s),de(r,e,null),T(_,c,S),de(u,_,S),T(_,f,S),T(_,p,S),g(p,b),g(p,d);for(let G=0;G<D.length;G+=1)D[G].m(p,null);T(_,L,S),T(_,v,S),g(v,B),g(v,R);for(let G=0;G<q.length;G+=1)q[G].m(v,null);F=!0},p(_,S){if(S&17){C=ke;let w;for(w=0;w<C.length;w+=1){const K=st(_,C,w);a[w]?(a[w].p(K,S),J(a[w],1)):(a[w]=rt(K),a[w].c(),J(a[w],1),a[w].m(i,null))}for(Ae(),w=C.length;w<a.length;w+=1)E(w);Te()}const G={};S&1&&(G.files=_[0]),r.$set(G);const X={};if(S&2&&(X.bpm=_[1]),S&4&&(X.quantize=_[2]),u.$set(X),S&16){z=ye;let w;for(w=0;w<z.length;w+=1){const K=ot(_,z,w);D[w]?(D[w].p(K,S),J(D[w],1)):(D[w]=ut(K),D[w].c(),J(D[w],1),D[w].m(p,null))}for(Ae(),w=z.length;w<D.length;w+=1)ne(w);Te()}if(S&16){P=te;let w;for(w=0;w<P.length;w+=1){const K=lt(_,P,w);q[w]?(q[w].p(K,S),J(q[w],1)):(q[w]=ct(K),q[w].c(),J(q[w],1),q[w].m(v,null))}for(Ae(),w=P.length;w<q.length;w+=1)N(w);Te()}},i(_){if(!F){for(let S=0;S<C.length;S+=1)J(a[S]);J(r.$$.fragment,_),J(u.$$.fragment,_);for(let S=0;S<z.length;S+=1)J(D[S]);for(let S=0;S<P.length;S+=1)J(q[S]);F=!0}},o(_){a=a.filter(Boolean);for(let S=0;S<a.length;S+=1)$(a[S]);$(r.$$.fragment,_),$(u.$$.fragment,_),D=D.filter(Boolean);for(let S=0;S<D.length;S+=1)$(D[S]);q=q.filter(Boolean);for(let S=0;S<q.length;S+=1)$(q[S]);F=!1},d(_){_&&M(e),ie(a,_),he(r),_&&M(c),he(u,_),_&&M(f),_&&M(p),ie(D,_),_&&M(L),_&&M(v),ie(q,_)}}}function rt(t){let e,n;return e=new Ut({props:{sample:t[15],groups:te,monome:t[3],files:t[0]}}),{c(){_e(e.$$.fragment)},m(l,o){de(e,l,o),n=!0},p(l,o){const i={};o&1&&(i.files=l[0]),e.$set(i)},i(l){n||(J(e.$$.fragment,l),n=!0)},o(l){$(e.$$.fragment,l),n=!1},d(l){he(e,l)}}}function ut(t){let e,n;return e=new sn({props:{pattern:t[12],monome:t[3]}}),{c(){_e(e.$$.fragment)},m(l,o){de(e,l,o),n=!0},p:j,i(l){n||(J(e.$$.fragment,l),n=!0)},o(l){$(e.$$.fragment,l),n=!1},d(l){he(e,l)}}}function ct(t){let e,n;return e=new $t({props:{monome:t[3],group:t[9]}}),{c(){_e(e.$$.fragment)},m(l,o){de(e,l,o),n=!0},p:j,i(l){n||(J(e.$$.fragment,l),n=!0)},o(l){$(e.$$.fragment,l),n=!1},d(l){he(e,l)}}}function cn(t){return{c:j,m:j,p:j,i:j,o:j,d:j}}function an(t){let e,n,l,o,i,s,r=!t[3]&&it(t),c={ctx:t,current:null,token:null,hasCatch:!1,pending:cn,then:un,catch:rn,value:3,blocks:[,,,]};return Lt(t[4].promise,c),{c(){e=y("header"),n=y("h1"),n.textContent=`svemlr v${Dt}`,l=I(),o=y("main"),r&&r.c(),i=I(),c.block.c(),h(n,"class","svelte-1oj1ab1")},m(u,f){T(u,e,f),g(e,n),T(u,l,f),T(u,o,f),r&&r.m(o,null),g(o,i),c.block.m(o,c.anchor=null),c.mount=()=>o,c.anchor=null,s=!0},p(u,[f]){t=u,t[3]?r&&(r.d(1),r=null):r?r.p(t,f):(r=it(t),r.c(),r.m(o,i)),St(c,t,f)},i(u){s||(J(c.block),s=!0)},o(u){for(let f=0;f<3;f+=1){const p=c.blocks[f];$(p)}s=!1},d(u){u&&M(e),u&&M(l),u&&M(o),r&&r.d(),c.block.d(),c.token=null,c=null}}}function fn(){alert("could not connect to monome grid. please use a chromium browser and disable serialosc.")}function pn(t,e,n){const l=He("audioContext");let{router:o={}}=e,{files:i={}}=e,{bpm:s={}}=e,{quantize:r={}}=e,{scheduler:c={}}=e,u;const f=At();async function p(){l.resume();try{n(3,u=await qt.connect());const{x:b,y:d}=await Ke(u);Me(4,It,te,{audioContext:l}),Me(d-1,Pt,ke,{audioContext:l,group:te[0],stepCount:b,bpm:s,scheduler:c}),Me(2,Nt,ye,{bpm:s,scheduler:c,router:o}),o.start(u),f.resolve(u)}catch{fn()}}return t.$$set=b=>{"router"in b&&n(6,o=b.router),"files"in b&&n(0,i=b.files),"bpm"in b&&n(1,s=b.bpm),"quantize"in b&&n(2,r=b.quantize),"scheduler"in b&&n(7,c=b.scheduler)},[i,s,r,u,f,p,o,c]}class _n extends ue{constructor(e){super();ce(this,e,pn,an,ae,{router:6,files:0,bpm:1,quantize:2,scheduler:7})}}const at=[];let Oe=me(16,()=>me(16,0));function Ce(t,e){at.push({matcher:t,handler:e})}async function dn(t){t.on("gridKeyDown",({x:l,y:o})=>De({x:l,y:o,state:1,source:"press"})),t.on("gridKeyUp",({x:l,y:o})=>De({x:l,y:o,state:0,source:"press"}));const{x:e,y:n}=await Ke(t);Oe=me(n,()=>me(e,0))}function De({x:t,y:e,state:n,source:l}){l==="press"&&(Oe[e][t]=Number(n));const o=hn(t,e,n,l);if(!o)return;const i={x:t,y:e,state:n,grid:Oe};Array.isArray(o.handler)?o.handler.forEach(s=>s(i)):o.handler(i)}function hn(t,e,n,l){return at.find(({matcher:o})=>o({x:t,y:e,state:n,source:l}))}var mn=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",route:Ce,start:dn,handle:De}),ft={loop:({x:t,y:e,grid:n})=>{const l=ke[e-1],o=n[e].reduce((i,s,r)=>s?i.concat(r):i,[]);o.length===1?(l.resetLoopPoints(),l.start(t)):o.length===2&&l.loopBetween(o)},replay({x:t,y:e}){const n=ke[e-1];n.resetLoopPoints(),n.start(t)}},gn={change:({x:t,state:e,grid:n})=>{const l=n[0].reduce((s,r,c)=>r?s.concat(c):s,[]),o=l.includes(n[0].length-2),i=l.includes(n[0].length-1);e?o&&i?te[t].toggleMute():o?te[t].startDecreasingLevel():i?te[t].startIncreasingLevel():te[t].stop():(te[t].stopDecreasingLevel(),te[t].stopIncreasingLevel())}},pt={record:({x:t,y:e,state:n})=>{ye.forEach(l=>l.record({x:t,y:e,state:n}))},toggle:({x:t})=>{const e=te.length,n=t-e;ye[n].toggle()}};Ce(({y:t,state:e,source:n})=>t>0&&n==="press"&&e,[ft.loop,pt.record]);Ce(({y:t,state:e,source:n})=>t>0&&n==="pattern"&&e,[ft.replay]);Ce(({x:t,y:e})=>e===0&&t<4,gn.change);Ce(({x:t,y:e,state:n})=>e==0&&(t==4||t==5)&&n,pt.toggle);const{subscribe:bn,update:vn}=U([]);function kn(t=[]){t=[...t],vn(e=>Mt([...e,...t],n=>n.name))}const yn={subscribe:bn,add:kn},Ie=U(120),Be=U(16);function Cn({audioContext:t,bpm:e,quantize:n}){let l=new Et(t),o=[],i=!1,s;function r(){const d=p(e,n);l.start(),s=l.setTimeout(f,d).repeat(d),i=!0}function c(){!i||(s.clear(),s=null,l.stop(),i=!1)}function u(d,L=[],v={}){if(v.in!=null){let B=l.setTimeout(()=>d.apply(null,L),v.in);return v.repeat&&(B=B.repeat(v.repeat)),B}else o.push({fn:d,args:L})}function f(){for(;o.length;){const{fn:d,args:L}=o.shift();d.apply(null,L)}}function p(d,L){return 60/d/L}function b(d){!i||l.timeStretch(t.currentTime,[s],d)}return{start:r,stop:c,schedule:u,set bpm(d){b(e/d),e=d},set quantize(d){b(n/d),n=d}}}const _t=new AudioContext,qe=Cn({audioContext:_t,bpm:we(Ie),quantize:we(Be)});qe.start();Ie.subscribe(t=>qe.bpm=t);Be.subscribe(t=>qe.quantize=t);new _n({target:document.getElementById("app"),props:{router:mn,files:yn,bpm:Ie,quantize:Be,scheduler:qe},context:new Map([["audioContext",_t]])});
