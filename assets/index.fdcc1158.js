var ht=Object.defineProperty,mt=Object.defineProperties;var gt=Object.getOwnPropertyDescriptors;var Fe=Object.getOwnPropertySymbols;var bt=Object.prototype.hasOwnProperty,vt=Object.prototype.propertyIsEnumerable;var Pe=(t,e,n)=>e in t?ht(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ae=(t,e)=>{for(var n in e||(e={}))bt.call(e,n)&&Pe(t,n,e[n]);if(Fe)for(var n of Fe(e))vt.call(e,n)&&Pe(t,n,e[n]);return t},Re=(t,e)=>mt(t,gt(e));import{S as re,i as ue,s as ce,e as C,t as W,a as D,b as T,c as g,d as me,f as M,g as h,h as He,j as Ce,l as G,n as I,k as oe,m as we,o as Ie,p as kt,q as yt,r as ge,u as pe,v as _e,w as ne,x as Ct,y as J,z as x,A as de,B as be,C as Ne,D as $,E as ae,F as Oe,G as Ge,H as Ve,I as ee,J as Z,K as wt,L as St,M as qt,N as Ee,O as Te,P as Lt,Q as zt,R as je}from"./vendor.9af8797c.js";const At=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}};At();function Se(t,e){const n=[];for(let l=0;l<t;l++)n[l]=typeof e=="function"?e(l):e;return n}function Ot(t,e){const n=[];let l=0;const s=t.length;for(;l<s;)n.push(t.slice(l,l+=e));return n}function Et(t,e){return t.reduce((n,l)=>{const s=e(l);return n.find(o=>e(o)===s)||n.push(l),n},[])}function Me(t,e,n,l){return Se(t,s=>{const o=e(Ae({id:s},l));return n.push(o),o}),n}function Tt(){let t=function(n){};return{promise:new Promise(n=>t=n),resolve:t}}const Ke=new FileReader;function Mt(t,e){return new Promise(n=>{Ke.readAsArrayBuffer(t),Ke.onload=async({target:{result:l}})=>{n(await e.decodeAudioData(l))}})}function Bt(t){const e=new AudioBuffer({sampleRate:t.sampleRate,numberOfChannels:t.numberOfChannels,length:t.length});for(let l=0;l<t.numberOfChannels;l++){const s=t.getChannelData(l),o=e.getChannelData(l);for(var n=t.length-1;n>=0;n--)o[t.length-n-1]=s[n]}return e}function Dt(t,e,n){const l=e.createBufferSource();t&&(l.buffer=t);const{loopStart:s,loopEnd:o,loop:i,speed:r}=n;return l.loop=!!i,s!=null&&(l.loopStart=s),o!=null&&(l.loopEnd=o),r!=null&&(l.playbackRate.value=r),l}function Ft(t,e,n){const l=8;Ot(n,l).forEach((o,i)=>t.gridLedRow(i*l,e,o))}function Ue(t,e,n){const l=t.slice();return l[4]=e[n],l}function Ze(t){let e,n=t[4].name+"",l,s,o;return{c(){e=C("option"),l=W(n),s=D(),e.__value=o=t[4],e.value=e.__value},m(i,r){T(i,e,r),g(e,l),g(e,s)},p(i,r){r&4&&n!==(n=i[4].name+"")&&me(l,n),r&4&&o!==(o=i[4])&&(e.__value=o,e.value=e.__value)},d(i){i&&M(e)}}}function Pt(t){let e,n,l,s=t[2],o=[];for(let i=0;i<s.length;i+=1)o[i]=Ze(Ue(t,s,i));return{c(){e=C("select");for(let i=0;i<o.length;i+=1)o[i].c();h(e,"class","svelte-1hx4o8j"),t[0]===void 0&&He(()=>t[3].call(e))},m(i,r){T(i,e,r);for(let c=0;c<o.length;c+=1)o[c].m(e,null);Ce(e,t[0]),n||(l=G(e,"change",t[3]),n=!0)},p(i,[r]){if(r&4){s=i[2];let c;for(c=0;c<s.length;c+=1){const u=Ue(i,s,c);o[c]?o[c].p(u,r):(o[c]=Ze(u),o[c].c(),o[c].m(e,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=s.length}r&5&&Ce(e,i[0])},i:I,o:I,d(i){i&&M(e),oe(o,i),n=!1,l()}}}function Rt(t,e,n){let l,s=I,o=()=>(s(),s=we(i,u=>n(2,l=u)),i);t.$$.on_destroy.push(()=>s());let{files:i}=e;o();let{selected:r}=e;function c(){r=Ie(this),n(0,r)}return t.$$set=u=>{"files"in u&&o(n(1,i=u.files)),"selected"in u&&n(0,r=u.selected)},[r,i,l,c]}class Ht extends re{constructor(e){super();ue(this,e,Rt,Pt,ce,{files:1,selected:0})}}function Qe(t,e,n){const l=t.slice();return l[34]=e[n],l}function Je(t,e,n){const l=t.slice();return l[37]=e[n],l[39]=n,l}function We(t){let e,n,l,s,o,i,r;function c(){return t[25](t[39])}return{c(){e=C("input"),h(e,"name",n="sample_"+t[11]+"_step"),h(e,"type","radio"),e.value=l=t[39],e.checked=s=t[3]==t[39],e.disabled=o=!t[37].enabled,h(e,"autocomplete","off")},m(u,a){T(u,e,a),i||(r=G(e,"click",ge(c)),i=!0)},p(u,a){t=u,a[0]&8&&s!==(s=t[3]==t[39])&&(e.checked=s),a[0]&16&&o!==(o=!t[37].enabled)&&(e.disabled=o)},d(u){u&&M(e),i=!1,r()}}}function Xe(t){let e,n,l,s,o;return{c(){e=C("input"),h(e,"name",n="sample_"+t[11]+"_group"),h(e,"type","radio"),e.__value=l=t[34],e.value=e.__value,h(e,"autocomplete","off"),t[31][0].push(e)},m(i,r){T(i,e,r),e.checked=e.__value===t[10],s||(o=G(e,"change",t[30]),s=!0)},p(i,r){r[0]&1&&l!==(l=i[34])&&(e.__value=l,e.value=e.__value),r[0]&1024&&(e.checked=e.__value===i[10])},d(i){i&&M(e),t[31][0].splice(t[31][0].indexOf(e),1),s=!1,o()}}}function It(t){let e,n,l,s,o,i,r,c,u,a,p,w,m=(t[7]>=0?"+":"")+"",b,v,F,P,V,q,f,z,O=t[8].toFixed(2)+"",B,te,R,L,H,_,S,j,X,y,K,le;function fe(k){t[24](k)}let se={files:t[1]};t[2]!==void 0&&(se.selected=t[2]),l=new Ht({props:se}),kt.push(()=>yt(l,"selected",fe));let E=t[4],U=[];for(let k=0;k<E.length;k+=1)U[k]=We(Je(t,E,k));let d=t[0],A=[];for(let k=0;k<d.length;k+=1)A[k]=Xe(Qe(t,d,k));return{c(){e=C("tr"),n=C("td"),pe(l.$$.fragment),o=D(),i=C("td"),r=C("div");for(let k=0;k<U.length;k+=1)U[k].c();c=D(),u=C("input"),a=D(),p=C("td"),w=C("span"),b=W(m),v=W(t[7]),F=D(),P=C("button"),P.textContent="-",V=D(),q=C("button"),q.textContent="+",f=D(),z=C("td"),B=W(O),te=D(),R=C("td"),L=C("input"),H=D(),_=C("label"),S=W("Rev"),j=D(),X=C("td");for(let k=0;k<A.length;k+=1)A[k].c();h(n,"class","svelte-2kpfy0"),h(u,"type","range"),h(u,"min","1"),h(u,"max",t[5]),h(u,"step","1"),h(u,"class","svelte-2kpfy0"),h(i,"class","svelte-2kpfy0"),h(P,"aria-label","Decrement octave"),h(q,"aria-label","Increment octave"),h(p,"class","svelte-2kpfy0"),h(z,"class","svelte-2kpfy0"),h(L,"id","sample_"+t[11]+"_reverse"),h(L,"type","checkbox"),h(_,"for","sample_"+t[11]+"_reverse"),h(R,"class","svelte-2kpfy0"),h(X,"class","svelte-2kpfy0")},m(k,Q){T(k,e,Q),g(e,n),_e(l,n,null),g(e,o),g(e,i),g(i,r);for(let Y=0;Y<U.length;Y+=1)U[Y].m(r,null);g(i,c),g(i,u),ne(u,t[6]),g(e,a),g(e,p),g(p,w),g(w,b),g(w,v),g(p,F),g(p,P),g(p,V),g(p,q),g(e,f),g(e,z),g(z,B),g(e,te),g(e,R),g(R,L),L.checked=t[9],g(R,H),g(R,_),g(_,S),g(e,j),g(e,X);for(let Y=0;Y<A.length;Y+=1)A[Y].m(X,null);y=!0,K||(le=[G(u,"change",t[26]),G(u,"input",t[26]),G(P,"click",t[27]),G(q,"click",t[28]),G(L,"change",t[29])],K=!0)},p(k,Q){const Y={};if(Q[0]&2&&(Y.files=k[1]),!s&&Q[0]&4&&(s=!0,Y.selected=k[2],Ct(()=>s=!1)),l.$set(Y),Q[0]&1050648){E=k[4];let N;for(N=0;N<E.length;N+=1){const ie=Je(k,E,N);U[N]?U[N].p(ie,Q):(U[N]=We(ie),U[N].c(),U[N].m(r,null))}for(;N<U.length;N+=1)U[N].d(1);U.length=E.length}if((!y||Q[0]&32)&&h(u,"max",k[5]),Q[0]&64&&ne(u,k[6]),(!y||Q[0]&128)&&m!==(m=(k[7]>=0?"+":"")+"")&&me(b,m),(!y||Q[0]&128)&&me(v,k[7]),(!y||Q[0]&256)&&O!==(O=k[8].toFixed(2)+"")&&me(B,O),Q[0]&512&&(L.checked=k[9]),Q[0]&3073){d=k[0];let N;for(N=0;N<d.length;N+=1){const ie=Qe(k,d,N);A[N]?A[N].p(ie,Q):(A[N]=Xe(ie),A[N].c(),A[N].m(X,null))}for(;N<A.length;N+=1)A[N].d(1);A.length=d.length}},i(k){y||(J(l.$$.fragment,k),y=!0)},o(k){x(l.$$.fragment,k),y=!1},d(k){k&&M(e),de(l),oe(U,k),oe(A,k),K=!1,be(le)}}}function Nt(t,e,n){let l,s,o,i,r,c,u,a,p,w;const m=Ne("audioContext");let{sample:b={}}=e,{id:v,steps:F,enabledStepCount:P,currentStep:V,octave:q,speed:f,reverse:z,buffer:O,group:B,start:te}=b;$(t,F,E=>n(4,r=E)),$(t,P,E=>n(6,c=E)),$(t,V,E=>n(3,i=E)),$(t,q,E=>n(7,u=E)),$(t,f,E=>n(8,a=E)),$(t,z,E=>n(9,p=E)),$(t,O,E=>n(32,o=E)),$(t,B,E=>n(10,w=E));let{groups:R=[]}=e,{monome:L={}}=e,{files:H={}}=e,_;const S=[[]];function j(E){_=E,n(2,_)}const X=E=>te(E);function y(){c=ae(this.value),P.set(c)}const K=()=>Oe(q,--u,u),le=()=>Oe(q,++u,u);function fe(){p=this.checked,z.set(p)}function se(){w=this.__value,B.set(w)}return t.$$set=E=>{"sample"in E&&n(21,b=E.sample),"groups"in E&&n(0,R=E.groups),"monome"in E&&n(22,L=E.monome),"files"in E&&n(1,H=E.files)},t.$$.update=()=>{t.$$.dirty[0]&16&&n(5,l=r.length),t.$$.dirty[0]&12582936&&Ft(L,s,r.map((E,U)=>U===i)),t.$$.dirty[0]&4&&_&&Mt(_,m).then(E=>Oe(O,o=E,o))},n(23,s=v+1),[R,H,_,i,r,l,c,u,a,p,w,v,F,P,V,q,f,z,O,B,te,b,L,s,j,X,y,K,le,fe,se,S]}class Gt extends re{constructor(e){super();ue(this,e,Nt,It,ce,{sample:21,groups:0,monome:22,files:1},null,[-1,-1])}}function Ye(t,e,n){const l=t.slice();return l[8]=e[n].name,l}function xe(t){let e,n=t[3],l=[];for(let s=0;s<n.length;s+=1)l[s]=$e(Ye(t,n,s));return{c(){e=C("ul");for(let s=0;s<l.length;s+=1)l[s].c();h(e,"class","svelte-1eckyqf")},m(s,o){T(s,e,o);for(let i=0;i<l.length;i+=1)l[i].m(e,null)},p(s,o){if(o&8){n=s[3];let i;for(i=0;i<n.length;i+=1){const r=Ye(s,n,i);l[i]?l[i].p(r,o):(l[i]=$e(r),l[i].c(),l[i].m(e,null))}for(;i<l.length;i+=1)l[i].d(1);l.length=n.length}},d(s){s&&M(e),oe(l,s)}}}function $e(t){let e,n,l,s,o=t[8]+"",i,r;return{c(){e=C("li"),n=Ge("svg"),l=Ge("path"),s=D(),i=W(o),r=D(),h(l,"d","M3.5 2C3.22386 2 3 2.22386 3 2.5V12.5C3 12.7761 3.22386 13 3.5 13H11.5C11.7761 13 12 12.7761 12 12.5V6H8.5C8.22386 6 8 5.77614 8 5.5V2H3.5ZM9 2.70711L11.2929 5H9V2.70711ZM2 2.5C2 1.67157 2.67157 1 3.5 1H8.5C8.63261 1 8.75979 1.05268 8.85355 1.14645L12.8536 5.14645C12.9473 5.24021 13 5.36739 13 5.5V12.5C13 13.3284 12.3284 14 11.5 14H3.5C2.67157 14 2 13.3284 2 12.5V2.5Z"),h(l,"fill","currentColor"),h(l,"fill-rule","evenodd"),h(l,"clip-rule","evenodd"),h(n,"width","15"),h(n,"height","15"),h(n,"viewBox","0 0 15 15"),h(n,"fill","none"),h(n,"xmlns","http://www.w3.org/2000/svg"),h(n,"class","svelte-1eckyqf"),h(e,"class","svelte-1eckyqf")},m(c,u){T(c,e,u),g(e,n),g(n,l),g(e,s),g(e,i),g(e,r)},p(c,u){u&8&&o!==(o=c[8]+"")&&me(i,o)},d(c){c&&M(e)}}}function Vt(t){let e,n,l,s,o,i,r,c,u=t[3].length&&xe(t);return{c(){e=C("section"),n=C("label"),n.textContent="Audio file drop",l=D(),s=C("div"),o=C("input"),i=D(),u&&u.c(),h(n,"for","files"),h(o,"accept","audio/*"),h(o,"id","files"),h(o,"name","files"),h(o,"type","file"),h(o,"class","svelte-1eckyqf"),h(s,"class","file-drop svelte-1eckyqf"),Ve(s,"dragover",t[2]),h(e,"class","svelte-1eckyqf")},m(a,p){T(a,e,p),g(e,n),g(e,l),g(e,s),g(s,o),g(s,i),u&&u.m(s,null),r||(c=[G(o,"change",t[5]),G(s,"dragover",ge(t[6])),G(s,"dragleave",ge(t[7])),G(s,"drop",ge(t[4]))],r=!0)},p(a,[p]){a[3].length?u?u.p(a,p):(u=xe(a),u.c(),u.m(s,null)):u&&(u.d(1),u=null),p&4&&Ve(s,"dragover",a[2])},i:I,o:I,d(a){a&&M(e),u&&u.d(),r=!1,be(c)}}}function jt(t){return t.reduce((e,n)=>{if(n.kind==="file"){const l=n.getAsFile();/^(audio|video)/.test(l.type)&&e.push(l)}return e},[])}function Kt(t,e,n){let l,s=I,o=()=>(s(),s=we(i,m=>n(3,l=m)),i);t.$$.on_destroy.push(()=>s());let{files:i}=e;o();let r,c=!1;function u({dataTransfer:m}){n(2,c=!1),i.add(jt([...m.items]))}function a(){r=this.files,n(1,r)}const p=()=>n(2,c=!0),w=()=>n(2,c=!1);return t.$$set=m=>{"files"in m&&o(n(0,i=m.files))},t.$$.update=()=>{t.$$.dirty&3&&i.add(r)},[i,r,c,l,u,a,p,w]}class Ut extends re{constructor(e){super();ue(this,e,Kt,Vt,ce,{files:0})}}function Zt(t){let e,n,l,s,o,i,r,c,u,a,p,w,m,b,v;return{c(){e=C("div"),n=C("label"),l=C("input"),o=W(`
    On/Off`),i=D(),r=C("label"),c=C("input"),u=W(`
    Mute`),a=D(),p=C("label"),w=W(`Level
    `),m=C("input"),h(l,"type","checkbox"),l.disabled=s=!t[0],h(n,"class","svelte-37acoc"),h(c,"type","checkbox"),h(r,"class","svelte-37acoc"),h(m,"type","range"),h(m,"min","0"),h(m,"max","1"),h(m,"step","0.01"),h(p,"class","svelte-37acoc")},m(F,P){T(F,e,P),g(e,n),g(n,l),l.checked=t[0],g(n,o),g(e,i),g(e,r),g(r,c),c.checked=t[1],g(r,u),g(e,a),g(e,p),g(p,w),g(p,m),ne(m,t[2]),b||(v=[G(l,"change",t[8]),G(c,"change",t[9]),G(m,"change",t[10]),G(m,"input",t[10])],b=!0)},p(F,[P]){P&1&&s!==(s=!F[0])&&(l.disabled=s),P&1&&(l.checked=F[0]),P&2&&(c.checked=F[1]),P&4&&ne(m,F[2])},i:I,o:I,d(F){F&&M(e),b=!1,be(v)}}}function Qt(t,e,n){let l,s,o,{group:i={}}=e,{monome:r}=e,{id:c,active:u,muted:a,level:p}=i;$(t,u,v=>n(0,l=v)),$(t,a,v=>n(1,s=v)),$(t,p,v=>n(2,o=v));function w(){l=this.checked,u.set(l)}function m(){s=this.checked,a.set(s)}function b(){o=ae(this.value),p.set(o)}return t.$$set=v=>{"group"in v&&n(6,i=v.group),"monome"in v&&n(7,r=v.monome)},t.$$.update=()=>{t.$$.dirty&65&&(l||i.stop()),t.$$.dirty&129&&r.gridLed(c,0,l)},[l,s,o,u,a,p,i,r,w,m,b]}class Jt extends re{constructor(e){super();ue(this,e,Qt,Zt,ce,{group:6,monome:7})}}function et(t,e,n){const l=t.slice();return l[12]=e[n],l}function tt(t){let e,n,l=t[12]+"",s,o;return{c(){e=C("option"),n=W("1/"),s=W(l),e.__value=o=t[12],e.value=e.__value},m(i,r){T(i,e,r),g(e,n),g(e,s)},p:I,d(i){i&&M(e)}}}function Wt(t){let e,n,l,s,o,i,r,c,u,a,p,w,m,b,v,F,P,V=t[4],q=[];for(let f=0;f<V.length;f+=1)q[f]=tt(et(t,V,f));return{c(){e=C("label"),e.textContent="Tempo",n=D(),l=C("input"),s=D(),o=C("button"),o.textContent="-4",i=D(),r=C("button"),r.textContent="-1",c=D(),u=C("button"),u.textContent="+1",a=D(),p=C("button"),p.textContent="+4",w=D(),m=C("label"),m.textContent="Quantize",b=D(),v=C("select");for(let f=0;f<q.length;f+=1)q[f].c();h(e,"for","tempo"),h(l,"type","number"),h(l,"id","tempo"),h(l,"size","6"),h(l,"class","svelte-1texyt4"),h(m,"for","quantize"),h(v,"name","quantize"),h(v,"id","quantize"),t[3]===void 0&&He(()=>t[11].call(v))},m(f,z){T(f,e,z),T(f,n,z),T(f,l,z),ne(l,t[2]),T(f,s,z),T(f,o,z),T(f,i,z),T(f,r,z),T(f,c,z),T(f,u,z),T(f,a,z),T(f,p,z),T(f,w,z),T(f,m,z),T(f,b,z),T(f,v,z);for(let O=0;O<q.length;O+=1)q[O].m(v,null);Ce(v,t[3]),F||(P=[G(l,"input",t[6]),G(o,"click",t[7]),G(r,"click",t[8]),G(u,"click",t[9]),G(p,"click",t[10]),G(v,"change",t[11])],F=!0)},p(f,[z]){if(z&4&&ae(l.value)!==f[2]&&ne(l,f[2]),z&16){V=f[4];let O;for(O=0;O<V.length;O+=1){const B=et(f,V,O);q[O]?q[O].p(B,z):(q[O]=tt(B),q[O].c(),q[O].m(v,null))}for(;O<q.length;O+=1)q[O].d(1);q.length=V.length}z&24&&Ce(v,f[3])},i:I,o:I,d(f){f&&M(e),f&&M(n),f&&M(l),f&&M(s),f&&M(o),f&&M(i),f&&M(r),f&&M(c),f&&M(u),f&&M(a),f&&M(p),f&&M(w),f&&M(m),f&&M(b),f&&M(v),oe(q,f),F=!1,be(P)}}}function Xt(t,e,n){let l,s=I,o=()=>(s(),s=we(u,q=>n(2,l=q)),u),i,r=I,c=()=>(r(),r=we(a,q=>n(3,i=q)),a);t.$$.on_destroy.push(()=>s()),t.$$.on_destroy.push(()=>r());let{bpm:u}=e;o();let{quantize:a}=e;c();const p=[128,64,32,16,8,4,2];function w(q){u.update(f=>f+q)}function m(){l=ae(this.value),u.set(l)}const b=()=>w(-4),v=()=>w(-1),F=()=>w(1),P=()=>w(4);function V(){i=Ie(this),a.set(i),n(4,p)}return t.$$set=q=>{"bpm"in q&&o(n(0,u=q.bpm)),"quantize"in q&&c(n(1,a=q.quantize))},[u,a,l,i,p,w,m,b,v,F,P,V]}class Yt extends re{constructor(e){super();ue(this,e,Xt,Wt,ce,{bpm:0,quantize:1})}}const he=[];function xt({id:t,audioContext:e}){let n;const l=e.createGain();l.connect(e.destination);const s=Z(!1),o=Z(1),i=Z(!1);ee([o,i],([a,p])=>p?0:a).subscribe(a=>l.gain.value=a);function c(a,p){return u(),n=a,a.connect(l),a.start(0,p),s.set(!0),a}function u(){n==null||n.stop(),s.set(!1)}return{id:t,level:o,muted:i,active:s,play:c,stop:u}}function $t(t){let e,n,l,s,o,i,r,c,u,a,p,w,m;return{c(){e=C("div"),n=C("label"),l=C("input"),s=W(`
    On/Off`),o=D(),i=C("label"),r=W(`Length
    `),c=C("input"),u=D(),a=C("input"),p=W(`
    beats`),h(l,"id","pattern_"+t[2]+"_active"),h(l,"name","pattern_"+t[2]+"_active"),h(l,"type","checkbox"),l.checked=t[0],h(n,"class","svelte-37acoc"),h(c,"type","range"),h(c,"min","1"),h(c,"max","32"),h(a,"type","number"),h(a,"min","1"),h(a,"max","32"),h(i,"class","svelte-37acoc")},m(b,v){T(b,e,v),g(e,n),g(n,l),g(n,s),g(e,o),g(e,i),g(i,r),g(i,c),ne(c,t[1]),g(i,u),g(i,a),ne(a,t[1]),g(i,p),w||(m=[G(l,"change",ge(t[4])),G(c,"change",t[8]),G(c,"input",t[8]),G(a,"input",t[9])],w=!0)},p(b,[v]){v&1&&(l.checked=b[0]),v&2&&ne(c,b[1]),v&2&&ae(a.value)!==b[1]&&ne(a,b[1])},i:I,o:I,d(b){b&&M(e),w=!1,be(m)}}}function en(t,e,n){let l,s,{pattern:o={}}=e,{monome:i}=e,{id:r,active:c,toggle:u,length:a}=o;$(t,c,b=>n(0,l=b)),$(t,a,b=>n(1,s=b));const p=r+he.length;o.onactivity=()=>{i.gridLed(p,0,0),setTimeout(()=>l&&i.gridLed(p,0,1),50)};function w(){s=ae(this.value),a.set(s)}function m(){s=ae(this.value),a.set(s)}return t.$$set=b=>{"pattern"in b&&n(6,o=b.pattern),"monome"in b&&n(7,i=b.monome)},t.$$.update=()=>{t.$$.dirty&129&&i.gridLed(p,0,l)},[l,s,r,c,u,a,o,i,w,m]}class tn extends re{constructor(e){super();ue(this,e,en,$t,ce,{pattern:6,monome:7})}}function nt(t,e,n){const l=t.slice();return l[11]=e[n],l}function lt(t,e,n){const l=t.slice();return l[14]=e[n],l}function st(t,e,n){const l=t.slice();return l[17]=e[n],l}function ot(t){let e,n,l,s,o,i,r,c,u;return{c(){e=C("p"),e.innerHTML="Before you start, svemlr requires that <strong>serialosc is disabled</strong>. On macOS open Terminal and execute:",n=D(),l=C("pre"),l.innerHTML='<code class="svelte-lgrb9r">launchctl unload /Library/LaunchAgents/org.monome.serialosc.plist</code>',s=D(),o=C("p"),o.innerHTML='To re-enable: <code class="svelte-lgrb9r">launchctl load /Library/LaunchAgents/org.monome.serialosc.plist</code>',i=D(),r=C("button"),r.textContent="Connect",h(l,"class","svelte-lgrb9r")},m(a,p){T(a,e,p),T(a,n,p),T(a,l,p),T(a,s,p),T(a,o,p),T(a,i,p),T(a,r,p),c||(u=G(r,"click",t[8]),c=!0)},p:I,d(a){a&&M(e),a&&M(n),a&&M(l),a&&M(s),a&&M(o),a&&M(i),a&&M(r),c=!1,u()}}}function nn(t){return{c:I,m:I,p:I,i:I,o:I,d:I}}function ln(t){let e,n,l,s,o,i,r,c,u,a,p,w,m,b,v,F,P,V,q=t[4],f=[];for(let _=0;_<q.length;_+=1)f[_]=it(st(t,q,_));const z=_=>x(f[_],1,1,()=>{f[_]=null});r=new Ut({props:{files:t[0]}}),u=new Yt({props:{bpm:t[1],quantize:t[2]}});let O=t[5],B=[];for(let _=0;_<O.length;_+=1)B[_]=rt(lt(t,O,_));const te=_=>x(B[_],1,1,()=>{B[_]=null});let R=t[3],L=[];for(let _=0;_<R.length;_+=1)L[_]=ut(nt(t,R,_));const H=_=>x(L[_],1,1,()=>{L[_]=null});return{c(){e=C("section"),n=C("table"),l=C("thead"),l.innerHTML=`<th>File</th> 
					<th></th> 
					<th>Octave</th> 
					<th>Speed</th> 
					<th></th> 
					<th>Group</th>`,s=D(),o=C("tbody");for(let _=0;_<f.length;_+=1)f[_].c();i=D(),pe(r.$$.fragment),c=D(),pe(u.$$.fragment),a=D(),p=C("fieldset"),w=C("legend"),w.textContent="Patterns",m=D();for(let _=0;_<B.length;_+=1)B[_].c();b=D(),v=C("fieldset"),F=C("legend"),F.textContent="Groups",P=D();for(let _=0;_<L.length;_+=1)L[_].c();h(e,"class","samples svelte-lgrb9r"),h(w,"class","svelte-lgrb9r"),h(p,"class","svelte-lgrb9r"),h(F,"class","svelte-lgrb9r"),h(v,"class","svelte-lgrb9r")},m(_,S){T(_,e,S),g(e,n),g(n,l),g(n,s),g(n,o);for(let j=0;j<f.length;j+=1)f[j].m(o,null);g(e,i),_e(r,e,null),T(_,c,S),_e(u,_,S),T(_,a,S),T(_,p,S),g(p,w),g(p,m);for(let j=0;j<B.length;j+=1)B[j].m(p,null);T(_,b,S),T(_,v,S),g(v,F),g(v,P);for(let j=0;j<L.length;j+=1)L[j].m(v,null);V=!0},p(_,S){if(S&153){q=_[4];let y;for(y=0;y<q.length;y+=1){const K=st(_,q,y);f[y]?(f[y].p(K,S),J(f[y],1)):(f[y]=it(K),f[y].c(),J(f[y],1),f[y].m(o,null))}for(Ee(),y=q.length;y<f.length;y+=1)z(y);Te()}const j={};S&1&&(j.files=_[0]),r.$set(j);const X={};if(S&2&&(X.bpm=_[1]),S&4&&(X.quantize=_[2]),u.$set(X),S&160){O=_[5];let y;for(y=0;y<O.length;y+=1){const K=lt(_,O,y);B[y]?(B[y].p(K,S),J(B[y],1)):(B[y]=rt(K),B[y].c(),J(B[y],1),B[y].m(p,null))}for(Ee(),y=O.length;y<B.length;y+=1)te(y);Te()}if(S&136){R=_[3];let y;for(y=0;y<R.length;y+=1){const K=nt(_,R,y);L[y]?(L[y].p(K,S),J(L[y],1)):(L[y]=ut(K),L[y].c(),J(L[y],1),L[y].m(v,null))}for(Ee(),y=R.length;y<L.length;y+=1)H(y);Te()}},i(_){if(!V){for(let S=0;S<q.length;S+=1)J(f[S]);J(r.$$.fragment,_),J(u.$$.fragment,_);for(let S=0;S<O.length;S+=1)J(B[S]);for(let S=0;S<R.length;S+=1)J(L[S]);V=!0}},o(_){f=f.filter(Boolean);for(let S=0;S<f.length;S+=1)x(f[S]);x(r.$$.fragment,_),x(u.$$.fragment,_),B=B.filter(Boolean);for(let S=0;S<B.length;S+=1)x(B[S]);L=L.filter(Boolean);for(let S=0;S<L.length;S+=1)x(L[S]);V=!1},d(_){_&&M(e),oe(f,_),de(r),_&&M(c),de(u,_),_&&M(a),_&&M(p),oe(B,_),_&&M(b),_&&M(v),oe(L,_)}}}function it(t){let e,n;return e=new Gt({props:{sample:t[17],groups:t[3],monome:t[6],files:t[0]}}),{c(){pe(e.$$.fragment)},m(l,s){_e(e,l,s),n=!0},p(l,s){const o={};s&16&&(o.sample=l[17]),s&8&&(o.groups=l[3]),s&1&&(o.files=l[0]),e.$set(o)},i(l){n||(J(e.$$.fragment,l),n=!0)},o(l){x(e.$$.fragment,l),n=!1},d(l){de(e,l)}}}function rt(t){let e,n;return e=new tn({props:{pattern:t[14],monome:t[6]}}),{c(){pe(e.$$.fragment)},m(l,s){_e(e,l,s),n=!0},p(l,s){const o={};s&32&&(o.pattern=l[14]),e.$set(o)},i(l){n||(J(e.$$.fragment,l),n=!0)},o(l){x(e.$$.fragment,l),n=!1},d(l){de(e,l)}}}function ut(t){let e,n;return e=new Jt({props:{monome:t[6],group:t[11]}}),{c(){pe(e.$$.fragment)},m(l,s){_e(e,l,s),n=!0},p(l,s){const o={};s&8&&(o.group=l[11]),e.$set(o)},i(l){n||(J(e.$$.fragment,l),n=!0)},o(l){x(e.$$.fragment,l),n=!1},d(l){de(e,l)}}}function sn(t){return{c:I,m:I,p:I,i:I,o:I,d:I}}function on(t){let e,n,l,s=!t[6]&&ot(t),o={ctx:t,current:null,token:null,hasCatch:!1,pending:sn,then:ln,catch:nn,value:6,blocks:[,,,]};return wt(t[7].promise,o),{c(){e=C("main"),s&&s.c(),n=D(),o.block.c()},m(i,r){T(i,e,r),s&&s.m(e,null),g(e,n),o.block.m(e,o.anchor=null),o.mount=()=>e,o.anchor=null,l=!0},p(i,[r]){t=i,t[6]?s&&(s.d(1),s=null):s?s.p(t,r):(s=ot(t),s.c(),s.m(e,n)),St(o,t,r)},i(i){l||(J(o.block),l=!0)},o(i){for(let r=0;r<3;r+=1){const c=o.blocks[r];x(c)}l=!1},d(i){i&&M(e),s&&s.d(),o.block.d(),o.token=null,o=null}}}function rn(t,e,n){const l=Ne("audioContext");let{router:s={}}=e,{files:o={}}=e,{bpm:i={}}=e,{quantize:r={}}=e,{groups:c=[]}=e,{samples:u=[]}=e,{patterns:a=[]}=e,p;const w=Tt();async function m(){l.resume(),n(6,p=await qt.connect()),s.start(p),w.resolve(p)}return t.$$set=b=>{"router"in b&&n(9,s=b.router),"files"in b&&n(0,o=b.files),"bpm"in b&&n(1,i=b.bpm),"quantize"in b&&n(2,r=b.quantize),"groups"in b&&n(3,c=b.groups),"samples"in b&&n(4,u=b.samples),"patterns"in b&&n(5,a=b.patterns)},[o,i,r,c,u,a,p,w,m,s]}class un extends re{constructor(e){super();ue(this,e,rn,on,ce,{router:9,files:0,bpm:1,quantize:2,groups:3,samples:4,patterns:5})}}const ct=[],at=Se(16,()=>Se(16,0));function ve(t,e){ct.push({matcher:t,handler:e})}function cn(t){t.on("gridKeyDown",({x:e,y:n})=>Be({x:e,y:n,state:1,source:"press"})),t.on("gridKeyUp",({x:e,y:n})=>Be({x:e,y:n,state:0,source:"press"}))}function Be({x:t,y:e,state:n,source:l}){l==="press"&&(at[e][t]=Number(n));const s=an(t,e,n,l);if(!s)return;const o={x:t,y:e,state:n,grid:at};Array.isArray(s.handler)?s.handler.forEach(i=>i(o)):s.handler(o)}function an(t,e,n,l){return ct.find(({matcher:s})=>s({x:t,y:e,state:n,source:l}))}var ft=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",route:ve,start:cn,handle:Be});function fn(t,e){let n,l,s;t.addEventListener("ended",i);function o(v=0){n=v,e(b()),l=c(),s=setInterval(r,1e3/60)}function i(){clearInterval(s)}function r(){const v=c();n+=(v-l)*m(),w()&&n>p()&&(n=a()+(n-p())),e(b()),l=v}function c(){return+new Date/1e3}function u(){return t.buffer.duration}function a(){return t.loopStart||0}function p(){return t.loopEnd||u()}function w(){return t.loop}function m(){return t.playbackRate.value}function b(){return Math.min(n/u()-Number.MIN_VALUE,1)}return{start:o,stop:i,check:r}}const qe=[];function pn({id:t,audioContext:e,group:n,bpm:l,scheduler:s}){n=Z(n);const o=16,i=Z(null),r=ee(i,d=>d&&Bt(d)),c=ee(i,d=>(d==null?void 0:d.duration)||0),u=Z(0),a=Z(!1),p=Z(0),w=Z(),m=Z(16),b=ee(m,d=>Se(o,A=>({enabled:A<d}))),v=ee(l,d=>60/d),F=ee([v,m],([d,A])=>d*A),P=Z(0),V=Z(!1),q=ee([P,V,m],([d,A,k])=>A?le(Math.floor(d*k)):null),f=ee([c,F,u],([d,A,k])=>d?d/A*Math.pow(2,k):1),z=ee([c,m,p],([d,A,k])=>d/A*k),O=ee([c,m,w],([d,A,k])=>d/A*(k!=null?k:A)),B=ee(z,d=>d!=null),te={group:n,buffer:i,reffub:r,duration:c,enabledStepCount:m,steps:b,currentStep:q,octave:u,speed:f,reverse:a,loopStart:z,loopEnd:O,loop:B,playing:V,progress:P},R={};for(const d in te)te[d].subscribe(A=>R[d]=A);let L,H;z.subscribe(d=>{L&&(L.loopStart=d),H==null||H.check()}),O.subscribe(d=>{L&&(L.loopEnd=d),H==null||H.check()}),B.subscribe(d=>{L&&(L.loop=d),H==null||H.check()}),f.subscribe(d=>{L&&(L.playbackRate.value=d),H==null||H.check()}),a.subscribe(()=>{const{playing:d,duration:A,progress:k}=R;d&&S((1-k)*A)}),c.subscribe(async d=>{const{playing:A,progress:k}=R;A&&(H==null||H.check(),await Lt(),S(k*d))});function _(d){!R.buffer||!K(d)||s.schedule(function(){S(y(le(d)))})}function S(d){L=E(),R.group.play(L,d),H==null||H.stop(),H=fn(L,P.set),H.start(d),V.set(!0)}function j(){p.set(0),w.set(null)}function X(d){if(!K(d[0])||!K(d[1]))return;d=le(d);const{reverse:A}=R;p.set(A?d[1]:d[0]),w.set(A?d[0]:d[1])}function y(d){const{duration:A,enabledStepCount:k}=R;return A/k*d}function K(d){return d<R.enabledStepCount}function le(d){return Array.isArray(d)?d.map(fe):fe(d)}function fe(d){if(d==null)return d;const{enabledStepCount:A,reverse:k}=R;return k?Math.abs(d-(A-1)):d}let se;function E(){const{reverse:d,buffer:A,reffub:k,loop:Q,loopStart:Y,loopEnd:N,speed:ie}=R;return se=+new Date+Math.random(),L=Dt(d?k:A,e,{loop:Q,loopStart:Y,loopEnd:N,speed:ie}),L.onended=(dt=>()=>U(dt))(se),L}function U(d){(!d||se===d)&&V.set(!1)}return Re(Ae({id:t},te),{start:_,resetLoopPoints:j,loopBetween:X})}var pt={loop:({x:t,y:e,grid:n})=>{const l=qe[e-1],s=n[e].reduce((o,i,r)=>i?o.concat(r):o,[]);s.length===1?(l.resetLoopPoints(),l.start(t)):s.length===2&&l.loopBetween(s)},replay({x:t,y:e}){const n=qe[e-1];n.resetLoopPoints(),n.start(t)}},_n={stop:({x:t})=>{he[t].stop()}};const Le=[];function dn({id:t,bpm:e,scheduler:n,router:l}){const s=Z(!1),o=Z(!1),i=ee([s,o],([f,z])=>f||z),r=Z(8),c=ee([e,r],([f,z])=>60/f*z);let u=()=>{},a=[],p=null;const w={recordable:s,playing:o,active:i,length:r,duration:c},m={};for(const f in w)w[f].subscribe(z=>m[f]=z);function b(){m.active?(s.set(!1),o.set(!1),q()):s.set(!0)}function v(f){const{recordable:z,duration:O}=m;!z||a.push(P(f))===1&&(p=n.schedule(F,null,{in:O}))}function F(){s.set(!1),o.set(!0)}function P({x:f,y:z,state:O}){const{duration:B}=m;return n.schedule(()=>{l.handle({x:f,y:z,state:O,source:"pattern"}),n.schedule(u)},null,{in:B,repeat:B})}function V(){p==null||p.clear(),p=null,o.set(!1)}function q(){a.forEach(f=>f.clear()),a=[],V()}return{id:t,toggle:b,record:v,recordable:s,playing:o,active:i,length:r,set onactivity(f){u=f}}}var _t={record:({x:t,y:e,state:n})=>{Le.forEach(l=>l.record({x:t,y:e,state:n}))},toggle:({x:t})=>{const e=he.length,n=t-e;Le[n].toggle()}};ve(({y:t,state:e,source:n})=>t>0&&n==="press"&&e,[pt.loop,_t.record]);ve(({y:t,state:e,source:n})=>t>0&&n==="pattern"&&e,[pt.replay]);ve(({x:t,y:e,state:n})=>e===0&&t<4&&n,_n.stop);ve(({x:t,y:e,state:n})=>e==0&&(t==4||t==5)&&n,_t.toggle);const{subscribe:hn,update:mn}=Z([]);function gn(t=[]){t=[...t],mn(e=>Et([...e,...t],n=>n.name))}const bn={subscribe:hn,add:gn},ke=Z(120),De=Z(16);function vn({audioContext:t,bpm:e,quantize:n}){let l=new zt(t),s=[],o=!1,i;function r(){const m=p(e,n);l.start(),i=l.setTimeout(a,m).repeat(m),o=!0}function c(){!o||(i.clear(),i=null,l.stop(),o=!1)}function u(m,b=[],v={}){if(v.in!=null){let F=l.setTimeout(()=>m.apply(null,b),v.in);return v.repeat&&(F=F.repeat(v.repeat)),F}else s.push({fn:m,args:b})}function a(){for(;s.length;){const{fn:m,args:b}=s.shift();m.apply(null,b)}}function p(m,b){return 60/m/b}function w(m){!o||l.timeStretch(t.currentTime,[i],m)}return{start:r,stop:c,schedule:u,set bpm(m){w(e/m),e=m},set quantize(m){w(n/m),n=m}}}const ze=new AudioContext,ye=vn({audioContext:ze,bpm:je(ke),quantize:je(De)});ye.start();ke.subscribe(t=>ye.bpm=t);De.subscribe(t=>ye.quantize=t);Me(4,xt,he,{audioContext:ze});Me(7,pn,qe,{audioContext:ze,group:he[0],bpm:ke,scheduler:ye});Me(2,dn,Le,{bpm:ke,scheduler:ye,router:ft});new un({target:document.getElementById("app"),props:{router:ft,files:bn,bpm:ke,quantize:De,groups:he,samples:qe,patterns:Le},context:new Map([["audioContext",ze]])});
