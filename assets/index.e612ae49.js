var At=Object.defineProperty,Tt=Object.defineProperties;var Dt=Object.getOwnPropertyDescriptors;var Ze=Object.getOwnPropertySymbols;var Ot=Object.prototype.hasOwnProperty,It=Object.prototype.propertyIsEnumerable;var Qe=(t,e,n)=>e in t?At(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ae=(t,e)=>{for(var n in e||(e={}))Ot.call(e,n)&&Qe(t,n,e[n]);if(Ze)for(var n of Ze(e))It.call(e,n)&&Qe(t,n,e[n]);return t},Je=(t,e)=>Tt(t,Dt(e));import{w as H,d as $,g as Le,t as Rt,S as oe,i as ie,s as re,e as C,a as X,b as z,c as h,n as U,f as M,h as O,j as Te,k as d,l as he,m as N,o as ge,r as be,Q as Ft,p as Bt,q as De,u as ke,v as qe,x as We,y as Xe,z as ye,A as ae,B as fe,C as ne,D as Ye,E as ee,F as te,G as _e,H as Nt,I as Z,J as pe,K as Oe,L as $e,M as xe,N as Se,O as Pt,P as Ee,R as Ie,T as Re,U as Fe,V as Vt}from"./vendor.71b304fb.js";const Ht=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}};Ht();function ve(t,e){const n=[];for(let l=0;l<t;l++)n[l]=typeof e=="function"?e(l):e;return n}function Gt(t,e){const n=[];let l=0;const i=t.length;for(;l<i;)n.push(t.slice(l,l+=e));return n}function Kt(t,e){return t.reduce((n,l)=>{const i=e(l);return n.find(o=>e(o)===i)||n.push(l),n},[])}function Ut(t,e,n){const l=8;Gt(n,l).forEach((o,s)=>t.gridLedRow(s*l,e,o))}async function et(t){return new Promise(e=>{t.addEventListener("getGridSize",n=>e(n.detail)),t.getGridSize()})}const jt="0.2.0",Be=H([]);let ue;Be.subscribe(t=>ue=t);function Zt({id:t,audioContext:e}){let n;const l=e.createGain();l.connect(e.destination);const i=H(!1),o=H(1),s=H(!1);$([o,s],([L,p])=>p?0:L).subscribe(L=>l.gain.setTargetAtTime(L,e.currentTime,.015));function _(L,p){return u(),n=L,L.connect(l),L.start(0,p),i.set(!0),L}function u(){n==null||n.stop(),i.set(!1)}function y(){s.set(!Le(s))}const a=1e3,w=1e3/25,f=1/(a/w);let c;function k(){c=A(o,f,w)}function v(){c=A(o,-f,w)}function A(L,p,E){let S=Le(L);return setInterval(function(){S=Math.max(0,Math.min(S+p,1)),L.set(S)},E)}function B(){clearInterval(c)}return{id:t,level:o,muted:s,active:i,play:_,stop:u,toggleMute:y,startIncreasingLevel:k,startDecreasingLevel:v,stopIncreasingLevel:B,stopDecreasingLevel:B}}const tt=new FileReader;function Qt(t,e){return new Promise(n=>{tt.readAsArrayBuffer(t),tt.onload=async({target:{result:l}})=>{n(await e.decodeAudioData(l))}})}function Jt(t){const e=new AudioBuffer({sampleRate:t.sampleRate,numberOfChannels:t.numberOfChannels,length:t.length});for(let l=0;l<t.numberOfChannels;l++){const i=t.getChannelData(l),o=e.getChannelData(l);for(var n=t.length-1;n>=0;n--)o[t.length-n-1]=i[n]}return e}function Wt(t,e,n){const l=e.createBufferSource();t&&(l.buffer=t);const{loopStart:i,loopEnd:o,loop:s,speed:r}=n;return l.loop=!!s,i!=null&&(l.loopStart=i),o!=null&&(l.loopEnd=o),r!=null&&(l.playbackRate.value=r),l}function Xt(t,e){let n,l,i;t.addEventListener("ended",s);function o(k=0){n=k,e(c()),l=_(),i=setInterval(r,1e3/60)}function s(){clearInterval(i)}function r(){const k=_();n+=(k-l)*f(),w()&&n>a()&&(n=y()+(n-a())),e(c()),l=k}function _(){return+new Date/1e3}function u(){return t.buffer.duration}function y(){return t.loopStart||0}function a(){return t.loopEnd||u()}function w(){return t.loop}function f(){return t.playbackRate.value}function c(){return Math.min(n/u()-Number.MIN_VALUE,1)}return{start:o,stop:s,check:r}}const Ne=H([]);let Pe;Ne.subscribe(t=>Pe=t);function Yt({id:t,audioContext:e,group:n,stepCount:l,bpm:i,scheduler:o}){n=H(n);const s=H(null),r=$(s,m=>m&&Jt(m)),_=$(s,m=>(m==null?void 0:m.duration)||0),u=H(0),y=H(!1),a=H(0),w=H(),f=H(l),c=$(f,m=>ve(l,T=>({enabled:T<m}))),k=$(i,m=>60/m),v=$([k,f],([m,T])=>m*T),A=H(0),B=H(!1),L=$([A,B,f],([m,T,q])=>T?x(Math.floor(m*q)):null),p=$([_,v,u],([m,T,q])=>m?m/T*Math.pow(2,q):1),E=$([_,f,a],([m,T,q])=>m/T*q),S=$([_,f,w],([m,T,q])=>m/T*(q!=null?q:T)),G=$(E,m=>m!=null),J={group:n,buffer:s,reffub:r,duration:_,enabledStepCount:f,steps:c,currentStep:L,octave:u,speed:p,reverse:y,loopStart:E,loopEnd:S,loop:G,playing:B,progress:A},V={};for(const m in J)J[m].subscribe(T=>V[m]=T);let F,R;E.subscribe(m=>{F&&(F.loopStart=m),R==null||R.check()}),S.subscribe(m=>{F&&(F.loopEnd=m),R==null||R.check()}),G.subscribe(m=>{F&&(F.loop=m),R==null||R.check()}),p.subscribe(m=>{F&&(F.playbackRate.value=m),R==null||R.check()}),y.subscribe(()=>{const{playing:m,duration:T,progress:q}=V;m&&W((1-q)*T)}),_.subscribe(async m=>{const{playing:T,progress:q}=V;T&&(R==null||R.check(),await Rt(),W(q*m))});function Q(m){!V.buffer||!I(m)||o.schedule(function(){W(g(x(m)))})}function W(m){F=D(),V.group.play(F,m),R==null||R.stop(),R=Xt(F,A.set),R.start(m),B.set(!0)}function le(){a.set(0),w.set(null)}function b(m){if(!I(m[0])||!I(m[1]))return;m=x(m);const{reverse:T}=V;a.set(T?m[1]:m[0]),w.set(T?m[0]:m[1])}function g(m){const{duration:T,enabledStepCount:q}=V;return T/q*m}function I(m){return m<V.enabledStepCount}function x(m){return Array.isArray(m)?m.map(me):me(m)}function me(m){if(m==null)return m;const{enabledStepCount:T,reverse:q}=V;return q?Math.abs(m-(T-1)):m}let se;function D(){const{reverse:m,buffer:T,reffub:q,loop:j,loopStart:Y,loopEnd:P,speed:ce}=V;return se=+new Date+Math.random(),F=Wt(m?q:T,e,{loop:j,loopStart:Y,loopEnd:P,speed:ce}),F.onended=(Mt=>()=>K(Mt))(se),F}function K(m){(!m||se===m)&&B.set(!1)}return Je(Ae({id:t},J),{start:Q,resetLoopPoints:le,loopBetween:b})}const Ve=H([]);let He;Ve.subscribe(t=>He=t);function $t({id:t,bpm:e,scheduler:n,router:l}){const i=H(!1),o=H(!1),s=$([i,o],([p,E])=>p||E),r=H(8),_=$([e,r],([p,E])=>60/p*E);let u=()=>{},y=[],a=null;const w={recordable:i,playing:o,active:s,length:r,duration:_},f={};for(const p in w)w[p].subscribe(E=>f[p]=E);function c(){f.active?(i.set(!1),o.set(!1),L()):i.set(!0)}function k(p){const{recordable:E,duration:S}=f;!E||y.push(A(p))===1&&(a=n.schedule(v,null,{in:S}))}function v(){i.set(!1),o.set(!0)}function A({x:p,y:E,state:S}){const{duration:G}=f;return n.schedule(()=>{l.handle({x:p,y:E,state:S,source:"pattern"}),n.schedule(u)},null,{in:G,repeat:G})}function B(){a==null||a.clear(),a=null,o.set(!1)}function L(){y.forEach(p=>p.clear()),y=[],B()}return{id:t,toggle:c,record:k,recordable:i,playing:o,active:s,length:r,set onactivity(p){u=p}}}function xt(t,e,n){const l=n.get("audioContext"),i=n.get("bpm"),o=n.get("scheduler"),s=n.get("router"),r=e-1,_=t,u=Ge(4,Zt,{audioContext:l});Be.set(u),Ve.set(Ge(2,$t,{bpm:i,scheduler:o,router:s})),Ne.set(Ge(r,Yt,{audioContext:l,group:u[0],stepCount:_,bpm:i,scheduler:o}))}function Ge(t,e,n){return ve(t,l=>e(Ae({id:l},n)))}function nt(t,e,n){const l=t.slice();return l[5]=e[n].label,l[0]=e[n].klass,l}function lt(t){let e,n=t[5]+"",l,i;return{c(){e=C("option"),l=X(n),e.__value=i=t[0],e.value=e.__value},m(o,s){z(o,e,s),h(e,l)},p:U,d(o){o&&M(e)}}}function en(t){let e,n,l,i,o,s,r,_,u,y,a,w=t[1],f=[];for(let c=0;c<w.length;c+=1)f[c]=lt(nt(t,w,c));return{c(){e=C("label"),n=X(`Device
  `),l=C("select");for(let c=0;c<f.length;c+=1)f[c].c();i=O(),o=C("button"),o.textContent="connect",s=O(),r=C("div"),r.innerHTML="For monome grid devices <strong>disable serialosc</strong>",_=O(),u=C("details"),u.innerHTML=`<summary class="svelte-w385xu">Disabling serialosc</summary> 
  <p>To disable serialosc on macOS, open terminal and execute:</p> 
  <pre><code class="svelte-w385xu">launchctl unload /library/launchagents/org.monome.serialosc.plist</code></pre>

  To re-enable, run:
  <pre><code class="svelte-w385xu">launchctl load /library/launchagents/org.monome.serialosc.plist</code></pre>`,t[0]===void 0&&Te(()=>t[4].call(l)),d(r,"class","svelte-w385xu")},m(c,k){z(c,e,k),h(e,n),h(e,l);for(let v=0;v<f.length;v+=1)f[v].m(l,null);he(l,t[0]),z(c,i,k),z(c,o,k),z(c,s,k),z(c,r,k),z(c,_,k),z(c,u,k),y||(a=[N(l,"change",t[4]),N(o,"click",t[2])],y=!0)},p(c,[k]){if(k&2){w=c[1];let v;for(v=0;v<w.length;v+=1){const A=nt(c,w,v);f[v]?f[v].p(A,k):(f[v]=lt(A),f[v].c(),f[v].m(l,null))}for(;v<f.length;v+=1)f[v].d(1);f.length=w.length}k&3&&he(l,c[0])},i:U,o:U,d(c){c&&M(e),ge(f,c),c&&M(i),c&&M(o),c&&M(s),c&&M(r),c&&M(_),c&&M(u),y=!1,be(a)}}}function tn(t,e,n){let{selected:l}=e,i;const o=[{label:"choose"},{label:"qwerty32",klass:Ft},{label:"monome grid",klass:Bt}];async function s(){n(3,l=await(i==null?void 0:i.connect()))}function r(){i=De(this),n(0,i),n(1,o)}return t.$$set=_=>{"selected"in _&&n(3,l=_.selected)},[i,o,s,l,r]}class nn extends oe{constructor(e){super();ie(this,e,tn,en,re,{selected:3})}}function st(t,e,n){const l=t.slice();return l[4]=e[n],l}function ot(t){let e,n=t[4].name+"",l,i,o;return{c(){e=C("option"),l=X(n),i=O(),e.__value=o=t[4],e.value=e.__value},m(s,r){z(s,e,r),h(e,l),h(e,i)},p(s,r){r&4&&n!==(n=s[4].name+"")&&ke(l,n),r&4&&o!==(o=s[4])&&(e.__value=o,e.value=e.__value)},d(s){s&&M(e)}}}function ln(t){let e,n,l,i=t[2],o=[];for(let s=0;s<i.length;s+=1)o[s]=ot(st(t,i,s));return{c(){e=C("select");for(let s=0;s<o.length;s+=1)o[s].c();d(e,"class","svelte-1hx4o8j"),t[0]===void 0&&Te(()=>t[3].call(e))},m(s,r){z(s,e,r);for(let _=0;_<o.length;_+=1)o[_].m(e,null);he(e,t[0]),n||(l=N(e,"change",t[3]),n=!0)},p(s,[r]){if(r&4){i=s[2];let _;for(_=0;_<i.length;_+=1){const u=st(s,i,_);o[_]?o[_].p(u,r):(o[_]=ot(u),o[_].c(),o[_].m(e,null))}for(;_<o.length;_+=1)o[_].d(1);o.length=i.length}r&5&&he(e,s[0])},i:U,o:U,d(s){s&&M(e),ge(o,s),n=!1,l()}}}function sn(t,e,n){let l,i=U,o=()=>(i(),i=qe(s,u=>n(2,l=u)),s);t.$$.on_destroy.push(()=>i());let{files:s}=e;o();let{selected:r}=e;function _(){r=De(this),n(0,r)}return t.$$set=u=>{"files"in u&&o(n(1,s=u.files)),"selected"in u&&n(0,r=u.selected)},[r,s,l,_]}class on extends oe{constructor(e){super();ie(this,e,sn,ln,re,{files:1,selected:0})}}function it(t,e,n){const l=t.slice();return l[34]=e[n],l}function rt(t,e,n){const l=t.slice();return l[37]=e[n],l[39]=n,l}function ut(t){let e,n,l,i,o,s,r;function _(){return t[25](t[39])}return{c(){e=C("input"),d(e,"name",n="sample_"+t[11]+"_step"),d(e,"type","radio"),e.value=l=t[39],e.checked=i=t[3]==t[39],e.disabled=o=!t[37].enabled,d(e,"autocomplete","off")},m(u,y){z(u,e,y),s||(r=N(e,"click",ye(_)),s=!0)},p(u,y){t=u,y[0]&8&&i!==(i=t[3]==t[39])&&(e.checked=i),y[0]&16&&o!==(o=!t[37].enabled)&&(e.disabled=o)},d(u){u&&M(e),s=!1,r()}}}function ct(t){let e,n,l,i,o;return{c(){e=C("input"),d(e,"name",n="sample_"+t[11]+"_group"),d(e,"type","radio"),e.__value=l=t[34],e.value=e.__value,d(e,"autocomplete","off"),t[31][0].push(e)},m(s,r){z(s,e,r),e.checked=e.__value===t[10],i||(o=N(e,"change",t[30]),i=!0)},p(s,r){r[0]&1&&l!==(l=s[34])&&(e.__value=l,e.value=e.__value),r[0]&1024&&(e.checked=e.__value===s[10])},d(s){s&&M(e),t[31][0].splice(t[31][0].indexOf(e),1),i=!1,o()}}}function rn(t){let e,n,l,i,o,s,r,_,u,y,a,w,f=(t[7]>=0?"+":"")+"",c,k,v,A,B,L,p,E,S=t[8].toFixed(2)+"",G,J,V,F,R,Q,W,le,b,g,I,x;function me(q){t[24](q)}let se={files:t[1]};t[2]!==void 0&&(se.selected=t[2]),l=new on({props:se}),We.push(()=>Xe(l,"selected",me));let D=t[4],K=[];for(let q=0;q<D.length;q+=1)K[q]=ut(rt(t,D,q));let m=t[0],T=[];for(let q=0;q<m.length;q+=1)T[q]=ct(it(t,m,q));return{c(){e=C("tr"),n=C("td"),ae(l.$$.fragment),o=O(),s=C("td"),r=C("div");for(let q=0;q<K.length;q+=1)K[q].c();_=O(),u=C("input"),y=O(),a=C("td"),w=C("span"),c=X(f),k=X(t[7]),v=O(),A=C("button"),A.textContent="-",B=O(),L=C("button"),L.textContent="+",p=O(),E=C("td"),G=X(S),J=O(),V=C("td"),F=C("input"),R=O(),Q=C("label"),W=X("Rev"),le=O(),b=C("td");for(let q=0;q<T.length;q+=1)T[q].c();d(n,"class","svelte-2kpfy0"),d(u,"type","range"),d(u,"min","1"),d(u,"max",t[5]),d(u,"step","1"),d(u,"class","svelte-2kpfy0"),d(s,"class","svelte-2kpfy0"),d(A,"aria-label","Decrement octave"),d(L,"aria-label","Increment octave"),d(a,"class","svelte-2kpfy0"),d(E,"class","svelte-2kpfy0"),d(F,"id","sample_"+t[11]+"_reverse"),d(F,"type","checkbox"),d(Q,"for","sample_"+t[11]+"_reverse"),d(V,"class","svelte-2kpfy0"),d(b,"class","svelte-2kpfy0")},m(q,j){z(q,e,j),h(e,n),fe(l,n,null),h(e,o),h(e,s),h(s,r);for(let Y=0;Y<K.length;Y+=1)K[Y].m(r,null);h(s,_),h(s,u),ne(u,t[6]),h(e,y),h(e,a),h(a,w),h(w,c),h(w,k),h(a,v),h(a,A),h(a,B),h(a,L),h(e,p),h(e,E),h(E,G),h(e,J),h(e,V),h(V,F),F.checked=t[9],h(V,R),h(V,Q),h(Q,W),h(e,le),h(e,b);for(let Y=0;Y<T.length;Y+=1)T[Y].m(b,null);g=!0,I||(x=[N(u,"change",t[26]),N(u,"input",t[26]),N(A,"click",t[27]),N(L,"click",t[28]),N(F,"change",t[29])],I=!0)},p(q,j){const Y={};if(j[0]&2&&(Y.files=q[1]),!i&&j[0]&4&&(i=!0,Y.selected=q[2],Ye(()=>i=!1)),l.$set(Y),j[0]&1050648){D=q[4];let P;for(P=0;P<D.length;P+=1){const ce=rt(q,D,P);K[P]?K[P].p(ce,j):(K[P]=ut(ce),K[P].c(),K[P].m(r,null))}for(;P<K.length;P+=1)K[P].d(1);K.length=D.length}if((!g||j[0]&32)&&d(u,"max",q[5]),j[0]&64&&ne(u,q[6]),(!g||j[0]&128)&&f!==(f=(q[7]>=0?"+":"")+"")&&ke(c,f),(!g||j[0]&128)&&ke(k,q[7]),(!g||j[0]&256)&&S!==(S=q[8].toFixed(2)+"")&&ke(G,S),j[0]&512&&(F.checked=q[9]),j[0]&3073){m=q[0];let P;for(P=0;P<m.length;P+=1){const ce=it(q,m,P);T[P]?T[P].p(ce,j):(T[P]=ct(ce),T[P].c(),T[P].m(b,null))}for(;P<T.length;P+=1)T[P].d(1);T.length=m.length}},i(q){g||(ee(l.$$.fragment,q),g=!0)},o(q){te(l.$$.fragment,q),g=!1},d(q){q&&M(e),_e(l),ge(K,q),ge(T,q),I=!1,be(x)}}}function un(t,e,n){let l,i,o,s,r,_,u,y,a,w;const f=Nt("audioContext");let{sample:c={}}=e,{id:k,steps:v,enabledStepCount:A,currentStep:B,octave:L,speed:p,reverse:E,buffer:S,group:G,start:J}=c;Z(t,v,D=>n(4,r=D)),Z(t,A,D=>n(6,_=D)),Z(t,B,D=>n(3,s=D)),Z(t,L,D=>n(7,u=D)),Z(t,p,D=>n(8,y=D)),Z(t,E,D=>n(9,a=D)),Z(t,S,D=>n(32,o=D)),Z(t,G,D=>n(10,w=D));let{groups:V=[]}=e,{monome:F={}}=e,{files:R={}}=e,Q;const W=[[]];function le(D){Q=D,n(2,Q)}const b=D=>J(D);function g(){_=pe(this.value),A.set(_)}const I=()=>Oe(L,--u,u),x=()=>Oe(L,++u,u);function me(){a=this.checked,E.set(a)}function se(){w=this.__value,G.set(w)}return t.$$set=D=>{"sample"in D&&n(21,c=D.sample),"groups"in D&&n(0,V=D.groups),"monome"in D&&n(22,F=D.monome),"files"in D&&n(1,R=D.files)},t.$$.update=()=>{t.$$.dirty[0]&16&&n(5,l=r.length),t.$$.dirty[0]&12582936&&Ut(F,i,r.map((D,K)=>K===s)),t.$$.dirty[0]&4&&Q&&Qt(Q,f).then(D=>Oe(S,o=D,o))},n(23,i=k+1),[V,R,Q,s,r,l,_,u,y,a,w,k,v,A,B,L,p,E,S,G,J,c,F,i,le,b,g,I,x,me,se,W]}class cn extends oe{constructor(e){super();ie(this,e,un,rn,re,{sample:21,groups:0,monome:22,files:1},null,[-1,-1])}}function at(t,e,n){const l=t.slice();return l[8]=e[n].name,l}function ft(t){let e,n=t[3],l=[];for(let i=0;i<n.length;i+=1)l[i]=_t(at(t,n,i));return{c(){e=C("ul");for(let i=0;i<l.length;i+=1)l[i].c();d(e,"class","svelte-1eckyqf")},m(i,o){z(i,e,o);for(let s=0;s<l.length;s+=1)l[s].m(e,null)},p(i,o){if(o&8){n=i[3];let s;for(s=0;s<n.length;s+=1){const r=at(i,n,s);l[s]?l[s].p(r,o):(l[s]=_t(r),l[s].c(),l[s].m(e,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=n.length}},d(i){i&&M(e),ge(l,i)}}}function _t(t){let e,n,l,i,o=t[8]+"",s,r;return{c(){e=C("li"),n=$e("svg"),l=$e("path"),i=O(),s=X(o),r=O(),d(l,"d","M3.5 2C3.22386 2 3 2.22386 3 2.5V12.5C3 12.7761 3.22386 13 3.5 13H11.5C11.7761 13 12 12.7761 12 12.5V6H8.5C8.22386 6 8 5.77614 8 5.5V2H3.5ZM9 2.70711L11.2929 5H9V2.70711ZM2 2.5C2 1.67157 2.67157 1 3.5 1H8.5C8.63261 1 8.75979 1.05268 8.85355 1.14645L12.8536 5.14645C12.9473 5.24021 13 5.36739 13 5.5V12.5C13 13.3284 12.3284 14 11.5 14H3.5C2.67157 14 2 13.3284 2 12.5V2.5Z"),d(l,"fill","currentColor"),d(l,"fill-rule","evenodd"),d(l,"clip-rule","evenodd"),d(n,"width","15"),d(n,"height","15"),d(n,"viewBox","0 0 15 15"),d(n,"fill","none"),d(n,"xmlns","http://www.w3.org/2000/svg"),d(n,"class","svelte-1eckyqf"),d(e,"class","svelte-1eckyqf")},m(_,u){z(_,e,u),h(e,n),h(n,l),h(e,i),h(e,s),h(e,r)},p(_,u){u&8&&o!==(o=_[8]+"")&&ke(s,o)},d(_){_&&M(e)}}}function an(t){let e,n,l,i,o,s,r,_,u=t[3].length&&ft(t);return{c(){e=C("section"),n=C("label"),n.textContent="Audio file drop",l=O(),i=C("div"),o=C("input"),s=O(),u&&u.c(),d(n,"for","files"),d(o,"accept","audio/*"),d(o,"id","files"),d(o,"name","files"),d(o,"type","file"),d(o,"class","svelte-1eckyqf"),d(i,"class","file-drop svelte-1eckyqf"),xe(i,"dragover",t[2]),d(e,"class","svelte-1eckyqf")},m(y,a){z(y,e,a),h(e,n),h(e,l),h(e,i),h(i,o),h(i,s),u&&u.m(i,null),r||(_=[N(o,"change",t[5]),N(i,"dragover",ye(t[6])),N(i,"dragleave",ye(t[7])),N(i,"drop",ye(t[4]))],r=!0)},p(y,[a]){y[3].length?u?u.p(y,a):(u=ft(y),u.c(),u.m(i,null)):u&&(u.d(1),u=null),a&4&&xe(i,"dragover",y[2])},i:U,o:U,d(y){y&&M(e),u&&u.d(),r=!1,be(_)}}}function fn(t){return t.reduce((e,n)=>{if(n.kind==="file"){const l=n.getAsFile();/^(audio|video)/.test(l.type)&&e.push(l)}return e},[])}function _n(t,e,n){let l,i=U,o=()=>(i(),i=qe(s,f=>n(3,l=f)),s);t.$$.on_destroy.push(()=>i());let{files:s}=e;o();let r,_=!1;function u({dataTransfer:f}){n(2,_=!1),s.add(fn([...f.items]))}function y(){r=this.files,n(1,r)}const a=()=>n(2,_=!0),w=()=>n(2,_=!1);return t.$$set=f=>{"files"in f&&o(n(0,s=f.files))},t.$$.update=()=>{t.$$.dirty&3&&s.add(r)},[s,r,_,l,u,y,a,w]}class pn extends oe{constructor(e){super();ie(this,e,_n,an,re,{files:0})}}function dn(t){let e,n,l,i,o,s,r,_,u,y,a,w,f,c,k;return{c(){e=C("div"),n=C("label"),l=C("input"),o=X(`
    On/Off`),s=O(),r=C("label"),_=C("input"),u=X(`
    Mute`),y=O(),a=C("label"),w=X(`Level
    `),f=C("input"),d(l,"type","checkbox"),l.disabled=i=!t[0],d(n,"class","svelte-37acoc"),d(_,"type","checkbox"),d(r,"class","svelte-37acoc"),d(f,"type","range"),d(f,"min","0"),d(f,"max","1"),d(f,"step","0.01"),d(a,"class","svelte-37acoc")},m(v,A){z(v,e,A),h(e,n),h(n,l),l.checked=t[0],h(n,o),h(e,s),h(e,r),h(r,_),_.checked=t[1],h(r,u),h(e,y),h(e,a),h(a,w),h(a,f),ne(f,t[2]),c||(k=[N(l,"change",t[8]),N(_,"change",t[9]),N(f,"change",t[10]),N(f,"input",t[10])],c=!0)},p(v,[A]){A&1&&i!==(i=!v[0])&&(l.disabled=i),A&1&&(l.checked=v[0]),A&2&&(_.checked=v[1]),A&4&&ne(f,v[2])},i:U,o:U,d(v){v&&M(e),c=!1,be(k)}}}function mn(t,e,n){let l,i,o,{group:s={}}=e,{monome:r}=e,{id:_,active:u,muted:y,level:a}=s;Z(t,u,k=>n(0,l=k)),Z(t,y,k=>n(1,i=k)),Z(t,a,k=>n(2,o=k));function w(){l=this.checked,u.set(l)}function f(){i=this.checked,y.set(i)}function c(){o=pe(this.value),a.set(o)}return t.$$set=k=>{"group"in k&&n(6,s=k.group),"monome"in k&&n(7,r=k.monome)},t.$$.update=()=>{t.$$.dirty&65&&(l||s.stop()),t.$$.dirty&129&&r.gridLed(_,0,l)},[l,i,o,u,y,a,s,r,w,f,c]}class hn extends oe{constructor(e){super();ie(this,e,mn,dn,re,{group:6,monome:7})}}function pt(t,e,n){const l=t.slice();return l[12]=e[n],l}function dt(t){let e,n,l=t[12]+"",i,o;return{c(){e=C("option"),n=X("1/"),i=X(l),e.__value=o=t[12],e.value=e.__value},m(s,r){z(s,e,r),h(e,n),h(e,i)},p:U,d(s){s&&M(e)}}}function gn(t){let e,n,l,i,o,s,r,_,u,y,a,w,f,c,k,v,A,B=t[4],L=[];for(let p=0;p<B.length;p+=1)L[p]=dt(pt(t,B,p));return{c(){e=C("label"),e.textContent="Tempo",n=O(),l=C("input"),i=O(),o=C("button"),o.textContent="-4",s=O(),r=C("button"),r.textContent="-1",_=O(),u=C("button"),u.textContent="+1",y=O(),a=C("button"),a.textContent="+4",w=O(),f=C("label"),f.textContent="Quantize",c=O(),k=C("select");for(let p=0;p<L.length;p+=1)L[p].c();d(e,"for","tempo"),d(l,"type","number"),d(l,"id","tempo"),d(l,"size","6"),d(l,"class","svelte-1texyt4"),d(f,"for","quantize"),d(k,"name","quantize"),d(k,"id","quantize"),t[3]===void 0&&Te(()=>t[11].call(k))},m(p,E){z(p,e,E),z(p,n,E),z(p,l,E),ne(l,t[2]),z(p,i,E),z(p,o,E),z(p,s,E),z(p,r,E),z(p,_,E),z(p,u,E),z(p,y,E),z(p,a,E),z(p,w,E),z(p,f,E),z(p,c,E),z(p,k,E);for(let S=0;S<L.length;S+=1)L[S].m(k,null);he(k,t[3]),v||(A=[N(l,"input",t[6]),N(o,"click",t[7]),N(r,"click",t[8]),N(u,"click",t[9]),N(a,"click",t[10]),N(k,"change",t[11])],v=!0)},p(p,[E]){if(E&4&&pe(l.value)!==p[2]&&ne(l,p[2]),E&16){B=p[4];let S;for(S=0;S<B.length;S+=1){const G=pt(p,B,S);L[S]?L[S].p(G,E):(L[S]=dt(G),L[S].c(),L[S].m(k,null))}for(;S<L.length;S+=1)L[S].d(1);L.length=B.length}E&24&&he(k,p[3])},i:U,o:U,d(p){p&&M(e),p&&M(n),p&&M(l),p&&M(i),p&&M(o),p&&M(s),p&&M(r),p&&M(_),p&&M(u),p&&M(y),p&&M(a),p&&M(w),p&&M(f),p&&M(c),p&&M(k),ge(L,p),v=!1,be(A)}}}function bn(t,e,n){let l,i=U,o=()=>(i(),i=qe(u,L=>n(2,l=L)),u),s,r=U,_=()=>(r(),r=qe(y,L=>n(3,s=L)),y);t.$$.on_destroy.push(()=>i()),t.$$.on_destroy.push(()=>r());let{bpm:u}=e;o();let{quantize:y}=e;_();const a=[128,64,32,16,8,4,2];function w(L){u.update(p=>p+L)}function f(){l=pe(this.value),u.set(l)}const c=()=>w(-4),k=()=>w(-1),v=()=>w(1),A=()=>w(4);function B(){s=De(this),y.set(s),n(4,a)}return t.$$set=L=>{"bpm"in L&&o(n(0,u=L.bpm)),"quantize"in L&&_(n(1,y=L.quantize))},[u,y,l,s,a,w,f,c,k,v,A,B]}class vn extends oe{constructor(e){super();ie(this,e,bn,gn,re,{bpm:0,quantize:1})}}function kn(t){let e,n,l,i,o,s,r,_,u,y,a,w,f,c,k;return{c(){e=C("div"),n=C("label"),l=C("input"),i=X(`
    On/Off`),o=O(),s=C("label"),r=C("span"),r.textContent="Length",_=O(),u=C("input"),y=O(),a=C("input"),w=O(),f=C("span"),f.textContent="beats",d(l,"id","pattern_"+t[2]+"_active"),d(l,"name","pattern_"+t[2]+"_active"),d(l,"type","checkbox"),l.checked=t[0],d(n,"class","svelte-sqr61q"),d(r,"class","svelte-sqr61q"),d(u,"type","range"),d(u,"min","1"),d(u,"max","32"),d(u,"class","svelte-sqr61q"),d(a,"type","number"),d(a,"min","1"),d(a,"max","32"),d(a,"class","svelte-sqr61q"),d(f,"class","svelte-sqr61q"),d(s,"class","svelte-sqr61q")},m(v,A){z(v,e,A),h(e,n),h(n,l),h(n,i),h(e,o),h(e,s),h(s,r),h(s,_),h(s,u),ne(u,t[1]),h(s,y),h(s,a),ne(a,t[1]),h(s,w),h(s,f),c||(k=[N(l,"change",ye(t[4])),N(u,"change",t[9]),N(u,"input",t[9]),N(a,"input",t[10])],c=!0)},p(v,[A]){A&1&&(l.checked=v[0]),A&2&&ne(u,v[1]),A&2&&pe(a.value)!==v[1]&&ne(a,v[1])},i:U,o:U,d(v){v&&M(e),c=!1,be(k)}}}function yn(t,e,n){let l,i,{pattern:o={}}=e,{monome:s}=e,{x:r}=e,{id:_,active:u,toggle:y,length:a}=o;Z(t,u,c=>n(0,l=c)),Z(t,a,c=>n(1,i=c)),o.onactivity=()=>{s.gridLed(r,0,0),setTimeout(()=>l&&s.gridLed(r,0,1),50)};function w(){i=pe(this.value),a.set(i)}function f(){i=pe(this.value),a.set(i)}return t.$$set=c=>{"pattern"in c&&n(6,o=c.pattern),"monome"in c&&n(7,s=c.monome),"x"in c&&n(8,r=c.x)},t.$$.update=()=>{t.$$.dirty&385&&s.gridLed(r,0,l)},[l,i,_,u,y,a,o,s,r,w,f]}class wn extends oe{constructor(e){super();ie(this,e,yn,kn,re,{pattern:6,monome:7,x:8})}}function mt(t,e,n){const l=t.slice();return l[11]=e[n],l}function ht(t,e,n){const l=t.slice();return l[14]=e[n],l[16]=n,l}function gt(t,e,n){const l=t.slice();return l[17]=e[n],l}function Cn(t){let e,n,l,i;function o(r){t[8](r)}let s={};return t[3]!==void 0&&(s.selected=t[3]),n=new nn({props:s}),We.push(()=>Xe(n,"selected",o)),{c(){e=C("section"),ae(n.$$.fragment)},m(r,_){z(r,e,_),fe(n,e,null),i=!0},p(r,_){const u={};!l&&_&8&&(l=!0,u.selected=r[3],Ye(()=>l=!1)),n.$set(u)},i(r){i||(ee(n.$$.fragment,r),i=!0)},o(r){te(n.$$.fragment,r),i=!1},d(r){r&&M(e),_e(n)}}}function Ln(t){let e,n,l,i,o,s=[],r=new Map,_,u,y,a,w,f,c,k,v=[],A=new Map,B,L,p,E,S=[],G=new Map,J,V=t[4];const F=b=>b[17];for(let b=0;b<V.length;b+=1){let g=gt(t,V,b),I=F(g);r.set(I,s[b]=bt(I,g))}u=new pn({props:{files:t[0]}}),a=new vn({props:{bpm:t[1],quantize:t[2]}});let R=t[6];const Q=b=>b[14];for(let b=0;b<R.length;b+=1){let g=ht(t,R,b),I=Q(g);A.set(I,v[b]=vt(I,g))}let W=t[5];const le=b=>b[11];for(let b=0;b<W.length;b+=1){let g=mt(t,W,b),I=le(g);G.set(I,S[b]=kt(I,g))}return{c(){e=C("section"),n=C("table"),l=C("thead"),l.innerHTML=`<th>File</th> 
					<th></th> 
					<th>Octave</th> 
					<th>Speed</th> 
					<th></th> 
					<th>Group</th>`,i=O(),o=C("tbody");for(let b=0;b<s.length;b+=1)s[b].c();_=O(),ae(u.$$.fragment),y=O(),ae(a.$$.fragment),w=O(),f=C("fieldset"),c=C("legend"),c.textContent="Patterns",k=O();for(let b=0;b<v.length;b+=1)v[b].c();B=O(),L=C("fieldset"),p=C("legend"),p.textContent="Groups",E=O();for(let b=0;b<S.length;b+=1)S[b].c();d(e,"class","samples svelte-sbddm5"),d(c,"class","svelte-sbddm5"),d(f,"class","svelte-sbddm5"),d(p,"class","svelte-sbddm5"),d(L,"class","svelte-sbddm5")},m(b,g){z(b,e,g),h(e,n),h(n,l),h(n,i),h(n,o);for(let I=0;I<s.length;I+=1)s[I].m(o,null);h(e,_),fe(u,e,null),z(b,y,g),fe(a,b,g),z(b,w,g),z(b,f,g),h(f,c),h(f,k);for(let I=0;I<v.length;I+=1)v[I].m(f,null);z(b,B,g),z(b,L,g),h(L,p),h(L,E);for(let I=0;I<S.length;I+=1)S[I].m(L,null);J=!0},p(b,g){g&57&&(V=b[4],Ee(),s=Re(s,g,F,1,b,V,r,o,Fe,bt,null,gt),Se());const I={};g&1&&(I.files=b[0]),u.$set(I);const x={};g&2&&(x.bpm=b[1]),g&4&&(x.quantize=b[2]),a.$set(x),g&104&&(R=b[6],Ee(),v=Re(v,g,Q,1,b,R,A,f,Fe,vt,null,ht),Se()),g&40&&(W=b[5],Ee(),S=Re(S,g,le,1,b,W,G,L,Fe,kt,null,mt),Se())},i(b){if(!J){for(let g=0;g<V.length;g+=1)ee(s[g]);ee(u.$$.fragment,b),ee(a.$$.fragment,b);for(let g=0;g<R.length;g+=1)ee(v[g]);for(let g=0;g<W.length;g+=1)ee(S[g]);J=!0}},o(b){for(let g=0;g<s.length;g+=1)te(s[g]);te(u.$$.fragment,b),te(a.$$.fragment,b);for(let g=0;g<v.length;g+=1)te(v[g]);for(let g=0;g<S.length;g+=1)te(S[g]);J=!1},d(b){b&&M(e);for(let g=0;g<s.length;g+=1)s[g].d();_e(u),b&&M(y),_e(a,b),b&&M(w),b&&M(f);for(let g=0;g<v.length;g+=1)v[g].d();b&&M(B),b&&M(L);for(let g=0;g<S.length;g+=1)S[g].d()}}}function bt(t,e){let n,l,i;return l=new cn({props:{sample:e[17],groups:e[5],monome:e[3],files:e[0]}}),{key:t,first:null,c(){n=Ie(),ae(l.$$.fragment),this.first=n},m(o,s){z(o,n,s),fe(l,o,s),i=!0},p(o,s){e=o;const r={};s&16&&(r.sample=e[17]),s&32&&(r.groups=e[5]),s&8&&(r.monome=e[3]),s&1&&(r.files=e[0]),l.$set(r)},i(o){i||(ee(l.$$.fragment,o),i=!0)},o(o){te(l.$$.fragment,o),i=!1},d(o){o&&M(n),_e(l,o)}}}function vt(t,e){let n,l,i;return l=new wn({props:{pattern:e[14],x:e[16]+e[5].length,monome:e[3]}}),{key:t,first:null,c(){n=Ie(),ae(l.$$.fragment),this.first=n},m(o,s){z(o,n,s),fe(l,o,s),i=!0},p(o,s){e=o;const r={};s&64&&(r.pattern=e[14]),s&96&&(r.x=e[16]+e[5].length),s&8&&(r.monome=e[3]),l.$set(r)},i(o){i||(ee(l.$$.fragment,o),i=!0)},o(o){te(l.$$.fragment,o),i=!1},d(o){o&&M(n),_e(l,o)}}}function kt(t,e){let n,l,i;return l=new hn({props:{monome:e[3],group:e[11]}}),{key:t,first:null,c(){n=Ie(),ae(l.$$.fragment),this.first=n},m(o,s){z(o,n,s),fe(l,o,s),i=!0},p(o,s){e=o;const r={};s&8&&(r.monome=e[3]),s&32&&(r.group=e[11]),l.$set(r)},i(o){i||(ee(l.$$.fragment,o),i=!0)},o(o){te(l.$$.fragment,o),i=!1},d(o){o&&M(n),_e(l,o)}}}function qn(t){let e,n,l,i,o,s,r;const _=[Ln,Cn],u=[];function y(a,w){return a[3]?0:1}return o=y(t),s=u[o]=_[o](t),{c(){e=C("header"),n=C("h1"),n.textContent=`svemlr v${jt}`,l=O(),i=C("main"),s.c(),d(n,"class","svelte-sbddm5")},m(a,w){z(a,e,w),h(e,n),z(a,l,w),z(a,i,w),u[o].m(i,null),r=!0},p(a,[w]){let f=o;o=y(a),o===f?u[o].p(a,w):(Ee(),te(u[f],1,1,()=>{u[f]=null}),Se(),s=u[o],s?s.p(a,w):(s=u[o]=_[o](a),s.c()),ee(s,1),s.m(i,null))},i(a){r||(ee(s),r=!0)},o(a){te(s),r=!1},d(a){a&&M(e),a&&M(l),a&&M(i),u[o].d()}}}function Sn(t,e,n){let l,i,o;Z(t,Ne,c=>n(4,l=c)),Z(t,Be,c=>n(5,i=c)),Z(t,Ve,c=>n(6,o=c));const s=Pt();let{router:r={}}=e,{files:_={}}=e,{bpm:u={}}=e,{quantize:y={}}=e,a=null;async function w(c){s.get("audioContext").resume();const{x:k,y:v}=await et(c);xt(k,v,s),r.start(c)}function f(c){a=c,n(3,a)}return t.$$set=c=>{"router"in c&&n(7,r=c.router),"files"in c&&n(0,_=c.files),"bpm"in c&&n(1,u=c.bpm),"quantize"in c&&n(2,y=c.quantize)},t.$$.update=()=>{t.$$.dirty&8&&a&&w(a)},[_,u,y,a,l,i,o,r,f]}class En extends oe{constructor(e){super();ie(this,e,Sn,qn,re,{router:7,files:0,bpm:1,quantize:2})}}var we=new Map;const yt=[];let de,wt,Ct,Ke=ve(16,()=>ve(16,0));function Ce(t,e){yt.push({matcher:t,handler:e})}async function zn(t){Lt(),t.addEventListener("gridKeyDown",wt=({detail:{x:l,y:i}})=>Ue({x:l,y:i,state:1,source:"press"})),t.addEventListener("gridKeyUp",Ct=({detail:{x:l,y:i}})=>Ue({x:l,y:i,state:0,source:"press"})),de=t;const{x:e,y:n}=await et(t);Ke=ve(n,()=>ve(e,0))}function Lt(){de==null||de.removeEventListener("gridKeyDown",wt),de==null||de.removeEventListener("gridKeyUp",Ct)}function Ue({x:t,y:e,state:n,source:l}){l==="press"&&(Ke[e][t]=Number(n));const i=Mn(t,e,n,l);if(!i)return;const o={x:t,y:e,state:n,grid:Ke};Array.isArray(i.handler)?i.handler.forEach(s=>s(o)):i.handler(o)}function Mn(t,e,n,l){return yt.find(({matcher:i})=>i({x:t,y:e,state:n,source:l}))}var qt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",route:Ce,start:zn,stop:Lt,handle:Ue}),St={loop:({x:t,y:e,grid:n})=>{const l=Pe[e-1],i=n[e].reduce((o,s,r)=>s?o.concat(r):o,[]);i.length===1?(l.resetLoopPoints(),l.start(t)):i.length===2&&l.loopBetween(i)},replay({x:t,y:e}){const n=Pe[e-1];n.resetLoopPoints(),n.start(t)}},An={change:({x:t,state:e,grid:n})=>{const l=n[0].reduce((s,r,_)=>r?s.concat(_):s,[]),i=l.includes(n[0].length-2),o=l.includes(n[0].length-1);e?i&&o?ue[t].toggleMute():i?ue[t].startDecreasingLevel():o?ue[t].startIncreasingLevel():ue[t].stop():(ue[t].stopDecreasingLevel(),ue[t].stopIncreasingLevel())}},Et={record:({x:t,y:e,state:n})=>{He.forEach(l=>l.record({x:t,y:e,state:n}))},toggle:({x:t})=>{const e=ue.length,n=t-e;He[n].toggle()}};Ce(({y:t,state:e,source:n})=>t>0&&n==="press"&&e,[St.loop,Et.record]);Ce(({y:t,state:e,source:n})=>t>0&&n==="pattern"&&e,[St.replay]);Ce(({x:t,y:e})=>e===0&&t<4,An.change);Ce(({x:t,y:e,state:n})=>e==0&&(t==4||t==5)&&n,Et.toggle);const{subscribe:Tn,update:Dn}=H([]);function On(t=[]){t=[...t],Dn(e=>Kt([...e,...t],n=>n.name))}const In={subscribe:Tn,add:On},ze=H(90),je=H(16);function Rn({audioContext:t,bpm:e,quantize:n}){let l=new Vt(t),i=[],o=!1,s;function r(){const f=a(e,n);l.start(),s=l.setTimeout(y,f).repeat(f),o=!0}function _(){!o||(s.clear(),s=null,l.stop(),o=!1)}function u(f,c=[],k={}){if(k.in!=null){let v=l.setTimeout(()=>f.apply(null,c),k.in);return k.repeat&&(v=v.repeat(k.repeat)),v}else i.push({fn:f,args:c})}function y(){for(;i.length;){const{fn:f,args:c}=i.shift();f.apply(null,c)}}function a(f,c){return 60/f/c}function w(f){!o||l.timeStretch(t.currentTime,[s],f)}return{start:r,stop:_,schedule:u,set bpm(f){w(e/f),e=f},set quantize(f){w(n/f),n=f}}}const zt=new AudioContext,Me=Rn({audioContext:zt,bpm:Le(ze),quantize:Le(je)});Me.start();ze.subscribe(t=>Me.bpm=t);je.subscribe(t=>Me.quantize=t);we.set("audioContext",zt);we.set("scheduler",Me);we.set("bpm",ze);we.set("router",qt);new En({target:document.getElementById("app"),props:{router:qt,files:In,bpm:ze,quantize:je},context:we});
