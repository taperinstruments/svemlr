var dt=Object.defineProperty,ht=Object.defineProperties;var mt=Object.getOwnPropertyDescriptors;var Be=Object.getOwnPropertySymbols;var gt=Object.prototype.hasOwnProperty,bt=Object.prototype.propertyIsEnumerable;var Re=(t,e,n)=>e in t?dt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ee=(t,e)=>{for(var n in e||(e={}))gt.call(e,n)&&Re(t,n,e[n]);if(Be)for(var n of Be(e))bt.call(e,n)&&Re(t,n,e[n]);return t},je=(t,e)=>ht(t,mt(e));import{d as x,w as Z,g as Le,t as vt,S as ce,i as ue,s as ae,e as y,a as J,b as I,c as z,f as g,h as me,j as T,k as h,l as Pe,m as we,n as V,o as j,p as ie,q as Ce,r as Fe,u as kt,v as yt,x as ge,y as _e,z as de,A as le,B as Lt,C as Q,D as $,E as he,F as be,G as Ne,H as ee,I as fe,J as Ae,K as He,L as Ve,M as wt,N as Ct,O as St,P as Me,Q as ze,R as qt}from"./vendor.59a9d5da.js";const Et=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}};Et();function At(){let t=function(n){};return{promise:new Promise(n=>t=n),resolve:t}}function Se(t,e){const n=[];for(let l=0;l<t;l++)n[l]=typeof e=="function"?e(l):e;return n}function Mt(t,e){const n=[];let l=0;const o=t.length;for(;l<o;)n.push(t.slice(l,l+=e));return n}function zt(t,e){return t.reduce((n,l)=>{const o=e(l);return n.find(i=>e(i)===o)||n.push(l),n},[])}function Tt(t,e,n){const l=8;Mt(n,l).forEach((i,s)=>t.gridLedRow(s*l,e,i))}async function Ot(t){return new Promise(e=>{t.on("getGridSize",n=>e(n)),t.getGridSize()})}const Dt="0.1.0";function Te(t,e,n,l){return Se(t,o=>{const i=e(Ee({id:o},l));return n.push(i),i}),n}const te=[];function It({id:t,audioContext:e}){let n;const l=e.createGain();l.connect(e.destination);const o=Z(!1),i=Z(1),s=Z(!1);x([i,s],([L,a])=>a?0:L).subscribe(L=>l.gain.setTargetAtTime(L,e.currentTime,.015));function u(L,a){return c(),n=L,L.connect(l),L.start(0,a),o.set(!0),L}function c(){n==null||n.stop(),o.set(!1)}function f(){s.set(!Le(s))}const p=1e3,b=1e3/25,_=1/(p/b);let C;function v(){C=R(i,_,b)}function B(){C=R(i,-_,b)}function R(L,a,E){let A=Le(L);return setInterval(function(){A=Math.max(0,Math.min(A+a,1)),L.set(A)},E)}function P(){clearInterval(C)}return{id:t,level:i,muted:s,active:o,play:u,stop:c,toggleMute:f,startIncreasingLevel:v,startDecreasingLevel:B,stopIncreasingLevel:P,stopDecreasingLevel:P}}const Ge=new FileReader;function Bt(t,e){return new Promise(n=>{Ge.readAsArrayBuffer(t),Ge.onload=async({target:{result:l}})=>{n(await e.decodeAudioData(l))}})}function Rt(t){const e=new AudioBuffer({sampleRate:t.sampleRate,numberOfChannels:t.numberOfChannels,length:t.length});for(let l=0;l<t.numberOfChannels;l++){const o=t.getChannelData(l),i=e.getChannelData(l);for(var n=t.length-1;n>=0;n--)i[t.length-n-1]=o[n]}return e}function jt(t,e,n){const l=e.createBufferSource();t&&(l.buffer=t);const{loopStart:o,loopEnd:i,loop:s,speed:r}=n;return l.loop=!!s,o!=null&&(l.loopStart=o),i!=null&&(l.loopEnd=i),r!=null&&(l.playbackRate.value=r),l}function Pt(t,e){let n,l,o;t.addEventListener("ended",s);function i(v=0){n=v,e(C()),l=u(),o=setInterval(r,1e3/60)}function s(){clearInterval(o)}function r(){const v=u();n+=(v-l)*_(),b()&&n>p()&&(n=f()+(n-p())),e(C()),l=v}function u(){return+new Date/1e3}function c(){return t.buffer.duration}function f(){return t.loopStart||0}function p(){return t.loopEnd||c()}function b(){return t.loop}function _(){return t.playbackRate.value}function C(){return Math.min(n/c()-Number.MIN_VALUE,1)}return{start:i,stop:s,check:r}}const ve=[];function Ft({id:t,audioContext:e,group:n,stepCount:l,bpm:o,scheduler:i}){n=Z(n);const s=Z(null),r=x(s,m=>m&&Rt(m)),u=x(s,m=>(m==null?void 0:m.duration)||0),c=Z(0),f=Z(!1),p=Z(0),b=Z(),_=Z(l),C=x(_,m=>Se(l,M=>({enabled:M<m}))),v=x(o,m=>60/m),B=x([v,_],([m,M])=>m*M),R=Z(0),P=Z(!1),L=x([R,P,_],([m,M,k])=>M?oe(Math.floor(m*k)):null),a=x([u,B,c],([m,M,k])=>m?m/M*Math.pow(2,k):1),E=x([u,_,p],([m,M,k])=>m/M*k),A=x([u,_,b],([m,M,k])=>m/M*(k!=null?k:M)),D=x(E,m=>m!=null),ne={group:n,buffer:s,reffub:r,duration:u,enabledStepCount:_,steps:C,currentStep:L,octave:c,speed:a,reverse:f,loopStart:E,loopEnd:A,loop:D,playing:P,progress:R},F={};for(const m in ne)ne[m].subscribe(M=>F[m]=M);let q,N;E.subscribe(m=>{q&&(q.loopStart=m),N==null||N.check()}),A.subscribe(m=>{q&&(q.loopEnd=m),N==null||N.check()}),D.subscribe(m=>{q&&(q.loop=m),N==null||N.check()}),a.subscribe(m=>{q&&(q.playbackRate.value=m),N==null||N.check()}),f.subscribe(()=>{const{playing:m,duration:M,progress:k}=F;m&&S((1-k)*M)}),u.subscribe(async m=>{const{playing:M,progress:k}=F;M&&(N==null||N.check(),await vt(),S(k*m))});function d(m){!F.buffer||!U(m)||i.schedule(function(){S(w(oe(m)))})}function S(m){q=O(),F.group.play(q,m),N==null||N.stop(),N=Pt(q,R.set),N.start(m),P.set(!0)}function G(){p.set(0),b.set(null)}function X(m){if(!U(m[0])||!U(m[1]))return;m=oe(m);const{reverse:M}=F;p.set(M?m[1]:m[0]),b.set(M?m[0]:m[1])}function w(m){const{duration:M,enabledStepCount:k}=F;return M/k*m}function U(m){return m<F.enabledStepCount}function oe(m){return Array.isArray(m)?m.map(pe):pe(m)}function pe(m){if(m==null)return m;const{enabledStepCount:M,reverse:k}=F;return k?Math.abs(m-(M-1)):m}let se;function O(){const{reverse:m,buffer:M,reffub:k,loop:W,loopStart:Y,loopEnd:H,speed:re}=F;return se=+new Date+Math.random(),q=jt(m?k:M,e,{loop:W,loopStart:Y,loopEnd:H,speed:re}),q.onended=(_t=>()=>K(_t))(se),q}function K(m){(!m||se===m)&&P.set(!1)}return je(Ee({id:t},ne),{start:d,resetLoopPoints:G,loopBetween:X})}const ke=[];function Nt({id:t,bpm:e,scheduler:n,router:l}){const o=Z(!1),i=Z(!1),s=x([o,i],([a,E])=>a||E),r=Z(8),u=x([e,r],([a,E])=>60/a*E);let c=()=>{},f=[],p=null;const b={recordable:o,playing:i,active:s,length:r,duration:u},_={};for(const a in b)b[a].subscribe(E=>_[a]=E);function C(){_.active?(o.set(!1),i.set(!1),L()):o.set(!0)}function v(a){const{recordable:E,duration:A}=_;!E||f.push(R(a))===1&&(p=n.schedule(B,null,{in:A}))}function B(){o.set(!1),i.set(!0)}function R({x:a,y:E,state:A}){const{duration:D}=_;return n.schedule(()=>{l.handle({x:a,y:E,state:A,source:"pattern"}),n.schedule(c)},null,{in:D,repeat:D})}function P(){p==null||p.clear(),p=null,i.set(!1)}function L(){f.forEach(a=>a.clear()),f=[],P()}return{id:t,toggle:C,record:v,recordable:o,playing:i,active:s,length:r,set onactivity(a){c=a}}}function Ue(t,e,n){const l=t.slice();return l[4]=e[n],l}function Ke(t){let e,n=t[4].name+"",l,o,i;return{c(){e=y("option"),l=J(n),o=I(),e.__value=i=t[4],e.value=e.__value},m(s,r){z(s,e,r),g(e,l),g(e,o)},p(s,r){r&4&&n!==(n=s[4].name+"")&&me(l,n),r&4&&i!==(i=s[4])&&(e.__value=i,e.value=e.__value)},d(s){s&&T(e)}}}function Ht(t){let e,n,l,o=t[2],i=[];for(let s=0;s<o.length;s+=1)i[s]=Ke(Ue(t,o,s));return{c(){e=y("select");for(let s=0;s<i.length;s+=1)i[s].c();h(e,"class","svelte-1hx4o8j"),t[0]===void 0&&Pe(()=>t[3].call(e))},m(s,r){z(s,e,r);for(let u=0;u<i.length;u+=1)i[u].m(e,null);we(e,t[0]),n||(l=V(e,"change",t[3]),n=!0)},p(s,[r]){if(r&4){o=s[2];let u;for(u=0;u<o.length;u+=1){const c=Ue(s,o,u);i[u]?i[u].p(c,r):(i[u]=Ke(c),i[u].c(),i[u].m(e,null))}for(;u<i.length;u+=1)i[u].d(1);i.length=o.length}r&5&&we(e,s[0])},i:j,o:j,d(s){s&&T(e),ie(i,s),n=!1,l()}}}function Vt(t,e,n){let l,o=j,i=()=>(o(),o=Ce(s,c=>n(2,l=c)),s);t.$$.on_destroy.push(()=>o());let{files:s}=e;i();let{selected:r}=e;function u(){r=Fe(this),n(0,r)}return t.$$set=c=>{"files"in c&&i(n(1,s=c.files)),"selected"in c&&n(0,r=c.selected)},[r,s,l,u]}class Gt extends ce{constructor(e){super();ue(this,e,Vt,Ht,ae,{files:1,selected:0})}}function Ze(t,e,n){const l=t.slice();return l[34]=e[n],l}function We(t,e,n){const l=t.slice();return l[37]=e[n],l[39]=n,l}function Qe(t){let e,n,l,o,i,s,r;function u(){return t[25](t[39])}return{c(){e=y("input"),h(e,"name",n="sample_"+t[11]+"_step"),h(e,"type","radio"),e.value=l=t[39],e.checked=o=t[3]==t[39],e.disabled=i=!t[37].enabled,h(e,"autocomplete","off")},m(c,f){z(c,e,f),s||(r=V(e,"click",ge(u)),s=!0)},p(c,f){t=c,f[0]&8&&o!==(o=t[3]==t[39])&&(e.checked=o),f[0]&16&&i!==(i=!t[37].enabled)&&(e.disabled=i)},d(c){c&&T(e),s=!1,r()}}}function Je(t){let e,n,l,o,i;return{c(){e=y("input"),h(e,"name",n="sample_"+t[11]+"_group"),h(e,"type","radio"),e.__value=l=t[34],e.value=e.__value,h(e,"autocomplete","off"),t[31][0].push(e)},m(s,r){z(s,e,r),e.checked=e.__value===t[10],o||(i=V(e,"change",t[30]),o=!0)},p(s,r){r[0]&1&&l!==(l=s[34])&&(e.__value=l,e.value=e.__value),r[0]&1024&&(e.checked=e.__value===s[10])},d(s){s&&T(e),t[31][0].splice(t[31][0].indexOf(e),1),o=!1,i()}}}function Ut(t){let e,n,l,o,i,s,r,u,c,f,p,b,_=(t[7]>=0?"+":"")+"",C,v,B,R,P,L,a,E,A=t[8].toFixed(2)+"",D,ne,F,q,N,d,S,G,X,w,U,oe;function pe(k){t[24](k)}let se={files:t[1]};t[2]!==void 0&&(se.selected=t[2]),l=new Gt({props:se}),kt.push(()=>yt(l,"selected",pe));let O=t[4],K=[];for(let k=0;k<O.length;k+=1)K[k]=Qe(We(t,O,k));let m=t[0],M=[];for(let k=0;k<m.length;k+=1)M[k]=Je(Ze(t,m,k));return{c(){e=y("tr"),n=y("td"),_e(l.$$.fragment),i=I(),s=y("td"),r=y("div");for(let k=0;k<K.length;k+=1)K[k].c();u=I(),c=y("input"),f=I(),p=y("td"),b=y("span"),C=J(_),v=J(t[7]),B=I(),R=y("button"),R.textContent="-",P=I(),L=y("button"),L.textContent="+",a=I(),E=y("td"),D=J(A),ne=I(),F=y("td"),q=y("input"),N=I(),d=y("label"),S=J("Rev"),G=I(),X=y("td");for(let k=0;k<M.length;k+=1)M[k].c();h(n,"class","svelte-2kpfy0"),h(c,"type","range"),h(c,"min","1"),h(c,"max",t[5]),h(c,"step","1"),h(c,"class","svelte-2kpfy0"),h(s,"class","svelte-2kpfy0"),h(R,"aria-label","Decrement octave"),h(L,"aria-label","Increment octave"),h(p,"class","svelte-2kpfy0"),h(E,"class","svelte-2kpfy0"),h(q,"id","sample_"+t[11]+"_reverse"),h(q,"type","checkbox"),h(d,"for","sample_"+t[11]+"_reverse"),h(F,"class","svelte-2kpfy0"),h(X,"class","svelte-2kpfy0")},m(k,W){z(k,e,W),g(e,n),de(l,n,null),g(e,i),g(e,s),g(s,r);for(let Y=0;Y<K.length;Y+=1)K[Y].m(r,null);g(s,u),g(s,c),le(c,t[6]),g(e,f),g(e,p),g(p,b),g(b,C),g(b,v),g(p,B),g(p,R),g(p,P),g(p,L),g(e,a),g(e,E),g(E,D),g(e,ne),g(e,F),g(F,q),q.checked=t[9],g(F,N),g(F,d),g(d,S),g(e,G),g(e,X);for(let Y=0;Y<M.length;Y+=1)M[Y].m(X,null);w=!0,U||(oe=[V(c,"change",t[26]),V(c,"input",t[26]),V(R,"click",t[27]),V(L,"click",t[28]),V(q,"change",t[29])],U=!0)},p(k,W){const Y={};if(W[0]&2&&(Y.files=k[1]),!o&&W[0]&4&&(o=!0,Y.selected=k[2],Lt(()=>o=!1)),l.$set(Y),W[0]&1050648){O=k[4];let H;for(H=0;H<O.length;H+=1){const re=We(k,O,H);K[H]?K[H].p(re,W):(K[H]=Qe(re),K[H].c(),K[H].m(r,null))}for(;H<K.length;H+=1)K[H].d(1);K.length=O.length}if((!w||W[0]&32)&&h(c,"max",k[5]),W[0]&64&&le(c,k[6]),(!w||W[0]&128)&&_!==(_=(k[7]>=0?"+":"")+"")&&me(C,_),(!w||W[0]&128)&&me(v,k[7]),(!w||W[0]&256)&&A!==(A=k[8].toFixed(2)+"")&&me(D,A),W[0]&512&&(q.checked=k[9]),W[0]&3073){m=k[0];let H;for(H=0;H<m.length;H+=1){const re=Ze(k,m,H);M[H]?M[H].p(re,W):(M[H]=Je(re),M[H].c(),M[H].m(X,null))}for(;H<M.length;H+=1)M[H].d(1);M.length=m.length}},i(k){w||(Q(l.$$.fragment,k),w=!0)},o(k){$(l.$$.fragment,k),w=!1},d(k){k&&T(e),he(l),ie(K,k),ie(M,k),U=!1,be(oe)}}}function Kt(t,e,n){let l,o,i,s,r,u,c,f,p,b;const _=Ne("audioContext");let{sample:C={}}=e,{id:v,steps:B,enabledStepCount:R,currentStep:P,octave:L,speed:a,reverse:E,buffer:A,group:D,start:ne}=C;ee(t,B,O=>n(4,r=O)),ee(t,R,O=>n(6,u=O)),ee(t,P,O=>n(3,s=O)),ee(t,L,O=>n(7,c=O)),ee(t,a,O=>n(8,f=O)),ee(t,E,O=>n(9,p=O)),ee(t,A,O=>n(32,i=O)),ee(t,D,O=>n(10,b=O));let{groups:F=[]}=e,{monome:q={}}=e,{files:N={}}=e,d;const S=[[]];function G(O){d=O,n(2,d)}const X=O=>ne(O);function w(){u=fe(this.value),R.set(u)}const U=()=>Ae(L,--c,c),oe=()=>Ae(L,++c,c);function pe(){p=this.checked,E.set(p)}function se(){b=this.__value,D.set(b)}return t.$$set=O=>{"sample"in O&&n(21,C=O.sample),"groups"in O&&n(0,F=O.groups),"monome"in O&&n(22,q=O.monome),"files"in O&&n(1,N=O.files)},t.$$.update=()=>{t.$$.dirty[0]&16&&n(5,l=r.length),t.$$.dirty[0]&12582936&&Tt(q,o,r.map((O,K)=>K===s)),t.$$.dirty[0]&4&&d&&Bt(d,_).then(O=>Ae(A,i=O,i))},n(23,o=v+1),[F,N,d,s,r,l,u,c,f,p,b,v,B,R,P,L,a,E,A,D,ne,C,q,o,G,X,w,U,oe,pe,se,S]}class Zt extends ce{constructor(e){super();ue(this,e,Kt,Ut,ae,{sample:21,groups:0,monome:22,files:1},null,[-1,-1])}}function Xe(t,e,n){const l=t.slice();return l[8]=e[n].name,l}function Ye(t){let e,n=t[3],l=[];for(let o=0;o<n.length;o+=1)l[o]=xe(Xe(t,n,o));return{c(){e=y("ul");for(let o=0;o<l.length;o+=1)l[o].c();h(e,"class","svelte-1eckyqf")},m(o,i){z(o,e,i);for(let s=0;s<l.length;s+=1)l[s].m(e,null)},p(o,i){if(i&8){n=o[3];let s;for(s=0;s<n.length;s+=1){const r=Xe(o,n,s);l[s]?l[s].p(r,i):(l[s]=xe(r),l[s].c(),l[s].m(e,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=n.length}},d(o){o&&T(e),ie(l,o)}}}function xe(t){let e,n,l,o,i=t[8]+"",s,r;return{c(){e=y("li"),n=He("svg"),l=He("path"),o=I(),s=J(i),r=I(),h(l,"d","M3.5 2C3.22386 2 3 2.22386 3 2.5V12.5C3 12.7761 3.22386 13 3.5 13H11.5C11.7761 13 12 12.7761 12 12.5V6H8.5C8.22386 6 8 5.77614 8 5.5V2H3.5ZM9 2.70711L11.2929 5H9V2.70711ZM2 2.5C2 1.67157 2.67157 1 3.5 1H8.5C8.63261 1 8.75979 1.05268 8.85355 1.14645L12.8536 5.14645C12.9473 5.24021 13 5.36739 13 5.5V12.5C13 13.3284 12.3284 14 11.5 14H3.5C2.67157 14 2 13.3284 2 12.5V2.5Z"),h(l,"fill","currentColor"),h(l,"fill-rule","evenodd"),h(l,"clip-rule","evenodd"),h(n,"width","15"),h(n,"height","15"),h(n,"viewBox","0 0 15 15"),h(n,"fill","none"),h(n,"xmlns","http://www.w3.org/2000/svg"),h(n,"class","svelte-1eckyqf"),h(e,"class","svelte-1eckyqf")},m(u,c){z(u,e,c),g(e,n),g(n,l),g(e,o),g(e,s),g(e,r)},p(u,c){c&8&&i!==(i=u[8]+"")&&me(s,i)},d(u){u&&T(e)}}}function Wt(t){let e,n,l,o,i,s,r,u,c=t[3].length&&Ye(t);return{c(){e=y("section"),n=y("label"),n.textContent="Audio file drop",l=I(),o=y("div"),i=y("input"),s=I(),c&&c.c(),h(n,"for","files"),h(i,"accept","audio/*"),h(i,"id","files"),h(i,"name","files"),h(i,"type","file"),h(i,"class","svelte-1eckyqf"),h(o,"class","file-drop svelte-1eckyqf"),Ve(o,"dragover",t[2]),h(e,"class","svelte-1eckyqf")},m(f,p){z(f,e,p),g(e,n),g(e,l),g(e,o),g(o,i),g(o,s),c&&c.m(o,null),r||(u=[V(i,"change",t[5]),V(o,"dragover",ge(t[6])),V(o,"dragleave",ge(t[7])),V(o,"drop",ge(t[4]))],r=!0)},p(f,[p]){f[3].length?c?c.p(f,p):(c=Ye(f),c.c(),c.m(o,null)):c&&(c.d(1),c=null),p&4&&Ve(o,"dragover",f[2])},i:j,o:j,d(f){f&&T(e),c&&c.d(),r=!1,be(u)}}}function Qt(t){return t.reduce((e,n)=>{if(n.kind==="file"){const l=n.getAsFile();/^(audio|video)/.test(l.type)&&e.push(l)}return e},[])}function Jt(t,e,n){let l,o=j,i=()=>(o(),o=Ce(s,_=>n(3,l=_)),s);t.$$.on_destroy.push(()=>o());let{files:s}=e;i();let r,u=!1;function c({dataTransfer:_}){n(2,u=!1),s.add(Qt([..._.items]))}function f(){r=this.files,n(1,r)}const p=()=>n(2,u=!0),b=()=>n(2,u=!1);return t.$$set=_=>{"files"in _&&i(n(0,s=_.files))},t.$$.update=()=>{t.$$.dirty&3&&s.add(r)},[s,r,u,l,c,f,p,b]}class Xt extends ce{constructor(e){super();ue(this,e,Jt,Wt,ae,{files:0})}}function Yt(t){let e,n,l,o,i,s,r,u,c,f,p,b,_,C,v;return{c(){e=y("div"),n=y("label"),l=y("input"),i=J(`
    On/Off`),s=I(),r=y("label"),u=y("input"),c=J(`
    Mute`),f=I(),p=y("label"),b=J(`Level
    `),_=y("input"),h(l,"type","checkbox"),l.disabled=o=!t[0],h(n,"class","svelte-37acoc"),h(u,"type","checkbox"),h(r,"class","svelte-37acoc"),h(_,"type","range"),h(_,"min","0"),h(_,"max","1"),h(_,"step","0.01"),h(p,"class","svelte-37acoc")},m(B,R){z(B,e,R),g(e,n),g(n,l),l.checked=t[0],g(n,i),g(e,s),g(e,r),g(r,u),u.checked=t[1],g(r,c),g(e,f),g(e,p),g(p,b),g(p,_),le(_,t[2]),C||(v=[V(l,"change",t[8]),V(u,"change",t[9]),V(_,"change",t[10]),V(_,"input",t[10])],C=!0)},p(B,[R]){R&1&&o!==(o=!B[0])&&(l.disabled=o),R&1&&(l.checked=B[0]),R&2&&(u.checked=B[1]),R&4&&le(_,B[2])},i:j,o:j,d(B){B&&T(e),C=!1,be(v)}}}function xt(t,e,n){let l,o,i,{group:s={}}=e,{monome:r}=e,{id:u,active:c,muted:f,level:p}=s;ee(t,c,v=>n(0,l=v)),ee(t,f,v=>n(1,o=v)),ee(t,p,v=>n(2,i=v));function b(){l=this.checked,c.set(l)}function _(){o=this.checked,f.set(o)}function C(){i=fe(this.value),p.set(i)}return t.$$set=v=>{"group"in v&&n(6,s=v.group),"monome"in v&&n(7,r=v.monome)},t.$$.update=()=>{t.$$.dirty&65&&(l||s.stop()),t.$$.dirty&129&&r.gridLed(u,0,l)},[l,o,i,c,f,p,s,r,b,_,C]}class $t extends ce{constructor(e){super();ue(this,e,xt,Yt,ae,{group:6,monome:7})}}function $e(t,e,n){const l=t.slice();return l[12]=e[n],l}function et(t){let e,n,l=t[12]+"",o,i;return{c(){e=y("option"),n=J("1/"),o=J(l),e.__value=i=t[12],e.value=e.__value},m(s,r){z(s,e,r),g(e,n),g(e,o)},p:j,d(s){s&&T(e)}}}function en(t){let e,n,l,o,i,s,r,u,c,f,p,b,_,C,v,B,R,P=t[4],L=[];for(let a=0;a<P.length;a+=1)L[a]=et($e(t,P,a));return{c(){e=y("label"),e.textContent="Tempo",n=I(),l=y("input"),o=I(),i=y("button"),i.textContent="-4",s=I(),r=y("button"),r.textContent="-1",u=I(),c=y("button"),c.textContent="+1",f=I(),p=y("button"),p.textContent="+4",b=I(),_=y("label"),_.textContent="Quantize",C=I(),v=y("select");for(let a=0;a<L.length;a+=1)L[a].c();h(e,"for","tempo"),h(l,"type","number"),h(l,"id","tempo"),h(l,"size","6"),h(l,"class","svelte-1texyt4"),h(_,"for","quantize"),h(v,"name","quantize"),h(v,"id","quantize"),t[3]===void 0&&Pe(()=>t[11].call(v))},m(a,E){z(a,e,E),z(a,n,E),z(a,l,E),le(l,t[2]),z(a,o,E),z(a,i,E),z(a,s,E),z(a,r,E),z(a,u,E),z(a,c,E),z(a,f,E),z(a,p,E),z(a,b,E),z(a,_,E),z(a,C,E),z(a,v,E);for(let A=0;A<L.length;A+=1)L[A].m(v,null);we(v,t[3]),B||(R=[V(l,"input",t[6]),V(i,"click",t[7]),V(r,"click",t[8]),V(c,"click",t[9]),V(p,"click",t[10]),V(v,"change",t[11])],B=!0)},p(a,[E]){if(E&4&&fe(l.value)!==a[2]&&le(l,a[2]),E&16){P=a[4];let A;for(A=0;A<P.length;A+=1){const D=$e(a,P,A);L[A]?L[A].p(D,E):(L[A]=et(D),L[A].c(),L[A].m(v,null))}for(;A<L.length;A+=1)L[A].d(1);L.length=P.length}E&24&&we(v,a[3])},i:j,o:j,d(a){a&&T(e),a&&T(n),a&&T(l),a&&T(o),a&&T(i),a&&T(s),a&&T(r),a&&T(u),a&&T(c),a&&T(f),a&&T(p),a&&T(b),a&&T(_),a&&T(C),a&&T(v),ie(L,a),B=!1,be(R)}}}function tn(t,e,n){let l,o=j,i=()=>(o(),o=Ce(c,L=>n(2,l=L)),c),s,r=j,u=()=>(r(),r=Ce(f,L=>n(3,s=L)),f);t.$$.on_destroy.push(()=>o()),t.$$.on_destroy.push(()=>r());let{bpm:c}=e;i();let{quantize:f}=e;u();const p=[128,64,32,16,8,4,2];function b(L){c.update(a=>a+L)}function _(){l=fe(this.value),c.set(l)}const C=()=>b(-4),v=()=>b(-1),B=()=>b(1),R=()=>b(4);function P(){s=Fe(this),f.set(s),n(4,p)}return t.$$set=L=>{"bpm"in L&&i(n(0,c=L.bpm)),"quantize"in L&&u(n(1,f=L.quantize))},[c,f,l,s,p,b,_,C,v,B,R,P]}class nn extends ce{constructor(e){super();ue(this,e,tn,en,ae,{bpm:0,quantize:1})}}function ln(t){let e,n,l,o,i,s,r,u,c,f,p,b,_;return{c(){e=y("div"),n=y("label"),l=y("input"),o=J(`
    On/Off`),i=I(),s=y("label"),r=J(`Length
    `),u=y("input"),c=I(),f=y("input"),p=J(`
    beats`),h(l,"id","pattern_"+t[2]+"_active"),h(l,"name","pattern_"+t[2]+"_active"),h(l,"type","checkbox"),l.checked=t[0],h(n,"class","svelte-37acoc"),h(u,"type","range"),h(u,"min","1"),h(u,"max","32"),h(f,"type","number"),h(f,"min","1"),h(f,"max","32"),h(s,"class","svelte-37acoc")},m(C,v){z(C,e,v),g(e,n),g(n,l),g(n,o),g(e,i),g(e,s),g(s,r),g(s,u),le(u,t[1]),g(s,c),g(s,f),le(f,t[1]),g(s,p),b||(_=[V(l,"change",ge(t[4])),V(u,"change",t[8]),V(u,"input",t[8]),V(f,"input",t[9])],b=!0)},p(C,[v]){v&1&&(l.checked=C[0]),v&2&&le(u,C[1]),v&2&&fe(f.value)!==C[1]&&le(f,C[1])},i:j,o:j,d(C){C&&T(e),b=!1,be(_)}}}function on(t,e,n){let l,o,{pattern:i={}}=e,{monome:s}=e,{id:r,active:u,toggle:c,length:f}=i;ee(t,u,C=>n(0,l=C)),ee(t,f,C=>n(1,o=C));const p=r+te.length;i.onactivity=()=>{s.gridLed(p,0,0),setTimeout(()=>l&&s.gridLed(p,0,1),50)};function b(){o=fe(this.value),f.set(o)}function _(){o=fe(this.value),f.set(o)}return t.$$set=C=>{"pattern"in C&&n(6,i=C.pattern),"monome"in C&&n(7,s=C.monome)},t.$$.update=()=>{t.$$.dirty&129&&s.gridLed(p,0,l)},[l,o,r,u,c,f,i,s,b,_]}class sn extends ce{constructor(e){super();ue(this,e,on,ln,ae,{pattern:6,monome:7})}}function tt(t,e,n){const l=t.slice();return l[9]=e[n],l}function nt(t,e,n){const l=t.slice();return l[12]=e[n],l}function lt(t,e,n){const l=t.slice();return l[15]=e[n],l}function ot(t){let e,n,l,o,i,s,r,u,c;return{c(){e=y("p"),e.innerHTML="Before you start, svemlr requires that <strong>serialosc is disabled</strong>. On macOS open Terminal and execute:",n=I(),l=y("pre"),l.innerHTML='<code class="svelte-1oj1ab1">launchctl unload /Library/LaunchAgents/org.monome.serialosc.plist</code>',o=I(),i=y("p"),i.innerHTML='To re-enable: <code class="svelte-1oj1ab1">launchctl load /Library/LaunchAgents/org.monome.serialosc.plist</code>',s=I(),r=y("button"),r.textContent="Connect",h(l,"class","svelte-1oj1ab1")},m(f,p){z(f,e,p),z(f,n,p),z(f,l,p),z(f,o,p),z(f,i,p),z(f,s,p),z(f,r,p),u||(c=V(r,"click",t[5]),u=!0)},p:j,d(f){f&&T(e),f&&T(n),f&&T(l),f&&T(o),f&&T(i),f&&T(s),f&&T(r),u=!1,c()}}}function rn(t){return{c:j,m:j,p:j,i:j,o:j,d:j}}function cn(t){let e,n,l,o,i,s,r,u,c,f,p,b,_,C,v,B,R,P,L=ve,a=[];for(let d=0;d<L.length;d+=1)a[d]=st(lt(t,L,d));const E=d=>$(a[d],1,1,()=>{a[d]=null});r=new Xt({props:{files:t[0]}}),c=new nn({props:{bpm:t[1],quantize:t[2]}});let A=ke,D=[];for(let d=0;d<A.length;d+=1)D[d]=it(nt(t,A,d));const ne=d=>$(D[d],1,1,()=>{D[d]=null});let F=te,q=[];for(let d=0;d<F.length;d+=1)q[d]=rt(tt(t,F,d));const N=d=>$(q[d],1,1,()=>{q[d]=null});return{c(){e=y("section"),n=y("table"),l=y("thead"),l.innerHTML=`<th>File</th> 
					<th></th> 
					<th>Octave</th> 
					<th>Speed</th> 
					<th></th> 
					<th>Group</th>`,o=I(),i=y("tbody");for(let d=0;d<a.length;d+=1)a[d].c();s=I(),_e(r.$$.fragment),u=I(),_e(c.$$.fragment),f=I(),p=y("fieldset"),b=y("legend"),b.textContent="Patterns",_=I();for(let d=0;d<D.length;d+=1)D[d].c();C=I(),v=y("fieldset"),B=y("legend"),B.textContent="Groups",R=I();for(let d=0;d<q.length;d+=1)q[d].c();h(e,"class","samples svelte-1oj1ab1"),h(b,"class","svelte-1oj1ab1"),h(p,"class","svelte-1oj1ab1"),h(B,"class","svelte-1oj1ab1"),h(v,"class","svelte-1oj1ab1")},m(d,S){z(d,e,S),g(e,n),g(n,l),g(n,o),g(n,i);for(let G=0;G<a.length;G+=1)a[G].m(i,null);g(e,s),de(r,e,null),z(d,u,S),de(c,d,S),z(d,f,S),z(d,p,S),g(p,b),g(p,_);for(let G=0;G<D.length;G+=1)D[G].m(p,null);z(d,C,S),z(d,v,S),g(v,B),g(v,R);for(let G=0;G<q.length;G+=1)q[G].m(v,null);P=!0},p(d,S){if(S&17){L=ve;let w;for(w=0;w<L.length;w+=1){const U=lt(d,L,w);a[w]?(a[w].p(U,S),Q(a[w],1)):(a[w]=st(U),a[w].c(),Q(a[w],1),a[w].m(i,null))}for(Me(),w=L.length;w<a.length;w+=1)E(w);ze()}const G={};S&1&&(G.files=d[0]),r.$set(G);const X={};if(S&2&&(X.bpm=d[1]),S&4&&(X.quantize=d[2]),c.$set(X),S&16){A=ke;let w;for(w=0;w<A.length;w+=1){const U=nt(d,A,w);D[w]?(D[w].p(U,S),Q(D[w],1)):(D[w]=it(U),D[w].c(),Q(D[w],1),D[w].m(p,null))}for(Me(),w=A.length;w<D.length;w+=1)ne(w);ze()}if(S&16){F=te;let w;for(w=0;w<F.length;w+=1){const U=tt(d,F,w);q[w]?(q[w].p(U,S),Q(q[w],1)):(q[w]=rt(U),q[w].c(),Q(q[w],1),q[w].m(v,null))}for(Me(),w=F.length;w<q.length;w+=1)N(w);ze()}},i(d){if(!P){for(let S=0;S<L.length;S+=1)Q(a[S]);Q(r.$$.fragment,d),Q(c.$$.fragment,d);for(let S=0;S<A.length;S+=1)Q(D[S]);for(let S=0;S<F.length;S+=1)Q(q[S]);P=!0}},o(d){a=a.filter(Boolean);for(let S=0;S<a.length;S+=1)$(a[S]);$(r.$$.fragment,d),$(c.$$.fragment,d),D=D.filter(Boolean);for(let S=0;S<D.length;S+=1)$(D[S]);q=q.filter(Boolean);for(let S=0;S<q.length;S+=1)$(q[S]);P=!1},d(d){d&&T(e),ie(a,d),he(r),d&&T(u),he(c,d),d&&T(f),d&&T(p),ie(D,d),d&&T(C),d&&T(v),ie(q,d)}}}function st(t){let e,n;return e=new Zt({props:{sample:t[15],groups:te,monome:t[3],files:t[0]}}),{c(){_e(e.$$.fragment)},m(l,o){de(e,l,o),n=!0},p(l,o){const i={};o&1&&(i.files=l[0]),e.$set(i)},i(l){n||(Q(e.$$.fragment,l),n=!0)},o(l){$(e.$$.fragment,l),n=!1},d(l){he(e,l)}}}function it(t){let e,n;return e=new sn({props:{pattern:t[12],monome:t[3]}}),{c(){_e(e.$$.fragment)},m(l,o){de(e,l,o),n=!0},p:j,i(l){n||(Q(e.$$.fragment,l),n=!0)},o(l){$(e.$$.fragment,l),n=!1},d(l){he(e,l)}}}function rt(t){let e,n;return e=new $t({props:{monome:t[3],group:t[9]}}),{c(){_e(e.$$.fragment)},m(l,o){de(e,l,o),n=!0},p:j,i(l){n||(Q(e.$$.fragment,l),n=!0)},o(l){$(e.$$.fragment,l),n=!1},d(l){he(e,l)}}}function un(t){return{c:j,m:j,p:j,i:j,o:j,d:j}}function an(t){let e,n,l,o,i,s,r=!t[3]&&ot(t),u={ctx:t,current:null,token:null,hasCatch:!1,pending:un,then:cn,catch:rn,value:3,blocks:[,,,]};return wt(t[4].promise,u),{c(){e=y("header"),n=y("h1"),n.textContent=`svemlr v${Dt}`,l=I(),o=y("main"),r&&r.c(),i=I(),u.block.c(),h(n,"class","svelte-1oj1ab1")},m(c,f){z(c,e,f),g(e,n),z(c,l,f),z(c,o,f),r&&r.m(o,null),g(o,i),u.block.m(o,u.anchor=null),u.mount=()=>o,u.anchor=null,s=!0},p(c,[f]){t=c,t[3]?r&&(r.d(1),r=null):r?r.p(t,f):(r=ot(t),r.c(),r.m(o,i)),Ct(u,t,f)},i(c){s||(Q(u.block),s=!0)},o(c){for(let f=0;f<3;f+=1){const p=u.blocks[f];$(p)}s=!1},d(c){c&&T(e),c&&T(l),c&&T(o),r&&r.d(),u.block.d(),u.token=null,u=null}}}function fn(){alert("could not connect to monome grid. please use a chromium browser and disable serialosc.")}function pn(t,e,n){const l=Ne("audioContext");let{router:o={}}=e,{files:i={}}=e,{bpm:s={}}=e,{quantize:r={}}=e,{scheduler:u={}}=e,c;const f=At();async function p(){l.resume();try{n(3,c=await St.connect());const{x:b,y:_}=await Ot(c);Te(4,It,te,{audioContext:l}),Te(_-1,Ft,ve,{audioContext:l,group:te[0],stepCount:b,bpm:s,scheduler:u}),Te(2,Nt,ke,{bpm:s,scheduler:u,router:o}),o.start(c),f.resolve(c)}catch{fn()}}return t.$$set=b=>{"router"in b&&n(6,o=b.router),"files"in b&&n(0,i=b.files),"bpm"in b&&n(1,s=b.bpm),"quantize"in b&&n(2,r=b.quantize),"scheduler"in b&&n(7,u=b.scheduler)},[i,s,r,c,f,p,o,u]}class _n extends ce{constructor(e){super();ue(this,e,pn,an,ae,{router:6,files:0,bpm:1,quantize:2,scheduler:7})}}const ct=[],ut=Se(16,()=>Se(16,0));function ye(t,e){ct.push({matcher:t,handler:e})}function dn(t){t.on("gridKeyDown",({x:e,y:n})=>Oe({x:e,y:n,state:1,source:"press"})),t.on("gridKeyUp",({x:e,y:n})=>Oe({x:e,y:n,state:0,source:"press"}))}function Oe({x:t,y:e,state:n,source:l}){l==="press"&&(ut[e][t]=Number(n));const o=hn(t,e,n,l);if(!o)return;const i={x:t,y:e,state:n,grid:ut};Array.isArray(o.handler)?o.handler.forEach(s=>s(i)):o.handler(i)}function hn(t,e,n,l){return ct.find(({matcher:o})=>o({x:t,y:e,state:n,source:l}))}var mn=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",route:ye,start:dn,handle:Oe}),at={loop:({x:t,y:e,grid:n})=>{const l=ve[e-1],o=n[e].reduce((i,s,r)=>s?i.concat(r):i,[]);o.length===1?(l.resetLoopPoints(),l.start(t)):o.length===2&&l.loopBetween(o)},replay({x:t,y:e}){const n=ve[e-1];n.resetLoopPoints(),n.start(t)}},gn={change:({x:t,state:e,grid:n})=>{const l=n[0].reduce((s,r,u)=>r?s.concat(u):s,[]),o=l.includes(n[0].length-2),i=l.includes(n[0].length-1);e?o&&i?te[t].toggleMute():o?te[t].startDecreasingLevel():i?te[t].startIncreasingLevel():te[t].stop():(te[t].stopDecreasingLevel(),te[t].stopIncreasingLevel())}},ft={record:({x:t,y:e,state:n})=>{ke.forEach(l=>l.record({x:t,y:e,state:n}))},toggle:({x:t})=>{const e=te.length,n=t-e;ke[n].toggle()}};ye(({y:t,state:e,source:n})=>t>0&&n==="press"&&e,[at.loop,ft.record]);ye(({y:t,state:e,source:n})=>t>0&&n==="pattern"&&e,[at.replay]);ye(({x:t,y:e})=>e===0&&t<4,gn.change);ye(({x:t,y:e,state:n})=>e==0&&(t==4||t==5)&&n,ft.toggle);const{subscribe:bn,update:vn}=Z([]);function kn(t=[]){t=[...t],vn(e=>zt([...e,...t],n=>n.name))}const yn={subscribe:bn,add:kn},De=Z(120),Ie=Z(16),Ln=`registerProcessor('tick', class Tick extends AudioWorkletProcessor {
  process () {
    this.port.postMessage('tick')
    return true
  }
})`,wn=new Blob([Ln],{type:"application/javascript"}),Cn=URL.createObjectURL(wn);function Sn({audioContext:t,bpm:e,quantize:n}){let l=new qt(t,{tickMethod:"manual"});t.audioWorklet.addModule(Cn).then(function(){const _=new AudioWorkletNode(t,"tick");_.port.onmessage=function(){l._tick()}});let o=[],i=!1,s;function r(){const _=p(e,n);l.start(),s=l.setTimeout(f,_).repeat(_),i=!0}function u(){!i||(s.clear(),s=null,l.stop(),i=!1)}function c(_,C=[],v={}){if(v.in!=null){let B=l.setTimeout(()=>_.apply(null,C),v.in);return v.repeat&&(B=B.repeat(v.repeat)),B}else o.push({fn:_,args:C})}function f(){for(;o.length;){const{fn:_,args:C}=o.shift();_.apply(null,C)}}function p(_,C){return 60/_/C}function b(_){!i||l.timeStretch(t.currentTime,[s],_)}return{start:r,stop:u,schedule:c,set bpm(_){b(e/_),e=_},set quantize(_){b(n/_),n=_}}}const pt=new AudioContext,qe=Sn({audioContext:pt,bpm:Le(De),quantize:Le(Ie)});qe.start();De.subscribe(t=>qe.bpm=t);Ie.subscribe(t=>qe.quantize=t);new _n({target:document.getElementById("app"),props:{router:mn,files:yn,bpm:De,quantize:Ie,scheduler:qe},context:new Map([["audioContext",pt]])});
