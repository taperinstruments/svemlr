function L(){}function H(e){return e()}function X(){return Object.create(null)}function b(e){e.forEach(H)}function Z(e){return typeof e=="function"}function me(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Ee(e){return Object.keys(e).length===0}function W(e,...t){if(e==null)return L;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function Et(e){let t;return W(e,n=>t=n)(),t}function xt(e,t,n){e.$$.on_destroy.push(W(t,n))}function Lt(e,t,n){return e.set(n),t}function wt(e,t){e.appendChild(t)}function vt(e,t,n){e.insertBefore(t,n||null)}function xe(e){e.parentNode.removeChild(e)}function bt(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function St(e){return document.createElement(e)}function Dt(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function J(e){return document.createTextNode(e)}function Tt(){return J(" ")}function kt(){return J("")}function Rt(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function At(e){return function(t){return t.preventDefault(),e.call(this,t)}}function It(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Ot(e){return e===""?null:+e}function Le(e){return Array.from(e.childNodes)}function Mt(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function Ct(e,t){e.value=t==null?"":t}function $t(e,t){for(let n=0;n<e.options.length;n+=1){const i=e.options[n];if(i.__value===t){i.selected=!0;return}}e.selectedIndex=-1}function Nt(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}function Ut(e,t,n){e.classList[n?"add":"remove"](t)}let R;function A(e){R=e}function ee(){if(!R)throw new Error("Function called outside component initialization");return R}function Bt(e){return ee().$$.context.get(e)}function Pt(){return ee().$$.context}const I=[],te=[],C=[],Y=[],ne=Promise.resolve();let z=!1;function ie(){z||(z=!0,ne.then(re))}function Gt(){return ie(),ne}function F(e){C.push(e)}function Wt(e){Y.push(e)}const K=new Set;let $=0;function re(){const e=R;do{for(;$<I.length;){const t=I[$];$++,A(t),we(t.$$)}for(A(null),I.length=0,$=0;te.length;)te.pop()();for(let t=0;t<C.length;t+=1){const n=C[t];K.has(n)||(K.add(n),n())}C.length=0}while(I.length);for(;Y.length;)Y.pop()();z=!1,K.clear(),A(e)}function we(e){if(e.fragment!==null){e.update(),b(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(F)}}const N=new Set;let w;function Yt(){w={r:0,c:[],p:w}}function zt(){w.r||b(w.c),w=w.p}function se(e,t){e&&e.i&&(N.delete(e),e.i(t))}function ve(e,t,n,i){if(e&&e.o){if(N.has(e))return;N.add(e),w.c.push(()=>{N.delete(e),i&&(n&&e.d(1),i())}),e.o(t)}}function Ft(e,t){ve(e,1,1,()=>{t.delete(e.key)})}function Kt(e,t,n,i,r,c,o,a,u,s,g,_){let h=e.length,f=c.length,d=h;const k={};for(;d--;)k[e[d].key]=d;const O=[],B=new Map,P=new Map;for(d=f;d--;){const l=_(r,c,d),m=n(l);let E=o.get(m);E?i&&E.p(l,t):(E=s(m,l),E.c()),B.set(m,O[d]=E),m in k&&P.set(m,Math.abs(d-k[m]))}const j=new Set,Q=new Set;function G(l){se(l,1),l.m(a,g),o.set(l.key,l),g=l.first,f--}for(;h&&f;){const l=O[f-1],m=e[h-1],E=l.key,M=m.key;l===m?(g=l.first,h--,f--):B.has(M)?!o.has(E)||j.has(E)?G(l):Q.has(M)?h--:P.get(E)>P.get(M)?(Q.add(E),G(l)):(j.add(M),h--):(u(m,o),h--)}for(;h--;){const l=e[h];B.has(l.key)||u(l,o)}for(;f;)G(O[f-1]);return O}function qt(e,t,n){const i=e.$$.props[t];i!==void 0&&(e.$$.bound[i]=n,n(e.$$.ctx[i]))}function Vt(e){e&&e.c()}function be(e,t,n,i){const{fragment:r,on_mount:c,on_destroy:o,after_update:a}=e.$$;r&&r.m(t,n),i||F(()=>{const u=c.map(H).filter(Z);o?o.push(...u):b(u),e.$$.on_mount=[]}),a.forEach(F)}function Se(e,t){const n=e.$$;n.fragment!==null&&(b(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function De(e,t){e.$$.dirty[0]===-1&&(I.push(e),ie(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function jt(e,t,n,i,r,c,o,a=[-1]){const u=R;A(e);const s=e.$$={fragment:null,ctx:null,props:c,update:L,not_equal:r,bound:X(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:X(),dirty:a,skip_bound:!1,root:t.target||u.$$.root};o&&o(s.root);let g=!1;if(s.ctx=n?n(e,t.props||{},(_,h,...f)=>{const d=f.length?f[0]:h;return s.ctx&&r(s.ctx[_],s.ctx[_]=d)&&(!s.skip_bound&&s.bound[_]&&s.bound[_](d),g&&De(e,_)),h}):[],s.update(),g=!0,b(s.before_update),s.fragment=i?i(s.ctx):!1,t.target){if(t.hydrate){const _=Le(t.target);s.fragment&&s.fragment.l(_),_.forEach(xe)}else s.fragment&&s.fragment.c();t.intro&&se(e.$$.fragment),be(e,t.target,t.anchor,t.customElement),re()}A(u)}class Qt{$destroy(){Se(this,1),this.$destroy=L}$on(t,n){const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(t){this.$$set&&!Ee(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const S=[];function Te(e,t){return{subscribe:ke(e,t).subscribe}}function ke(e,t=L){let n;const i=new Set;function r(a){if(me(e,a)&&(e=a,n)){const u=!S.length;for(const s of i)s[1](),S.push(s,e);if(u){for(let s=0;s<S.length;s+=2)S[s][0](S[s+1]);S.length=0}}}function c(a){r(a(e))}function o(a,u=L){const s=[a,u];return i.add(s),i.size===1&&(n=t(r)||L),a(e),()=>{i.delete(s),i.size===0&&(n(),n=null)}}return{set:r,update:c,subscribe:o}}function Ht(e,t,n){const i=!Array.isArray(e),r=i?[e]:e,c=t.length<2;return Te(n,o=>{let a=!1;const u=[];let s=0,g=L;const _=()=>{if(s)return;g();const f=t(i?u[0]:u,o);c?o(f):g=Z(f)?f:L},h=r.map((f,d)=>W(f,k=>{u[d]=k,s&=~(1<<d),a&&_()},()=>{s|=1<<d}));return a=!0,_(),function(){b(h),g()}})}class Xt extends EventTarget{static connect(){return Promise.resolve(new this)}constructor(){super();addEventListener("keydown",({key:t,repeat:n})=>{if(n)return;const[i,r]=oe[t]||[];i!=null&&this.dispatch("gridKeyDown",{x:i,y:r})}),addEventListener("keyup",({key:t})=>{const[n,i]=oe[t]||[];n!=null&&this.dispatch("gridKeyUp",{x:n,y:i})})}query(){this.dispatch("query",{type:2,count:1})}getId(){this.dispatch("getId","qwerty 32")}getGridSize(){this.dispatch("getGridSize",{x:8,y:4})}gridLed(){}gridLedAll(){}gridLedCol(){}gridLedRow(){}gridLedRow(){}gridLedMap(){}gridLedIntensity(){}gridLedLevel(){}gridLedLevelAll(){}gridLedLevelCol(){}gridLedLevelRow(){}gridLedLevelMap(){}dispatch(t,n){const i=new CustomEvent(t,{detail:n});return this.dispatchEvent(i),i}}const oe={"1":[0,0],"2":[1,0],"3":[2,0],"4":[3,0],"5":[4,0],"6":[5,0],"7":[6,0],"8":[7,0],q:[0,1],w:[1,1],e:[2,1],r:[3,1],t:[4,1],y:[5,1],u:[6,1],i:[7,1],a:[0,2],s:[1,2],d:[2,2],f:[3,2],g:[4,2],h:[5,2],j:[6,2],k:[7,2],z:[0,3],x:[1,3],c:[2,3],v:[3,3],b:[4,3],n:[5,3],m:[6,3],",":[7,3]},ce="WebMonome: ",Re="device type not yet supported",Ae="write error",Ie="write is missing bytes",Oe="this browser does not support WebUsb.",Me="ok";function v(e,t,n){return Math.max(Math.min(e,n),t)}function U(e){let t=0;for(let n=0;n<Math.min(8,e.length);n++)t=t|v(e[n],0,1)<<n;return t}function q(e){throw new Error(ce+e)}function ae(e,t=0){console[["log","warn","error"][t]](ce+e)}class ue extends EventTarget{constructor(t){super();this.device=t,this.callbacks={},this.endpointIn=le(t,"in"),this.endpointOut=le(t,"out")}async listen(){if(!this.isConnected)return;const t=await this.read(64);t.status==="ok"&&t.data.byteLength>0&&this.processData(t.data,0),await this.listen()}async read(t){if(!!this.isConnected)return this.device.transferIn(this.endpointIn,t)}async write(t){const n=new Uint8Array(t),i=await this.device.transferOut(this.endpointOut,n);return i.status!==Me&&q(Ae),i.bytesWritten!==n.byteLength&&q(Ie),i}get isConnected(){return Boolean(this.device&&this.device.opened)}emit(t,n){const i=new CustomEvent(t,{detail:n});return this.dispatchEvent(i),i}}const Ce=e=>e.configuration.interfaces[_e(e.vendorId)].alternates[0].endpoints,le=(e,t)=>{const n={in:1,out:2};let i;try{i=Ce(e).find(({direction:c})=>c===t)}catch(r){ae(r,2)}return i?i.endpointNumber:n[t]},D=0,y=1,fe=2,$e=0,Ne=1,Ue=5,Be=0,Pe=1,Ge=3,We=0,Ye=1,ze=2,Fe=3,Ke=4,qe=5,Ve=6,je=7,Qe=8,He=9,Xe=10,Ze=11,Je=12,et=0,tt=1,T=(e,t)=>(e&15)<<4|t&15,nt=([e,t,...n])=>[T(e,t),...Array.isArray(n)?n:[]],V=(e,t)=>{const n=[];for(let i=0;i<Math.ceil(t/2);i++)n[i]=0;for(let i=0;i<Math.min(t,e.length);i++){const r=Math.floor(i/2),o=i%2===0?4:0;typeof n[r]!="number"&&(n[r]=0),n[r]=n[r]|v(e[i],0,15)<<o}return n};class it extends ue{constructor(t){super(t)}processData(t,n){switch(t.getUint8(n++)){case T(D,Be):this.emit("query",{type:t.getUint8(n++),count:t.getUint8(n++)});break;case T(D,Pe):let r="";for(let c=0;c<32;c++)r+=String.fromCharCode(t.getUint8(n++));this.emit("getId",r);break;case T(D,Ge):this.emit("getGridSize",{x:t.getUint8(n++),y:t.getUint8(n++)});break;case T(fe,tt):this.emit("gridKeyDown",{x:t.getUint8(n++),y:t.getUint8(n++)});break;case T(fe,et):this.emit("gridKeyUp",{x:t.getUint8(n++),y:t.getUint8(n++)});break}t.byteLength>n+1&&this.processData(t,n)}query(){return this.writeBuffer(D,$e)}getId(){return this.writeBuffer(D,Ne)}getGridSize(){return this.writeBuffer(D,Ue)}gridLed(t,n,i){return this.writeBuffer(y,i?Ye:We,t,n)}gridLedAll(t){return this.writeBuffer(y,t?Fe:ze)}gridLedCol(t,n,i){if(!!Array.isArray(i))return this.writeBuffer(y,Ve,t,n,U(i))}gridLedRow(t,n,i){if(!!Array.isArray(i))return this.writeBuffer(y,qe,t,n,U(i))}gridLedMap(t,n,i){if(!Array.isArray(i))return;const r=[0,0,0,0,0,0,0,0];for(let c=0;c<Math.min(64,i.length);c++){const o=Math.floor(c/8),a=c%8;r[o]=r[o]|v(i[c],0,1)<<a}return this.writeBuffer(y,Ke,t,n,...r)}gridLedIntensity(t){return this.writeBuffer(y,je,v(t,0,15))}gridLedLevel(t,n,i){return this.writeBuffer(y,Qe,t,n,v(i,0,15))}gridLedLevelAll(t){return this.writeBuffer(y,He,v(t,0,15))}gridLedLevelCol(t,n,i){if(!!Array.isArray(i))return this.writeBuffer(y,Je,t,n,...V(i,8))}gridLedLevelRow(t,n,i){if(!!Array.isArray(i))return this.writeBuffer(y,Ze,t,n,...V(i,8))}gridLedLevelMap(t,n,i){if(!!Array.isArray(i))return this.writeBuffer(y,Xe,t,n,...V(i,64))}writeBuffer(){return this.write(nt(Array.from(arguments)))}}const rt=0,st=16,ot=32,ct=48,at=64,ut=80,lt=96,ft=112,dt=144,ht=160;class _t extends ue{constructor(t){super(t)}processData(t,n){const i=t.getUint8(n++);let r,c,o;switch(i){case rt:o=t.getUint8(n++),[r,c]=[o>>4,o&15],this.emit("gridKeyDown",{x:r,y:c});break;case st:o=t.getUint8(n++),[r,c]=[o>>4,o&15],this.emit("gridKeyUp",{x:r,y:c});break}t.byteLength>n+1&&this.processData(t,n)}query(){}getId(){}getGridSize(){const t={64:{x:8,y:8},128:{x:16,y:8},256:{x:16,y:16}},[n,i]=this.device.serialNumber.match(/^m(64|128|256)/);this.emit("getGridSize",t[i])}gridLed(t,n,i){return this.write([i?ot:ct,t<<4|n])}gridLedAll(t){return this.write([dt|t&1])}gridLedCol(t,n,i){if(!Array.isArray(i))return;const r=i.length===8?ut:ft;return this.write([r|t&15,U(i)])}gridLedRow(t,n,i){if(!Array.isArray(i))return;const r=i.length===8?at:lt;return this.write([r|n&15,U(i)])}gridLedMap(t,n,i){}gridLedIntensity(t){return this.write([ht|v(t,0,15)&15])}gridLedLevel(t,n,i){return this.gridLed(t,n,i>7)}gridLedLevelAll(t){return this.gridLedIntensity(t)}gridLedLevelCol(t,n,i){return this.gridLedCol(t,n,i.map(r=>r>7))}gridLedLevelRow(t,n,i){return this.gridLedRow(t,n,i.map(r=>r>7))}gridLedLevelMap(t,n,i){}}const de=1027,he=1155,pt={[de]:0,[he]:1},_e=e=>pt[e]||0,yt="navigator"in window&&"usb"in navigator;var Zt={async connect(){if(!yt)return ae(Oe,1);let e;try{e=await navigator.usb.requestDevice({filters:[{vendorId:de},{vendorId:he}]}),await e.open(),e.configuration===null&&await e.selectConfiguration(1),await e.claimInterface(_e(e.vendorId));const t=gt(e);return t.listen(),t}catch(t){throw e=null,t}}};function gt(e){const t={mext:it,series:_t}[mt(e)];return new t(e)}function mt(e){if(/^m(64|128|256)/.test(e.serialNumber)||/^mk/.test(e.serialNumber))return"series";if(/^[Mm]\d+/.test(e.serialNumber))return"mext";q(Re)}var pe={exports:{}},ye={toleranceLate:.1,toleranceEarly:.001},x=function(e,t,n){this.clock=e,this.func=n,this._cleared=!1,this.toleranceLate=e.toleranceLate,this.toleranceEarly=e.toleranceEarly,this._latestTime=null,this._earliestTime=null,this.deadline=null,this.repeatTime=null,this.schedule(t)};x.prototype.clear=function(){return this.clock._removeEvent(this),this._cleared=!0,this};x.prototype.repeat=function(e){if(e===0)throw new Error("delay cannot be 0");return this.repeatTime=e,this.clock._hasEvent(this)||this.schedule(this.deadline+this.repeatTime),this};x.prototype.tolerance=function(e){return typeof e.late=="number"&&(this.toleranceLate=e.late),typeof e.early=="number"&&(this.toleranceEarly=e.early),this._refreshEarlyLateDates(),this.clock._hasEvent(this)&&(this.clock._removeEvent(this),this.clock._insertEvent(this)),this};x.prototype.isRepeated=function(){return this.repeatTime!==null};x.prototype.schedule=function(e){this._cleared=!1,this.deadline=e,this._refreshEarlyLateDates(),this.clock.context.currentTime>=this._earliestTime?this._execute():this.clock._hasEvent(this)?(this.clock._removeEvent(this),this.clock._insertEvent(this)):this.clock._insertEvent(this)};x.prototype.timeStretch=function(e,t){this.isRepeated()&&(this.repeatTime=this.repeatTime*t);var n=e+t*(this.deadline-e);if(this.isRepeated())for(;this.clock.context.currentTime>=n-this.toleranceEarly;)n+=this.repeatTime;this.schedule(n)};x.prototype._execute=function(){this.clock._started!==!1&&(this.clock._removeEvent(this),this.clock.context.currentTime<this._latestTime?this.func(this):(this.onexpired&&this.onexpired(this),console.warn("event expired")),!this.clock._hasEvent(this)&&this.isRepeated()&&!this._cleared&&this.schedule(this.deadline+this.repeatTime))};x.prototype._refreshEarlyLateDates=function(){this._latestTime=this.deadline+this.toleranceLate,this._earliestTime=this.deadline-this.toleranceEarly};var p=pe.exports=function(e,t){t=t||{},this.tickMethod=t.tickMethod||"ScriptProcessorNode",this.toleranceEarly=t.toleranceEarly||ye.toleranceEarly,this.toleranceLate=t.toleranceLate||ye.toleranceLate,this.context=e,this._events=[],this._started=!1};p.prototype.setTimeout=function(e,t){return this._createEvent(e,this._absTime(t))};p.prototype.callbackAtTime=function(e,t){return this._createEvent(e,t)};p.prototype.timeStretch=function(e,t,n){return t.forEach(function(i){i.timeStretch(e,n)}),t};p.prototype.start=function(){if(this._started===!1){var e=this;if(this._started=!0,this._events=[],this.tickMethod==="ScriptProcessorNode"){var t=256;this._clockNode=this.context.createScriptProcessor(t,1,1),this._clockNode.connect(this.context.destination),this._clockNode.onaudioprocess=function(){setTimeout(function(){e._tick()},0)}}else if(this.tickMethod!=="manual")throw new Error("invalid tickMethod "+this.tickMethod)}};p.prototype.stop=function(){this._started===!0&&(this._started=!1,this._clockNode.disconnect())};p.prototype._tick=function(){for(var e=this._events.shift();e&&e._earliestTime<=this.context.currentTime;)e._execute(),e=this._events.shift();e&&this._events.unshift(e)};p.prototype._createEvent=function(e,t){return new x(this,t,e)};p.prototype._insertEvent=function(e){this._events.splice(this._indexByTime(e._earliestTime),0,e)};p.prototype._removeEvent=function(e){var t=this._events.indexOf(e);t!==-1&&this._events.splice(t,1)};p.prototype._hasEvent=function(e){return this._events.indexOf(e)!==-1};p.prototype._indexByTime=function(e){for(var t=0,n=this._events.length,i;t<n;)i=Math.floor((t+n)/2),this._events[i]._earliestTime<e?t=i+1:n=i;return t};p.prototype._absTime=function(e){return e+this.context.currentTime};p.prototype._relTime=function(e){return e-this.context.currentTime};var ge=pe.exports,Jt=ge;typeof window!="undefined"&&(window.WAAClock=ge);export{Vt as A,be as B,Ct as C,Wt as D,se as E,ve as F,Se as G,Bt as H,xt as I,Ot as J,Lt as K,Dt as L,Ut as M,zt as N,Pt as O,Yt as P,Xt as Q,kt as R,Qt as S,Kt as T,Ft as U,Jt as V,J as a,vt as b,wt as c,Ht as d,St as e,xe as f,Et as g,Tt as h,jt as i,F as j,It as k,$t as l,Rt as m,L as n,bt as o,Zt as p,Nt as q,b as r,me as s,Gt as t,Mt as u,W as v,ke as w,te as x,qt as y,At as z};
