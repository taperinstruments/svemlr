function g(){}function ot(e){return e&&typeof e=="object"&&typeof e.then=="function"}function W(e){return e()}function Y(){return Object.create(null)}function L(e){e.forEach(W)}function G(e){return typeof e=="function"}function ct(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function ut(e){return Object.keys(e).length===0}function A(e,...t){if(e==null)return g;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function he(e){let t;return A(e,n=>t=n)(),t}function fe(e,t,n){e.$$.on_destroy.push(A(t,n))}function de(e,t,n){return e.set(n),t}function _e(e,t){e.appendChild(t)}function pe(e,t,n){e.insertBefore(t,n||null)}function at(e){e.parentNode.removeChild(e)}function ye(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function ge(e){return document.createElement(e)}function me(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function lt(e){return document.createTextNode(e)}function Ee(){return lt(" ")}function be(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function xe(e){return function(t){return t.preventDefault(),e.call(this,t)}}function Le(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function we(e){return e===""?null:+e}function ht(e){return Array.from(e.childNodes)}function ve(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function ke(e,t){e.value=t==null?"":t}function Se(e,t){for(let n=0;n<e.options.length;n+=1){const r=e.options[n];if(r.__value===t){r.selected=!0;return}}e.selectedIndex=-1}function De(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}function Te(e,t,n){e.classList[n?"add":"remove"](t)}let D;function m(e){D=e}function F(){if(!D)throw new Error("Function called outside component initialization");return D}function Re(e){return F().$$.context.get(e)}const S=[],K=[],T=[],I=[],z=Promise.resolve();let M=!1;function q(){M||(M=!0,z.then(U))}function Oe(){return q(),z}function C(e){T.push(e)}function Ae(e){I.push(e)}let $=!1;const N=new Set;function U(){if(!$){$=!0;do{for(let e=0;e<S.length;e+=1){const t=S[e];m(t),ft(t.$$)}for(m(null),S.length=0;K.length;)K.pop()();for(let e=0;e<T.length;e+=1){const t=T[e];N.has(t)||(N.add(t),t())}T.length=0}while(S.length);for(;I.length;)I.pop()();M=!1,$=!1,N.clear()}}function ft(e){if(e.fragment!==null){e.update(),L(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(C)}}const R=new Set;let E;function dt(){E={r:0,c:[],p:E}}function _t(){E.r||L(E.c),E=E.p}function V(e,t){e&&e.i&&(R.delete(e),e.i(t))}function pt(e,t,n,r){if(e&&e.o){if(R.has(e))return;R.add(e),E.c.push(()=>{R.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}}function Ie(e,t){const n=t.token={};function r(i,o,c,a){if(t.token!==n)return;t.resolved=a;let u=t.ctx;c!==void 0&&(u=u.slice(),u[c]=a);const s=i&&(t.current=i)(u);let d=!1;t.block&&(t.blocks?t.blocks.forEach((l,y)=>{y!==o&&l&&(dt(),pt(l,1,1,()=>{t.blocks[y]===l&&(t.blocks[y]=null)}),_t())}):t.block.d(1),s.c(),V(s,1),s.m(t.mount(),t.anchor),d=!0),t.block=s,t.blocks&&(t.blocks[o]=s),d&&U()}if(ot(e)){const i=F();if(e.then(o=>{m(i),r(t.then,1,t.value,o),m(null)},o=>{if(m(i),r(t.catch,2,t.error,o),m(null),!t.hasCatch)throw o}),t.current!==t.pending)return r(t.pending,0),!0}else{if(t.current!==t.then)return r(t.then,1,t.value,e),!0;t.resolved=e}}function Me(e,t,n){const r=t.slice(),{resolved:i}=e;e.current===e.then&&(r[e.value]=i),e.current===e.catch&&(r[e.error]=i),e.block.p(r,n)}function Ce(e,t,n){const r=e.$$.props[t];r!==void 0&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function $e(e){e&&e.c()}function yt(e,t,n,r){const{fragment:i,on_mount:o,on_destroy:c,after_update:a}=e.$$;i&&i.m(t,n),r||C(()=>{const u=o.map(W).filter(G);c?c.push(...u):L(u),e.$$.on_mount=[]}),a.forEach(C)}function gt(e,t){const n=e.$$;n.fragment!==null&&(L(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function mt(e,t){e.$$.dirty[0]===-1&&(S.push(e),q(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Ne(e,t,n,r,i,o,c,a=[-1]){const u=D;m(e);const s=e.$$={fragment:null,ctx:null,props:o,update:g,not_equal:i,bound:Y(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:Y(),dirty:a,skip_bound:!1,root:t.target||u.$$.root};c&&c(s.root);let d=!1;if(s.ctx=n?n(e,t.props||{},(l,y,..._)=>{const x=_.length?_[0]:y;return s.ctx&&i(s.ctx[l],s.ctx[l]=x)&&(!s.skip_bound&&s.bound[l]&&s.bound[l](x),d&&mt(e,l)),y}):[],s.update(),d=!0,L(s.before_update),s.fragment=r?r(s.ctx):!1,t.target){if(t.hydrate){const l=ht(t.target);s.fragment&&s.fragment.l(l),l.forEach(at)}else s.fragment&&s.fragment.c();t.intro&&V(e.$$.fragment),yt(e,t.target,t.anchor,t.customElement),U()}m(u)}class Ue{$destroy(){gt(this,1),this.$destroy=g}$on(t,n){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(t){this.$$set&&!ut(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const w=[];function Et(e,t){return{subscribe:bt(e,t).subscribe}}function bt(e,t=g){let n;const r=new Set;function i(a){if(ct(e,a)&&(e=a,n)){const u=!w.length;for(const s of r)s[1](),w.push(s,e);if(u){for(let s=0;s<w.length;s+=2)w[s][0](w[s+1]);w.length=0}}}function o(a){i(a(e))}function c(a,u=g){const s=[a,u];return r.add(s),r.size===1&&(n=t(i)||g),a(e),()=>{r.delete(s),r.size===0&&(n(),n=null)}}return{set:i,update:o,subscribe:c}}function Be(e,t,n){const r=!Array.isArray(e),i=r?[e]:e,o=t.length<2;return Et(n,c=>{let a=!1;const u=[];let s=0,d=g;const l=()=>{if(s)return;d();const _=t(r?u[0]:u,c);o?c(_):d=G(_)?_:g},y=i.map((_,x)=>A(_,st=>{u[x]=st,s&=~(1<<x),a&&l()},()=>{s|=1<<x}));return a=!0,l(),function(){L(y),d()}})}const j="WebMonome: ",xt="device type not yet supported",Lt="write error",wt="write is missing bytes",vt="this browser does not support WebUsb.",kt="ok";function b(e,t,n){return Math.max(Math.min(e,n),t)}function O(e){let t=0;for(let n=0;n<Math.min(8,e.length);n++)t=t|b(e[n],0,1)<<n;return t}function B(e){throw new Error(j+e)}function Q(e,t=0){console[["log","warn","error"][t]](j+e)}class H{constructor(t){this.device=t,this.callbacks={},this.endpointIn=X(t,"in"),this.endpointOut=X(t,"out")}async listen(){if(!this.isConnected)return;const t=await this.read(64);t.status==="ok"&&t.data.byteLength>0&&this.processData(t.data,0),await this.listen()}async read(t){if(!!this.isConnected)return this.device.transferIn(this.endpointIn,t)}async write(t){const n=new Uint8Array(t),r=await this.device.transferOut(this.endpointOut,n);return r.status!==kt&&B(Lt),r.bytesWritten!==n.byteLength&&B(wt),r}get isConnected(){return Boolean(this.device&&this.device.opened)}on(t,n){typeof n=="function"&&(this.callbacks[t]=this.callbacks[t]||[]).push(n)}off(t,n){if(arguments.length===0){this.callbacks={};return}const r=this.callbacks[t];if(!!r){if(arguments.length===1){delete this.callbacks[t];return}for(let i=0;i<r.length;i++)if(r[i]===n){r.splice(i,1);break}r.length===0&&delete this.callbacks[t]}}emit(t,n){const r=this.callbacks[t];if(!!Array.isArray(r))for(let i=0;i<r.length;i++){const o=r[i];typeof o!="function"&&skip,o(n)}}}const St=e=>e.configuration.interfaces[et(e.vendorId)].alternates[0].endpoints,X=(e,t)=>{const n={in:1,out:2};let r;try{r=St(e).find(({direction:o})=>o===t)}catch(i){Q(i,2)}return r?r.endpointNumber:n[t]},v=0,f=1,Z=2,Dt=0,Tt=1,Rt=5,Ot=0,At=1,It=3,Mt=0,Ct=1,$t=2,Nt=3,Ut=4,Bt=5,Pt=6,Wt=7,Yt=8,Gt=9,Ft=10,Kt=11,zt=12,qt=0,Vt=1,k=(e,t)=>(e&15)<<4|t&15,jt=([e,t,...n])=>[k(e,t),...Array.isArray(n)?n:[]],P=(e,t)=>{const n=[];for(let r=0;r<Math.ceil(t/2);r++)n[r]=0;for(let r=0;r<Math.min(t,e.length);r++){const i=Math.floor(r/2),c=r%2===0?4:0;typeof n[i]!="number"&&(n[i]=0),n[i]=n[i]|b(e[r],0,15)<<c}return n};class Qt extends H{constructor(t){super(t)}processData(t,n){switch(t.getUint8(n++)){case k(v,Ot):this.emit("query",{type:t.getUint8(n++),count:t.getUint8(n++)});break;case k(v,At):let i="";for(let o=0;o<32;o++)i+=String.fromCharCode(t.getUint8(n++));this.emit("getId",i);break;case k(v,It):this.emit("getGridSize",{x:t.getUint8(n++),y:t.getUint8(n++)});break;case k(Z,Vt):this.emit("gridKeyDown",{x:t.getUint8(n++),y:t.getUint8(n++)});break;case k(Z,qt):this.emit("gridKeyUp",{x:t.getUint8(n++),y:t.getUint8(n++)});break}t.byteLength>n+1&&this.processData(t,n)}query(){return this.writeBuffer(v,Dt)}getId(){return this.writeBuffer(v,Tt)}getGridSize(){return this.writeBuffer(v,Rt)}gridLed(t,n,r){return this.writeBuffer(f,r?Ct:Mt,t,n)}gridLedAll(t){return this.writeBuffer(f,t?Nt:$t)}gridLedCol(t,n,r){if(!!Array.isArray(r))return this.writeBuffer(f,Pt,t,n,O(r))}gridLedRow(t,n,r){if(!!Array.isArray(r))return this.writeBuffer(f,Bt,t,n,O(r))}gridLedMap(t,n,r){if(!Array.isArray(r))return;const i=[0,0,0,0,0,0,0,0];for(let o=0;o<Math.min(64,r.length);o++){const c=Math.floor(o/8),a=o%8;i[c]=i[c]|b(r[o],0,1)<<a}return this.writeBuffer(f,Ut,t,n,...i)}gridLedIntensity(t){return this.writeBuffer(f,Wt,b(t,0,15))}gridLedLevel(t,n,r){return this.writeBuffer(f,Yt,t,n,b(r,0,15))}gridLedLevelAll(t){return this.writeBuffer(f,Gt,b(t,0,15))}gridLedLevelCol(t,n,r){if(!!Array.isArray(r))return this.writeBuffer(f,zt,t,n,...P(r,8))}gridLedLevelRow(t,n,r){if(!!Array.isArray(r))return this.writeBuffer(f,Kt,t,n,...P(r,8))}gridLedLevelMap(t,n,r){if(!!Array.isArray(r))return this.writeBuffer(f,Ft,t,n,...P(r,64))}writeBuffer(){return this.write(jt(Array.from(arguments)))}}const Ht=0,Xt=16,Zt=32,Jt=48,te=64,ee=80,ne=96,re=112,ie=144,se=160;class oe extends H{constructor(t){super(t)}processData(t,n){const r=t.getUint8(n++);let i,o,c;switch(r){case Ht:c=t.getUint8(n++),[i,o]=[c>>4,c&15],this.emit("gridKeyDown",{x:i,y:o});break;case Xt:c=t.getUint8(n++),[i,o]=[c>>4,c&15],this.emit("gridKeyUp",{x:i,y:o});break}t.byteLength>n+1&&this.processData(t,n)}query(){}getId(){}getGridSize(){const t={64:{x:8,y:8},128:{x:16,y:8},256:{x:16,y:16}},[n,r]=this.device.serialNumber.match(/^m(64|128|256)/);this.emit("getGridSize",t[r])}gridLed(t,n,r){return this.write([r?Zt:Jt,t<<4|n])}gridLedAll(t){return this.write([ie|t&1])}gridLedCol(t,n,r){if(!Array.isArray(r))return;const i=r.length===8?ee:re;return this.write([i|t&15,O(r)])}gridLedRow(t,n,r){if(!Array.isArray(r))return;const i=r.length===8?te:ne;return this.write([i|n&15,O(r)])}gridLedMap(t,n,r){}gridLedIntensity(t){return this.write([se|b(t,0,15)&15])}gridLedLevel(t,n,r){return this.gridLed(t,n,r>7)}gridLedLevelAll(t){return this.gridLedIntensity(t)}gridLedLevelCol(t,n,r){return this.gridLedCol(t,n,r.map(i=>i>7))}gridLedLevelRow(t,n,r){return this.gridLedRow(t,n,r.map(i=>i>7))}gridLedLevelMap(t,n,r){}}const J=1027,tt=1155,ce={[J]:0,[tt]:1},et=e=>ce[e]||0,ue="navigator"in window&&"usb"in navigator;var Pe={async connect(){if(!ue)return Q(vt,1);let e;try{e=await navigator.usb.requestDevice({filters:[{vendorId:J},{vendorId:tt}]}),await e.open(),e.configuration===null&&await e.selectConfiguration(1),await e.claimInterface(et(e.vendorId));const t=ae(e);return t.listen(),t}catch(t){throw e=null,t}}};function ae(e){const t={mext:Qt,series:oe}[le(e)];return new t(e)}function le(e){if(/^m(64|128|256)/.test(e.serialNumber)||/^mk/.test(e.serialNumber))return"series";if(/^[Mm]\d+/.test(e.serialNumber))return"mext";B(xt)}var nt={exports:{}},rt={toleranceLate:.1,toleranceEarly:.001},p=function(e,t,n){this.clock=e,this.func=n,this._cleared=!1,this.toleranceLate=e.toleranceLate,this.toleranceEarly=e.toleranceEarly,this._latestTime=null,this._earliestTime=null,this.deadline=null,this.repeatTime=null,this.schedule(t)};p.prototype.clear=function(){return this.clock._removeEvent(this),this._cleared=!0,this};p.prototype.repeat=function(e){if(e===0)throw new Error("delay cannot be 0");return this.repeatTime=e,this.clock._hasEvent(this)||this.schedule(this.deadline+this.repeatTime),this};p.prototype.tolerance=function(e){return typeof e.late=="number"&&(this.toleranceLate=e.late),typeof e.early=="number"&&(this.toleranceEarly=e.early),this._refreshEarlyLateDates(),this.clock._hasEvent(this)&&(this.clock._removeEvent(this),this.clock._insertEvent(this)),this};p.prototype.isRepeated=function(){return this.repeatTime!==null};p.prototype.schedule=function(e){this._cleared=!1,this.deadline=e,this._refreshEarlyLateDates(),this.clock.context.currentTime>=this._earliestTime?this._execute():this.clock._hasEvent(this)?(this.clock._removeEvent(this),this.clock._insertEvent(this)):this.clock._insertEvent(this)};p.prototype.timeStretch=function(e,t){this.isRepeated()&&(this.repeatTime=this.repeatTime*t);var n=e+t*(this.deadline-e);if(this.isRepeated())for(;this.clock.context.currentTime>=n-this.toleranceEarly;)n+=this.repeatTime;this.schedule(n)};p.prototype._execute=function(){this.clock._started!==!1&&(this.clock._removeEvent(this),this.clock.context.currentTime<this._latestTime?this.func(this):(this.onexpired&&this.onexpired(this),console.warn("event expired")),!this.clock._hasEvent(this)&&this.isRepeated()&&!this._cleared&&this.schedule(this.deadline+this.repeatTime))};p.prototype._refreshEarlyLateDates=function(){this._latestTime=this.deadline+this.toleranceLate,this._earliestTime=this.deadline-this.toleranceEarly};var h=nt.exports=function(e,t){t=t||{},this.tickMethod=t.tickMethod||"ScriptProcessorNode",this.toleranceEarly=t.toleranceEarly||rt.toleranceEarly,this.toleranceLate=t.toleranceLate||rt.toleranceLate,this.context=e,this._events=[],this._started=!1};h.prototype.setTimeout=function(e,t){return this._createEvent(e,this._absTime(t))};h.prototype.callbackAtTime=function(e,t){return this._createEvent(e,t)};h.prototype.timeStretch=function(e,t,n){return t.forEach(function(r){r.timeStretch(e,n)}),t};h.prototype.start=function(){if(this._started===!1){var e=this;if(this._started=!0,this._events=[],this.tickMethod==="ScriptProcessorNode"){var t=256;this._clockNode=this.context.createScriptProcessor(t,1,1),this._clockNode.connect(this.context.destination),this._clockNode.onaudioprocess=function(){setTimeout(function(){e._tick()},0)}}else if(this.tickMethod!=="manual")throw new Error("invalid tickMethod "+this.tickMethod)}};h.prototype.stop=function(){this._started===!0&&(this._started=!1,this._clockNode.disconnect())};h.prototype._tick=function(){for(var e=this._events.shift();e&&e._earliestTime<=this.context.currentTime;)e._execute(),e=this._events.shift();e&&this._events.unshift(e)};h.prototype._createEvent=function(e,t){return new p(this,t,e)};h.prototype._insertEvent=function(e){this._events.splice(this._indexByTime(e._earliestTime),0,e)};h.prototype._removeEvent=function(e){var t=this._events.indexOf(e);t!==-1&&this._events.splice(t,1)};h.prototype._hasEvent=function(e){return this._events.indexOf(e)!==-1};h.prototype._indexByTime=function(e){for(var t=0,n=this._events.length,r;t<n;)r=Math.floor((t+n)/2),this._events[r]._earliestTime<e?t=r+1:n=r;return t};h.prototype._absTime=function(e){return e+this.context.currentTime};h.prototype._relTime=function(e){return e-this.context.currentTime};var it=nt.exports,We=it;typeof window!="undefined"&&(window.WAAClock=it);export{Ae as A,V as B,pt as C,gt as D,L as E,Re as F,fe as G,we as H,de as I,me as J,Te as K,Ie as L,Me as M,Pe as N,dt as O,_t as P,We as Q,he as R,Ue as S,lt as a,Ee as b,pe as c,Be as d,ge as e,_e as f,ve as g,at as h,Ne as i,Le as j,C as k,Se as l,be as m,g as n,ye as o,A as p,De as q,K as r,ct as s,Oe as t,Ce as u,xe as v,bt as w,$e as x,yt as y,ke as z};
