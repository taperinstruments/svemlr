var ht=Object.defineProperty,mt=Object.defineProperties;var gt=Object.getOwnPropertyDescriptors;var Te=Object.getOwnPropertySymbols;var bt=Object.prototype.hasOwnProperty,vt=Object.prototype.propertyIsEnumerable;var Fe=(t,e,n)=>e in t?ht(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,je=(t,e)=>{for(var n in e||(e={}))bt.call(e,n)&&Fe(t,n,e[n]);if(Te)for(var n of Te(e))vt.call(e,n)&&Fe(t,n,e[n]);return t},Pe=(t,e)=>mt(t,gt(e));import{S as ue,i as re,s as ce,e as y,t as W,a as T,b as D,c as g,d as me,f as M,g as p,h as Re,j as ye,l as N,n as I,k as oe,m as qe,o as Ie,p as kt,q as wt,r as ge,u as pe,v as _e,w as ne,x as yt,y as J,z as x,A as de,B as be,C as He,D as $,E as ae,F as Ae,G as Ne,H as Ge,I as ee,J as Z,K as qt,L as Ct,M as St,N as Ee,O as Oe,P as zt,Q as Lt,R as Ve}from"./vendor.9af8797c.js";const jt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}};jt();function Ce(t,e){const n=[];for(let l=0;l<t;l++)n[l]=typeof e=="function"?e(l):e;return n}function At(t,e){const n=[];let l=0;const s=t.length;for(;l<s;)n.push(t.slice(l,l+=e));return n}function Et(t,e){return t.reduce((n,l)=>{const s=e(l);return n.find(o=>e(o)===s)||n.push(l),n},[])}function Be(t,e,n,l){return Ce(t,s=>{const o=e(je({id:s},l));return n.push(o),o}),n}function Ot(){let t=function(n){};return{promise:new Promise(n=>t=n),resolve:t}}const Ke=new FileReader;function Bt(t,e){return new Promise(n=>{Ke.readAsArrayBuffer(t),Ke.onload=async({target:{result:l}})=>{n(await e.decodeAudioData(l))}})}function Dt(t){const e=new AudioBuffer({sampleRate:t.sampleRate,numberOfChannels:t.numberOfChannels,length:t.length});for(let l=0;l<t.numberOfChannels;l++){const s=t.getChannelData(l),o=e.getChannelData(l);for(var n=t.length-1;n>=0;n--)o[t.length-n-1]=s[n]}return e}function Mt(t,e,n){const l=e.createBufferSource();t&&(l.buffer=t);const{loopStart:s,loopEnd:o,loop:i,speed:u}=n;return l.loop=!!i,s!=null&&(l.loopStart=s),o!=null&&(l.loopEnd=o),u!=null&&(l.playbackRate.value=u),l}function Tt(t,e,n){const l=8;At(n,l).forEach((o,i)=>t.gridLedRow(i*l,e,o))}function Ft(t,e,n,l,s=50){t.gridLed(e,n,!l),setTimeout(()=>t.gridLed(e,n,l),s)}function Ue(t,e,n){const l=t.slice();return l[4]=e[n],l}function Ze(t){let e,n=t[4].name+"",l,s,o;return{c(){e=y("option"),l=W(n),s=T(),e.__value=o=t[4],e.value=e.__value},m(i,u){D(i,e,u),g(e,l),g(e,s)},p(i,u){u&4&&n!==(n=i[4].name+"")&&me(l,n),u&4&&o!==(o=i[4])&&(e.__value=o,e.value=e.__value)},d(i){i&&M(e)}}}function Pt(t){let e,n,l,s=t[2],o=[];for(let i=0;i<s.length;i+=1)o[i]=Ze(Ue(t,s,i));return{c(){e=y("select");for(let i=0;i<o.length;i+=1)o[i].c();p(e,"class","svelte-1hx4o8j"),t[0]===void 0&&Re(()=>t[3].call(e))},m(i,u){D(i,e,u);for(let c=0;c<o.length;c+=1)o[c].m(e,null);ye(e,t[0]),n||(l=N(e,"change",t[3]),n=!0)},p(i,[u]){if(u&4){s=i[2];let c;for(c=0;c<s.length;c+=1){const r=Ue(i,s,c);o[c]?o[c].p(r,u):(o[c]=Ze(r),o[c].c(),o[c].m(e,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=s.length}u&5&&ye(e,i[0])},i:I,o:I,d(i){i&&M(e),oe(o,i),n=!1,l()}}}function Rt(t,e,n){let l,s=I,o=()=>(s(),s=qe(i,r=>n(2,l=r)),i);t.$$.on_destroy.push(()=>s());let{files:i}=e;o();let{selected:u}=e;function c(){u=Ie(this),n(0,u)}return t.$$set=r=>{"files"in r&&o(n(1,i=r.files)),"selected"in r&&n(0,u=r.selected)},[u,i,l,c]}class It extends ue{constructor(e){super();re(this,e,Rt,Pt,ce,{files:1,selected:0})}}function Qe(t,e,n){const l=t.slice();return l[34]=e[n],l}function Je(t,e,n){const l=t.slice();return l[37]=e[n],l[39]=n,l}function We(t){let e,n,l,s,o,i,u;function c(){return t[25](t[39])}return{c(){e=y("input"),p(e,"name",n="sample_"+t[11]+"_step"),p(e,"type","radio"),e.value=l=t[39],e.checked=s=t[3]==t[39],e.disabled=o=!t[37].enabled,p(e,"autocomplete","off")},m(r,_){D(r,e,_),i||(u=N(e,"click",ge(c)),i=!0)},p(r,_){t=r,_[0]&8&&s!==(s=t[3]==t[39])&&(e.checked=s),_[0]&16&&o!==(o=!t[37].enabled)&&(e.disabled=o)},d(r){r&&M(e),i=!1,u()}}}function Xe(t){let e,n,l,s,o;return{c(){e=y("input"),p(e,"name",n="sample_"+t[11]+"_group"),p(e,"type","radio"),e.__value=l=t[34],e.value=e.__value,p(e,"autocomplete","off"),t[31][0].push(e)},m(i,u){D(i,e,u),e.checked=e.__value===t[10],s||(o=N(e,"change",t[30]),s=!0)},p(i,u){u[0]&1&&l!==(l=i[34])&&(e.__value=l,e.value=e.__value),u[0]&1024&&(e.checked=e.__value===i[10])},d(i){i&&M(e),t[31][0].splice(t[31][0].indexOf(e),1),s=!1,o()}}}function Ht(t){let e,n,l,s,o,i,u,c,r,_,d,q,m=(t[7]>=0?"+":"")+"",b,v,B,F,G,S,a,L,A=t[8].toFixed(2)+"",O,te,P,z,R,f,C,V,X,w,K,le;function fe(k){t[24](k)}let se={files:t[1]};t[2]!==void 0&&(se.selected=t[2]),l=new It({props:se}),kt.push(()=>wt(l,"selected",fe));let E=t[4],U=[];for(let k=0;k<E.length;k+=1)U[k]=We(Je(t,E,k));let h=t[0],j=[];for(let k=0;k<h.length;k+=1)j[k]=Xe(Qe(t,h,k));return{c(){e=y("tr"),n=y("td"),pe(l.$$.fragment),o=T(),i=y("td"),u=y("div");for(let k=0;k<U.length;k+=1)U[k].c();c=T(),r=y("input"),_=T(),d=y("td"),q=y("span"),b=W(m),v=W(t[7]),B=T(),F=y("button"),F.textContent="-",G=T(),S=y("button"),S.textContent="+",a=T(),L=y("td"),O=W(A),te=T(),P=y("td"),z=y("input"),R=T(),f=y("label"),C=W("Rev"),V=T(),X=y("td");for(let k=0;k<j.length;k+=1)j[k].c();p(n,"class","svelte-2kpfy0"),p(r,"type","range"),p(r,"min","1"),p(r,"max",t[5]),p(r,"step","1"),p(r,"class","svelte-2kpfy0"),p(i,"class","svelte-2kpfy0"),p(F,"aria-label","Decrement octave"),p(S,"aria-label","Increment octave"),p(d,"class","svelte-2kpfy0"),p(L,"class","svelte-2kpfy0"),p(z,"id","sample_"+t[11]+"_reverse"),p(z,"type","checkbox"),p(f,"for","sample_"+t[11]+"_reverse"),p(P,"class","svelte-2kpfy0"),p(X,"class","svelte-2kpfy0")},m(k,Q){D(k,e,Q),g(e,n),_e(l,n,null),g(e,o),g(e,i),g(i,u);for(let Y=0;Y<U.length;Y+=1)U[Y].m(u,null);g(i,c),g(i,r),ne(r,t[6]),g(e,_),g(e,d),g(d,q),g(q,b),g(q,v),g(d,B),g(d,F),g(d,G),g(d,S),g(e,a),g(e,L),g(L,O),g(e,te),g(e,P),g(P,z),z.checked=t[9],g(P,R),g(P,f),g(f,C),g(e,V),g(e,X);for(let Y=0;Y<j.length;Y+=1)j[Y].m(X,null);w=!0,K||(le=[N(r,"change",t[26]),N(r,"input",t[26]),N(F,"click",t[27]),N(S,"click",t[28]),N(z,"change",t[29])],K=!0)},p(k,Q){const Y={};if(Q[0]&2&&(Y.files=k[1]),!s&&Q[0]&4&&(s=!0,Y.selected=k[2],yt(()=>s=!1)),l.$set(Y),Q[0]&1050648){E=k[4];let H;for(H=0;H<E.length;H+=1){const ie=Je(k,E,H);U[H]?U[H].p(ie,Q):(U[H]=We(ie),U[H].c(),U[H].m(u,null))}for(;H<U.length;H+=1)U[H].d(1);U.length=E.length}if((!w||Q[0]&32)&&p(r,"max",k[5]),Q[0]&64&&ne(r,k[6]),(!w||Q[0]&128)&&m!==(m=(k[7]>=0?"+":"")+"")&&me(b,m),(!w||Q[0]&128)&&me(v,k[7]),(!w||Q[0]&256)&&A!==(A=k[8].toFixed(2)+"")&&me(O,A),Q[0]&512&&(z.checked=k[9]),Q[0]&3073){h=k[0];let H;for(H=0;H<h.length;H+=1){const ie=Qe(k,h,H);j[H]?j[H].p(ie,Q):(j[H]=Xe(ie),j[H].c(),j[H].m(X,null))}for(;H<j.length;H+=1)j[H].d(1);j.length=h.length}},i(k){w||(J(l.$$.fragment,k),w=!0)},o(k){x(l.$$.fragment,k),w=!1},d(k){k&&M(e),de(l),oe(U,k),oe(j,k),K=!1,be(le)}}}function Nt(t,e,n){let l,s,o,i,u,c,r,_,d,q;const m=He("audioContext");let{sample:b={}}=e,{id:v,steps:B,enabledStepCount:F,currentStep:G,octave:S,speed:a,reverse:L,buffer:A,group:O,start:te}=b;$(t,B,E=>n(4,u=E)),$(t,F,E=>n(6,c=E)),$(t,G,E=>n(3,i=E)),$(t,S,E=>n(7,r=E)),$(t,a,E=>n(8,_=E)),$(t,L,E=>n(9,d=E)),$(t,A,E=>n(32,o=E)),$(t,O,E=>n(10,q=E));let{groups:P=[]}=e,{monome:z={}}=e,{files:R={}}=e,f;const C=[[]];function V(E){f=E,n(2,f)}const X=E=>te(E);function w(){c=ae(this.value),F.set(c)}const K=()=>Ae(S,--r,r),le=()=>Ae(S,++r,r);function fe(){d=this.checked,L.set(d)}function se(){q=this.__value,O.set(q)}return t.$$set=E=>{"sample"in E&&n(21,b=E.sample),"groups"in E&&n(0,P=E.groups),"monome"in E&&n(22,z=E.monome),"files"in E&&n(1,R=E.files)},t.$$.update=()=>{t.$$.dirty[0]&16&&n(5,l=u.length),t.$$.dirty[0]&12582936&&Tt(z,s,u.map((E,U)=>U===i)),t.$$.dirty[0]&4&&f&&Bt(f,m).then(E=>Ae(A,o=E,o))},n(23,s=v+1),[P,R,f,i,u,l,c,r,_,d,q,v,B,F,G,S,a,L,A,O,te,b,z,s,V,X,w,K,le,fe,se,C]}class Gt extends ue{constructor(e){super();re(this,e,Nt,Ht,ce,{sample:21,groups:0,monome:22,files:1},null,[-1,-1])}}function Ye(t,e,n){const l=t.slice();return l[8]=e[n].name,l}function xe(t){let e,n=t[3],l=[];for(let s=0;s<n.length;s+=1)l[s]=$e(Ye(t,n,s));return{c(){e=y("ul");for(let s=0;s<l.length;s+=1)l[s].c();p(e,"class","svelte-1eckyqf")},m(s,o){D(s,e,o);for(let i=0;i<l.length;i+=1)l[i].m(e,null)},p(s,o){if(o&8){n=s[3];let i;for(i=0;i<n.length;i+=1){const u=Ye(s,n,i);l[i]?l[i].p(u,o):(l[i]=$e(u),l[i].c(),l[i].m(e,null))}for(;i<l.length;i+=1)l[i].d(1);l.length=n.length}},d(s){s&&M(e),oe(l,s)}}}function $e(t){let e,n,l,s,o=t[8]+"",i,u;return{c(){e=y("li"),n=Ne("svg"),l=Ne("path"),s=T(),i=W(o),u=T(),p(l,"d","M3.5 2C3.22386 2 3 2.22386 3 2.5V12.5C3 12.7761 3.22386 13 3.5 13H11.5C11.7761 13 12 12.7761 12 12.5V6H8.5C8.22386 6 8 5.77614 8 5.5V2H3.5ZM9 2.70711L11.2929 5H9V2.70711ZM2 2.5C2 1.67157 2.67157 1 3.5 1H8.5C8.63261 1 8.75979 1.05268 8.85355 1.14645L12.8536 5.14645C12.9473 5.24021 13 5.36739 13 5.5V12.5C13 13.3284 12.3284 14 11.5 14H3.5C2.67157 14 2 13.3284 2 12.5V2.5Z"),p(l,"fill","currentColor"),p(l,"fill-rule","evenodd"),p(l,"clip-rule","evenodd"),p(n,"width","15"),p(n,"height","15"),p(n,"viewBox","0 0 15 15"),p(n,"fill","none"),p(n,"xmlns","http://www.w3.org/2000/svg"),p(n,"class","svelte-1eckyqf"),p(e,"class","svelte-1eckyqf")},m(c,r){D(c,e,r),g(e,n),g(n,l),g(e,s),g(e,i),g(e,u)},p(c,r){r&8&&o!==(o=c[8]+"")&&me(i,o)},d(c){c&&M(e)}}}function Vt(t){let e,n,l,s,o,i,u,c,r=t[3].length&&xe(t);return{c(){e=y("section"),n=y("label"),n.textContent="Audio file drop",l=T(),s=y("div"),o=y("input"),i=T(),r&&r.c(),p(n,"for","files"),p(o,"accept","audio/*"),p(o,"id","files"),p(o,"name","files"),p(o,"type","file"),p(o,"class","svelte-1eckyqf"),p(s,"class","file-drop svelte-1eckyqf"),Ge(s,"dragover",t[2]),p(e,"class","svelte-1eckyqf")},m(_,d){D(_,e,d),g(e,n),g(e,l),g(e,s),g(s,o),g(s,i),r&&r.m(s,null),u||(c=[N(o,"change",t[5]),N(s,"dragover",ge(t[6])),N(s,"dragleave",ge(t[7])),N(s,"drop",ge(t[4]))],u=!0)},p(_,[d]){_[3].length?r?r.p(_,d):(r=xe(_),r.c(),r.m(s,null)):r&&(r.d(1),r=null),d&4&&Ge(s,"dragover",_[2])},i:I,o:I,d(_){_&&M(e),r&&r.d(),u=!1,be(c)}}}function Kt(t){return t.reduce((e,n)=>{if(n.kind==="file"){const l=n.getAsFile();/^(audio|video)/.test(l.type)&&e.push(l)}return e},[])}function Ut(t,e,n){let l,s=I,o=()=>(s(),s=qe(i,m=>n(3,l=m)),i);t.$$.on_destroy.push(()=>s());let{files:i}=e;o();let u,c=!1;function r({dataTransfer:m}){n(2,c=!1),i.add(Kt([...m.items]))}function _(){u=this.files,n(1,u)}const d=()=>n(2,c=!0),q=()=>n(2,c=!1);return t.$$set=m=>{"files"in m&&o(n(0,i=m.files))},t.$$.update=()=>{t.$$.dirty&3&&i.add(u)},[i,u,c,l,r,_,d,q]}class Zt extends ue{constructor(e){super();re(this,e,Ut,Vt,ce,{files:0})}}function Qt(t){let e,n,l,s,o,i,u,c,r,_,d,q,m,b,v;return{c(){e=y("div"),n=y("label"),l=y("input"),o=W(`
    On/Off`),i=T(),u=y("label"),c=y("input"),r=W(`
    Mute`),_=T(),d=y("label"),q=W(`Level
    `),m=y("input"),p(l,"type","checkbox"),l.disabled=s=!t[0],p(n,"class","svelte-37acoc"),p(c,"type","checkbox"),p(u,"class","svelte-37acoc"),p(m,"type","range"),p(m,"min","0"),p(m,"max","1"),p(m,"step","0.01"),p(d,"class","svelte-37acoc")},m(B,F){D(B,e,F),g(e,n),g(n,l),l.checked=t[0],g(n,o),g(e,i),g(e,u),g(u,c),c.checked=t[1],g(u,r),g(e,_),g(e,d),g(d,q),g(d,m),ne(m,t[2]),b||(v=[N(l,"change",t[8]),N(c,"change",t[9]),N(m,"change",t[10]),N(m,"input",t[10])],b=!0)},p(B,[F]){F&1&&s!==(s=!B[0])&&(l.disabled=s),F&1&&(l.checked=B[0]),F&2&&(c.checked=B[1]),F&4&&ne(m,B[2])},i:I,o:I,d(B){B&&M(e),b=!1,be(v)}}}function Jt(t,e,n){let l,s,o,{group:i={}}=e,{monome:u}=e,{id:c,active:r,muted:_,level:d}=i;$(t,r,v=>n(0,l=v)),$(t,_,v=>n(1,s=v)),$(t,d,v=>n(2,o=v));function q(){l=this.checked,r.set(l)}function m(){s=this.checked,_.set(s)}function b(){o=ae(this.value),d.set(o)}return t.$$set=v=>{"group"in v&&n(6,i=v.group),"monome"in v&&n(7,u=v.monome)},t.$$.update=()=>{t.$$.dirty&65&&(l||i.stop()),t.$$.dirty&129&&u.gridLed(c,0,l)},[l,s,o,r,_,d,i,u,q,m,b]}class Wt extends ue{constructor(e){super();re(this,e,Jt,Qt,ce,{group:6,monome:7})}}function et(t,e,n){const l=t.slice();return l[12]=e[n],l}function tt(t){let e,n,l=t[12]+"",s,o;return{c(){e=y("option"),n=W("1/"),s=W(l),e.__value=o=t[12],e.value=e.__value},m(i,u){D(i,e,u),g(e,n),g(e,s)},p:I,d(i){i&&M(e)}}}function Xt(t){let e,n,l,s,o,i,u,c,r,_,d,q,m,b,v,B,F,G=t[4],S=[];for(let a=0;a<G.length;a+=1)S[a]=tt(et(t,G,a));return{c(){e=y("label"),e.textContent="Tempo",n=T(),l=y("input"),s=T(),o=y("button"),o.textContent="-4",i=T(),u=y("button"),u.textContent="-1",c=T(),r=y("button"),r.textContent="+1",_=T(),d=y("button"),d.textContent="+4",q=T(),m=y("label"),m.textContent="Quantize",b=T(),v=y("select");for(let a=0;a<S.length;a+=1)S[a].c();p(e,"for","tempo"),p(l,"type","number"),p(l,"id","tempo"),p(l,"size","6"),p(l,"class","svelte-1texyt4"),p(m,"for","quantize"),p(v,"name","quantize"),p(v,"id","quantize"),t[3]===void 0&&Re(()=>t[11].call(v))},m(a,L){D(a,e,L),D(a,n,L),D(a,l,L),ne(l,t[2]),D(a,s,L),D(a,o,L),D(a,i,L),D(a,u,L),D(a,c,L),D(a,r,L),D(a,_,L),D(a,d,L),D(a,q,L),D(a,m,L),D(a,b,L),D(a,v,L);for(let A=0;A<S.length;A+=1)S[A].m(v,null);ye(v,t[3]),B||(F=[N(l,"input",t[6]),N(o,"click",t[7]),N(u,"click",t[8]),N(r,"click",t[9]),N(d,"click",t[10]),N(v,"change",t[11])],B=!0)},p(a,[L]){if(L&4&&ae(l.value)!==a[2]&&ne(l,a[2]),L&16){G=a[4];let A;for(A=0;A<G.length;A+=1){const O=et(a,G,A);S[A]?S[A].p(O,L):(S[A]=tt(O),S[A].c(),S[A].m(v,null))}for(;A<S.length;A+=1)S[A].d(1);S.length=G.length}L&24&&ye(v,a[3])},i:I,o:I,d(a){a&&M(e),a&&M(n),a&&M(l),a&&M(s),a&&M(o),a&&M(i),a&&M(u),a&&M(c),a&&M(r),a&&M(_),a&&M(d),a&&M(q),a&&M(m),a&&M(b),a&&M(v),oe(S,a),B=!1,be(F)}}}function Yt(t,e,n){let l,s=I,o=()=>(s(),s=qe(r,S=>n(2,l=S)),r),i,u=I,c=()=>(u(),u=qe(_,S=>n(3,i=S)),_);t.$$.on_destroy.push(()=>s()),t.$$.on_destroy.push(()=>u());let{bpm:r}=e;o();let{quantize:_}=e;c();const d=[128,64,32,16,8,4,2];function q(S){r.update(a=>a+S)}function m(){l=ae(this.value),r.set(l)}const b=()=>q(-4),v=()=>q(-1),B=()=>q(1),F=()=>q(4);function G(){i=Ie(this),_.set(i),n(4,d)}return t.$$set=S=>{"bpm"in S&&o(n(0,r=S.bpm)),"quantize"in S&&c(n(1,_=S.quantize))},[r,_,l,i,d,q,m,b,v,B,F,G]}class xt extends ue{constructor(e){super();re(this,e,Yt,Xt,ce,{bpm:0,quantize:1})}}const he=[];function $t({id:t,audioContext:e}){let n;const l=e.createGain();l.connect(e.destination);const s=Z(!1),o=Z(1),i=Z(!1);ee([o,i],([_,d])=>d?0:_).subscribe(_=>l.gain.value=_);function c(_,d){return r(),n=_,_.connect(l),_.start(0,d),s.set(!0),_}function r(){n==null||n.stop(),s.set(!1)}return{id:t,level:o,muted:i,active:s,play:c,stop:r}}function en(t){let e,n,l,s,o,i,u,c,r,_,d,q,m;return{c(){e=y("div"),n=y("label"),l=y("input"),s=W(`
    On/Off`),o=T(),i=y("label"),u=W(`Length
    `),c=y("input"),r=T(),_=y("input"),d=W(`
    beats`),p(l,"id","pattern_"+t[2]+"_active"),p(l,"name","pattern_"+t[2]+"_active"),p(l,"type","checkbox"),l.checked=t[0],p(n,"class","svelte-37acoc"),p(c,"type","range"),p(c,"min","1"),p(c,"max","32"),p(_,"type","number"),p(_,"min","1"),p(_,"max","32"),p(i,"class","svelte-37acoc")},m(b,v){D(b,e,v),g(e,n),g(n,l),g(n,s),g(e,o),g(e,i),g(i,u),g(i,c),ne(c,t[1]),g(i,r),g(i,_),ne(_,t[1]),g(i,d),q||(m=[N(l,"change",ge(t[4])),N(c,"change",t[8]),N(c,"input",t[8]),N(_,"input",t[9])],q=!0)},p(b,[v]){v&1&&(l.checked=b[0]),v&2&&ne(c,b[1]),v&2&&ae(_.value)!==b[1]&&ne(_,b[1])},i:I,o:I,d(b){b&&M(e),q=!1,be(m)}}}function tn(t,e,n){let l,s,{pattern:o={}}=e,{monome:i}=e,{id:u,active:c,toggle:r,length:_}=o;$(t,c,b=>n(0,l=b)),$(t,_,b=>n(1,s=b));const d=u+he.length;o.onactivity=()=>{Ft(i,d,0,1)};function q(){s=ae(this.value),_.set(s)}function m(){s=ae(this.value),_.set(s)}return t.$$set=b=>{"pattern"in b&&n(6,o=b.pattern),"monome"in b&&n(7,i=b.monome)},t.$$.update=()=>{t.$$.dirty&129&&i.gridLed(d,0,l)},[l,s,u,c,r,_,o,i,q,m]}class nn extends ue{constructor(e){super();re(this,e,tn,en,ce,{pattern:6,monome:7})}}function nt(t,e,n){const l=t.slice();return l[11]=e[n],l}function lt(t,e,n){const l=t.slice();return l[14]=e[n],l}function st(t,e,n){const l=t.slice();return l[17]=e[n],l}function ot(t){let e,n,l;return{c(){e=y("button"),e.textContent="Connect",p(e,"class","svelte-1qz9wbj")},m(s,o){D(s,e,o),n||(l=N(e,"click",t[8]),n=!0)},p:I,d(s){s&&M(e),n=!1,l()}}}function ln(t){return{c:I,m:I,p:I,i:I,o:I,d:I}}function sn(t){let e,n,l,s,o,i,u,c,r,_,d,q,m,b,v,B,F,G,S=t[4],a=[];for(let f=0;f<S.length;f+=1)a[f]=it(st(t,S,f));const L=f=>x(a[f],1,1,()=>{a[f]=null});u=new Zt({props:{files:t[0]}}),r=new xt({props:{bpm:t[1],quantize:t[2]}});let A=t[5],O=[];for(let f=0;f<A.length;f+=1)O[f]=ut(lt(t,A,f));const te=f=>x(O[f],1,1,()=>{O[f]=null});let P=t[3],z=[];for(let f=0;f<P.length;f+=1)z[f]=rt(nt(t,P,f));const R=f=>x(z[f],1,1,()=>{z[f]=null});return{c(){e=y("section"),n=y("table"),l=y("thead"),l.innerHTML=`<th class="svelte-1qz9wbj">File</th> 
					<th class="svelte-1qz9wbj"></th> 
					<th class="svelte-1qz9wbj">Octave</th> 
					<th class="svelte-1qz9wbj">Speed</th> 
					<th class="svelte-1qz9wbj"></th> 
					<th class="svelte-1qz9wbj">Group</th>`,s=T(),o=y("tbody");for(let f=0;f<a.length;f+=1)a[f].c();i=T(),pe(u.$$.fragment),c=T(),pe(r.$$.fragment),_=T(),d=y("fieldset"),q=y("legend"),q.textContent="Patterns",m=T();for(let f=0;f<O.length;f+=1)O[f].c();b=T(),v=y("fieldset"),B=y("legend"),B.textContent="Groups",F=T();for(let f=0;f<z.length;f+=1)z[f].c();p(l,"class","svelte-1qz9wbj"),p(o,"class","svelte-1qz9wbj"),p(n,"class","svelte-1qz9wbj"),p(e,"class","samples svelte-1qz9wbj"),p(q,"class","svelte-1qz9wbj"),p(d,"class","svelte-1qz9wbj"),p(B,"class","svelte-1qz9wbj"),p(v,"class","svelte-1qz9wbj")},m(f,C){D(f,e,C),g(e,n),g(n,l),g(n,s),g(n,o);for(let V=0;V<a.length;V+=1)a[V].m(o,null);g(e,i),_e(u,e,null),D(f,c,C),_e(r,f,C),D(f,_,C),D(f,d,C),g(d,q),g(d,m);for(let V=0;V<O.length;V+=1)O[V].m(d,null);D(f,b,C),D(f,v,C),g(v,B),g(v,F);for(let V=0;V<z.length;V+=1)z[V].m(v,null);G=!0},p(f,C){if(C&153){S=f[4];let w;for(w=0;w<S.length;w+=1){const K=st(f,S,w);a[w]?(a[w].p(K,C),J(a[w],1)):(a[w]=it(K),a[w].c(),J(a[w],1),a[w].m(o,null))}for(Ee(),w=S.length;w<a.length;w+=1)L(w);Oe()}const V={};C&1&&(V.files=f[0]),u.$set(V);const X={};if(C&2&&(X.bpm=f[1]),C&4&&(X.quantize=f[2]),r.$set(X),C&160){A=f[5];let w;for(w=0;w<A.length;w+=1){const K=lt(f,A,w);O[w]?(O[w].p(K,C),J(O[w],1)):(O[w]=ut(K),O[w].c(),J(O[w],1),O[w].m(d,null))}for(Ee(),w=A.length;w<O.length;w+=1)te(w);Oe()}if(C&136){P=f[3];let w;for(w=0;w<P.length;w+=1){const K=nt(f,P,w);z[w]?(z[w].p(K,C),J(z[w],1)):(z[w]=rt(K),z[w].c(),J(z[w],1),z[w].m(v,null))}for(Ee(),w=P.length;w<z.length;w+=1)R(w);Oe()}},i(f){if(!G){for(let C=0;C<S.length;C+=1)J(a[C]);J(u.$$.fragment,f),J(r.$$.fragment,f);for(let C=0;C<A.length;C+=1)J(O[C]);for(let C=0;C<P.length;C+=1)J(z[C]);G=!0}},o(f){a=a.filter(Boolean);for(let C=0;C<a.length;C+=1)x(a[C]);x(u.$$.fragment,f),x(r.$$.fragment,f),O=O.filter(Boolean);for(let C=0;C<O.length;C+=1)x(O[C]);z=z.filter(Boolean);for(let C=0;C<z.length;C+=1)x(z[C]);G=!1},d(f){f&&M(e),oe(a,f),de(u),f&&M(c),de(r,f),f&&M(_),f&&M(d),oe(O,f),f&&M(b),f&&M(v),oe(z,f)}}}function it(t){let e,n;return e=new Gt({props:{sample:t[17],groups:t[3],monome:t[6],files:t[0]}}),{c(){pe(e.$$.fragment)},m(l,s){_e(e,l,s),n=!0},p(l,s){const o={};s&16&&(o.sample=l[17]),s&8&&(o.groups=l[3]),s&1&&(o.files=l[0]),e.$set(o)},i(l){n||(J(e.$$.fragment,l),n=!0)},o(l){x(e.$$.fragment,l),n=!1},d(l){de(e,l)}}}function ut(t){let e,n;return e=new nn({props:{pattern:t[14],monome:t[6]}}),{c(){pe(e.$$.fragment)},m(l,s){_e(e,l,s),n=!0},p(l,s){const o={};s&32&&(o.pattern=l[14]),e.$set(o)},i(l){n||(J(e.$$.fragment,l),n=!0)},o(l){x(e.$$.fragment,l),n=!1},d(l){de(e,l)}}}function rt(t){let e,n;return e=new Wt({props:{monome:t[6],group:t[11]}}),{c(){pe(e.$$.fragment)},m(l,s){_e(e,l,s),n=!0},p(l,s){const o={};s&8&&(o.group=l[11]),e.$set(o)},i(l){n||(J(e.$$.fragment,l),n=!0)},o(l){x(e.$$.fragment,l),n=!1},d(l){de(e,l)}}}function on(t){return{c:I,m:I,p:I,i:I,o:I,d:I}}function un(t){let e,n,l,s=!t[6]&&ot(t),o={ctx:t,current:null,token:null,hasCatch:!1,pending:on,then:sn,catch:ln,value:6,blocks:[,,,]};return qt(t[7].promise,o),{c(){e=y("main"),s&&s.c(),n=T(),o.block.c(),p(e,"class","svelte-1qz9wbj")},m(i,u){D(i,e,u),s&&s.m(e,null),g(e,n),o.block.m(e,o.anchor=null),o.mount=()=>e,o.anchor=null,l=!0},p(i,[u]){t=i,t[6]?s&&(s.d(1),s=null):s?s.p(t,u):(s=ot(t),s.c(),s.m(e,n)),Ct(o,t,u)},i(i){l||(J(o.block),l=!0)},o(i){for(let u=0;u<3;u+=1){const c=o.blocks[u];x(c)}l=!1},d(i){i&&M(e),s&&s.d(),o.block.d(),o.token=null,o=null}}}function rn(t,e,n){const l=He("audioContext");let{router:s={}}=e,{files:o={}}=e,{bpm:i={}}=e,{quantize:u={}}=e,{groups:c=[]}=e,{samples:r=[]}=e,{patterns:_=[]}=e,d;const q=Ot();async function m(){l.resume(),n(6,d=await St.connect()),s.start(d),q.resolve(d)}return t.$$set=b=>{"router"in b&&n(9,s=b.router),"files"in b&&n(0,o=b.files),"bpm"in b&&n(1,i=b.bpm),"quantize"in b&&n(2,u=b.quantize),"groups"in b&&n(3,c=b.groups),"samples"in b&&n(4,r=b.samples),"patterns"in b&&n(5,_=b.patterns)},[o,i,u,c,r,_,d,q,m,s]}class cn extends ue{constructor(e){super();re(this,e,rn,un,ce,{router:9,files:0,bpm:1,quantize:2,groups:3,samples:4,patterns:5})}}const ct=[],at=Ce(16,()=>Ce(16,0));function ve(t,e){ct.push({matcher:t,handler:e})}function an(t){t.on("gridKeyDown",({x:e,y:n})=>De({x:e,y:n,state:1,source:"press"})),t.on("gridKeyUp",({x:e,y:n})=>De({x:e,y:n,state:0,source:"press"}))}function De({x:t,y:e,state:n,source:l}){l==="press"&&(at[e][t]=Number(n));const s=fn(t,e,n,l);if(!s)return;const o={x:t,y:e,state:n,grid:at};Array.isArray(s.handler)?s.handler.forEach(i=>i(o)):s.handler(o)}function fn(t,e,n,l){return ct.find(({matcher:s})=>s({x:t,y:e,state:n,source:l}))}var ft=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",route:ve,start:an,handle:De});function pn(t,e){let n,l,s;t.addEventListener("ended",i);function o(v=0){n=v,e(b()),l=c(),s=setInterval(u,1e3/60)}function i(){clearInterval(s)}function u(){const v=c();n+=(v-l)*m(),q()&&n>d()&&(n=_()+(n-d())),e(b()),l=v}function c(){return+new Date/1e3}function r(){return t.buffer.duration}function _(){return t.loopStart||0}function d(){return t.loopEnd||r()}function q(){return t.loop}function m(){return t.playbackRate.value}function b(){return Math.min(n/r()-Number.MIN_VALUE,1)}return{start:o,stop:i,check:u}}const Se=[];function _n({id:t,audioContext:e,group:n,bpm:l,scheduler:s}){n=Z(n);const o=16,i=Z(null),u=ee(i,h=>h&&Dt(h)),c=ee(i,h=>(h==null?void 0:h.duration)||0),r=Z(0),_=Z(!1),d=Z(0),q=Z(),m=Z(16),b=ee(m,h=>Ce(o,j=>({enabled:j<h}))),v=ee(l,h=>60/h),B=ee([v,m],([h,j])=>h*j),F=Z(0),G=Z(!1),S=ee([F,G,m],([h,j,k])=>j?le(Math.floor(h*k)):null),a=ee([c,B,r],([h,j,k])=>h?h/j*Math.pow(2,k):1),L=ee([c,m,d],([h,j,k])=>h/j*k),A=ee([c,m,q],([h,j,k])=>h/j*(k!=null?k:j)),O=ee(L,h=>h!=null),te={group:n,buffer:i,reffub:u,duration:c,enabledStepCount:m,steps:b,currentStep:S,octave:r,speed:a,reverse:_,loopStart:L,loopEnd:A,loop:O,playing:G,progress:F},P={};for(const h in te)te[h].subscribe(j=>P[h]=j);let z,R;L.subscribe(h=>{z&&(z.loopStart=h),R==null||R.check()}),A.subscribe(h=>{z&&(z.loopEnd=h),R==null||R.check()}),O.subscribe(h=>{z&&(z.loop=h),R==null||R.check()}),a.subscribe(h=>{z&&(z.playbackRate.value=h),R==null||R.check()}),_.subscribe(()=>{const{playing:h,duration:j,progress:k}=P;h&&C((1-k)*j)}),c.subscribe(async h=>{const{playing:j,progress:k}=P;j&&(R==null||R.check(),await zt(),C(k*h))});function f(h){!P.buffer||!K(h)||s.schedule(function(){C(w(le(h)))})}function C(h){z=E(),P.group.play(z,h),R==null||R.stop(),R=pn(z,F.set),R.start(h),G.set(!0)}function V(){d.set(0),q.set(null)}function X(h){if(!K(h[0])||!K(h[1]))return;h=le(h);const{reverse:j}=P;d.set(j?h[1]:h[0]),q.set(j?h[0]:h[1])}function w(h){const{duration:j,enabledStepCount:k}=P;return j/k*h}function K(h){return h<P.enabledStepCount}function le(h){return Array.isArray(h)?h.map(fe):fe(h)}function fe(h){if(h==null)return h;const{enabledStepCount:j,reverse:k}=P;return k?Math.abs(h-(j-1)):h}let se;function E(){const{reverse:h,buffer:j,reffub:k,loop:Q,loopStart:Y,loopEnd:H,speed:ie}=P;return se=+new Date+Math.random(),z=Mt(h?k:j,e,{loop:Q,loopStart:Y,loopEnd:H,speed:ie}),z.onended=(dt=>()=>U(dt))(se),z}function U(h){(!h||se===h)&&G.set(!1)}return Pe(je({id:t},te),{start:f,resetLoopPoints:V,loopBetween:X})}var pt={loop:({x:t,y:e,grid:n})=>{const l=Se[e-1],s=n[e].reduce((o,i,u)=>i?o.concat(u):o,[]);s.length===1?(l.resetLoopPoints(),l.start(t)):s.length===2&&l.loopBetween(s)},replay({x:t,y:e}){const n=Se[e-1];n.resetLoopPoints(),n.start(t)}},dn={stop:({x:t})=>{he[t].stop()}};const ze=[];function hn({id:t,bpm:e,scheduler:n,router:l}){const s=Z(!1),o=Z(!1),i=ee([s,o],([a,L])=>a||L),u=Z(8),c=ee([e,u],([a,L])=>60/a*L);let r=()=>{},_=[],d=null;const q={recordable:s,playing:o,active:i,length:u,duration:c},m={};for(const a in q)q[a].subscribe(L=>m[a]=L);function b(){m.active?(s.set(!1),o.set(!1),S()):s.set(!0)}function v(a){const{recordable:L,duration:A}=m;!L||_.push(F(a))===1&&(d=n.schedule(B,null,{in:A}))}function B(){s.set(!1),o.set(!0)}function F({x:a,y:L,state:A}){const{duration:O}=m;return n.schedule(()=>{l.handle({x:a,y:L,state:A,source:"pattern"}),n.schedule(r)},null,{in:O,repeat:O})}function G(){d==null||d.clear(),d=null,o.set(!1)}function S(){_.forEach(a=>a.clear()),_=[],G()}return{id:t,toggle:b,record:v,recordable:s,playing:o,active:i,length:u,set onactivity(a){r=a}}}var _t={record:({x:t,y:e,state:n})=>{ze.forEach(l=>l.record({x:t,y:e,state:n}))},toggle:({x:t})=>{const e=he.length,n=t-e;ze[n].toggle()}};ve(({y:t,state:e,source:n})=>t>0&&n==="press"&&e,[pt.loop,_t.record]);ve(({y:t,state:e,source:n})=>t>0&&n==="pattern"&&e,[pt.replay]);ve(({x:t,y:e,state:n})=>e===0&&t<4&&n,dn.stop);ve(({x:t,y:e,state:n})=>e==0&&(t==4||t==5)&&n,_t.toggle);const{subscribe:mn,update:gn}=Z([]);function bn(t=[]){t=[...t],gn(e=>Et([...e,...t],n=>n.name))}const vn={subscribe:mn,add:bn},ke=Z(120),Me=Z(16);function kn({audioContext:t,bpm:e,quantize:n}){let l=new Lt(t),s=[],o=!1,i;function u(){const m=d(e,n);l.start(),i=l.setTimeout(_,m).repeat(m),o=!0}function c(){!o||(i.clear(),i=null,l.stop(),o=!1)}function r(m,b=[],v={}){if(v.in!=null){let B=l.setTimeout(()=>m.apply(null,b),v.in);return v.repeat&&(B=B.repeat(v.repeat)),B}else s.push({fn:m,args:b})}function _(){for(;s.length;){const{fn:m,args:b}=s.shift();m.apply(null,b)}}function d(m,b){return 60/m/b}function q(m){!o||l.timeStretch(t.currentTime,[i],m)}return{start:u,stop:c,schedule:r,set bpm(m){q(e/m),e=m},set quantize(m){q(n/m),n=m}}}const Le=new AudioContext,we=kn({audioContext:Le,bpm:Ve(ke),quantize:Ve(Me)});we.start();ke.subscribe(t=>we.bpm=t);Me.subscribe(t=>we.quantize=t);Be(4,$t,he,{audioContext:Le});Be(7,_n,Se,{audioContext:Le,group:he[0],bpm:ke,scheduler:we});Be(2,hn,ze,{bpm:ke,scheduler:we,router:ft});new cn({target:document.getElementById("app"),props:{router:ft,files:vn,bpm:ke,quantize:Me,groups:he,samples:Se,patterns:ze},context:new Map([["audioContext",Le]])});
